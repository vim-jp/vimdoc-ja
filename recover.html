---
layout: vimdoc
helpname: 'recover'
---
<div id='vimCodeElement'>
<a class="Constant" href="recover.html" name="recover.txt">recover.txt</a>&nbsp;&nbsp; For&nbsp;<span class="Identifier">Vim バージョン 9.0.</span>&nbsp;&nbsp;Last change: 2020 Aug 15<br>
<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">VIMリファレンスマニュアル&nbsp;&nbsp;&nbsp;&nbsp;by Bram Moolenaar</span><br>
<br>
<br>
クラッシュ後のリカバリー&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="recover.html#crash-recovery" name="crash-recovery">crash-recovery</a><br>
<br>
あなたが明日の朝までに終わらせなければならない文書のタイピングに数時間を費や<br>
していたとき、悲劇があなたを襲う。コンピュータがクラッシュした。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;慌てないで!<br>
<br>
あなたはVimがファイルの内容を蓄えていたファイルから、ほとんどの変更を回復でき<br>
る。たいていの場合、あなたの仕事は1コマンドで回復できる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim -r filename<br>
<br>
1. スワップファイル&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="recover.html#swap-file">swap-file</a><br>
2. リカバリー&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="recover.html#recovery">recovery</a><br>
<br>
<span class="PreProc">==============================================================================</span><br>
1. スワップファイル&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="recover.html#swap-file" name="swap-file">swap-file</a><br>
<br>
Vimは変更した箇所をスワップファイルに蓄える。編集を開始したオリジナルのファイ<br>
ルとスワップファイルから、あなたのした作業は回復することができる。<br>
<br>
現在使用しているスワップファイルの名前は、次のコマンドで確認できる:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:sw[apname]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="recover.html#:sw" name=":sw">:sw</a>&nbsp;<a class="Constant" href="recover.html#:swapname" name=":swapname">:swapname</a><br>
<br>
または、<a class="Identifier" href="builtin.html#swapname()">swapname()</a>&nbsp;を使うことができる。他のバッファのスワップファイル名も確<br>
認できる。<br>
<br>
スワップファイルの名前は、普通は編集中のファイルと同じで、拡張子が &quot;.swp&quot; のも<br>
のになる。<br>
- UNIXでは、スワップファイルは編集中のファイルと同じディレクトリ内に作られ、<br>
&nbsp;&nbsp;'.' が名前の前につけられる。これはディレクトリ表示からスワップファイルを隠す<br>
&nbsp;&nbsp;ためである。<br>
- MS-Windows マシンで、<a class="Type" href="options.html#'shortname'">'shortname'</a>&nbsp;オプションがオンのときは、オリジナルファイ<br>
&nbsp;&nbsp;ル名の '.' は '_' に置き換えられる。<br>
- このファイルがすでに存在すると(例えば、クラッシュから復帰した場合)、注意が表<br>
&nbsp;&nbsp;示され、違った拡張子、&quot;.swo&quot;、&quot;.swn&quot;、などが用いられる。<br>
- 存在しているファイルは決して上書きされない。<br>
- スワップファイルはVimが編集を終えるとすぐに削除される。<br>
<br>
技術情報:&nbsp;&nbsp;'.' から '_' への置換はMS-DOS互換のファイルシステム(例、crossdos、<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; multidos)での問題を避けるためである。もしVimがMS-DOSライクなファイ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ルシステムを探知すると、<a class="Type" href="options.html#'shortname'">'shortname'</a>&nbsp;オプションと同じ効果を持つフラ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; グが設定される。このフラグは違うファイルの編集を始めたときにリセッ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; トされる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="recover.html#E326" name="E326">E326</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; もし &quot;.swp&quot; ファイルがすでに存在すると、同名のファイルが存在しなく<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; なるか、&quot;.saa&quot; となるまで最後の文字をひとつ前の文字に戻す。&quot;.saa&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; まで存在するときは、スワップファイルは作られない。<br>
<br>
<a class="Type" href="options.html#'directory'">'directory'</a>&nbsp;オプションを設定することによって、スワップファイルを、編集している<br>
ファイルとは別の場所に置くこともできる。<br>
利点:<br>
- ディレクトリが &quot;.swp&quot; ファイルで汚染されることがない。<br>
-&nbsp;<a class="Type" href="options.html#'directory'">'directory'</a>&nbsp;が別パーティションにある場合、ファイルのあるファイルシステムが<br>
&nbsp;&nbsp;(クラッシュで)損傷を受けるリスクが減る。<br>
欠点:<br>
- 別ディレクトリの同一名のファイルで名前の衝突を生じうる(Vimはパス名の比較でそ<br>
&nbsp;&nbsp;れを避けようとするが)。<br>
&nbsp;&nbsp;これによって偽の注意メッセージが表示される。<br>
- あなたがホームディレクトリで作業をしていて、他の誰かが同じファイルを編集しよ<br>
&nbsp;&nbsp;うとしたとき、そのユーザーはあなたのスワップファイルに気づかないし、注意の<br>
&nbsp;&nbsp;メッセージも表示されない。<br>
Amigaでは、回復可能なramディスクを使えるが、それが100％働くという保証はない。<br>
スワップファイルを通常のramディスク(AmigaではRAM:など)に置いたり、リブートに<br>
よって消されてしまう場所(Unixの/tmpなど)に置くことは無意味であり、クラッシュに<br>
よってスワップファイルは失われてしまう。<br>
<br>
スワップファイルを固定ディスクに置きたいときは、あなたの.vimrcファイルに次に示<br>
す様なコマンドを入れる:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:set dir=dh2:tmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Amigaの場合)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:set dir=~/tmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Unixの場合)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:set dir=c:\\tmp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Win32の場合)<br>
これらの設定はフロッピー上で編集作業をしているときには負担となる。もちろん、こ<br>
の様な設定で作業をするならば、&quot;tmp&quot; ディレクトリを作らねばならない。<br>
<br>
読取専用属性のファイルに対しては、スワップファイルは使用されない。ファイルが大<br>
きくなければ、<a class="Type" href="options.html#'maxmem'">'maxmem'</a>&nbsp;や&nbsp;<a class="Type" href="options.html#'maxmemtot'">'maxmemtot'</a>&nbsp;で与えられた量より多くのメモリを使用する<br>
ことはない。読取専用属性のファイルについて何らかの変更が加えられたとき、スワッ<br>
プファイルは無条件に作成される。<br>
<br>
スワップファイルの作成を避けるために&nbsp;<a class="Type" href="options.html#'swapfile'">'swapfile'</a>&nbsp;オプションをリセットできる。そ<br>
して新しいバッファでスワップファイルを作成しないようにするのに&nbsp;<a class="Identifier" href="recover.html#:noswapfile">:noswapfile</a><br>
修飾子を使うことができる。<br>
<br>
:nos[wapfile]&nbsp;&nbsp;&nbsp;<span class="Special">{command}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="recover.html#:nos" name=":nos">:nos</a>&nbsp;<a class="Constant" href="recover.html#:noswapfile" name=":noswapfile">:noswapfile</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{command}</span>&nbsp;を実行する。それが新しいバッファを読み込むコマンドを<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;含んでいる場合は、スワップファイルは作成されずに読み込まれ、<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Type" href="options.html#'swapfile'">'swapfile'</a>&nbsp;オプションはリセットされる。バッファが既にスワップ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ファイルを持っていた場合は、スワップファイルは削除されず、<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Type" href="options.html#'swapfile'">'swapfile'</a>&nbsp;はリセットされない。<br>
<br>
<br>
<span class="PreProc">既存のスワップファイルを削除する</span><br>
<br>
ユーザーマニュアルの<a class="Identifier" href="usr_11.html#11.3">11.3</a>を参照すること。<br>
<br>
<br>
<span class="PreProc">スワップファイルの更新</span><br>
<br>
スワップファイルは200文字を打ち込むか、4秒間何もしなかったときに更新される。こ<br>
れはバッファが変更されたときのみ行われ、動き回っているだけでは行われない。なぜ<br>
常に更新が行われないかといえば、それは通常の作業が大幅に遅くなるからである。<br>
200文字の設定は&nbsp;<a class="Type" href="options.html#'updatecount'">'updatecount'</a>&nbsp;で、時間の設定は&nbsp;<a class="Type" href="options.html#'updatetime'">'updatetime'</a>&nbsp;で変更できる。時間<br>
はミリ秒単位で与えられる。スワップファイルに書き込んだ後で、Vimはファイルとディ<br>
スクの同期を取る。これにはしばらく時間が掛かる(ビジーなUnixシステムにおいては<br>
特に時間がかかる)。もしこれを行って欲しくなければ、<a class="Type" href="options.html#'swapsync'">'swapsync'</a>&nbsp;オプションに空文<br>
字列を設定すればよい。作業の成果を失う危険性は増すが。いくつかの非Unixシステム<br>
(MS-Windows、Amigaなど)においては、スワップファイルはまったく書き込まれなくな<br>
るだろう。<br>
<br>
スワップファイルへの書き込みを望まないなら、<a class="Type" href="options.html#'updatecount'">'updatecount'</a>&nbsp;を0に設定することで<br>
行われなくなる。Vimを &quot;-n&quot; オプションで起動することで、同じ結果が得られる。書<br>
き込みは&nbsp;<a class="Type" href="options.html#'updatecount'">'updatecount'</a>&nbsp;を非0にすることでまた行われるようになる。これを行ったと<br>
きはスワップファイルが全てのバッファに対して作られる。しかし、<a class="Type" href="options.html#'updatecount'">'updatecount'</a>&nbsp;を<br>
0に設定したときは、存在しているスワップファイルは消されることはなく、次に開か<br>
れたファイルから有効になる。<br>
<br>
行った編集がスワップファイルに書きこまれたかを確認するには、次のコマンドを使用<br>
する:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="recover.html#:pre" name=":pre">:pre</a>&nbsp;<a class="Constant" href="recover.html#:preserve" name=":preserve">:preserve</a>&nbsp;<a class="Constant" href="recover.html#E313" name="E313">E313</a>&nbsp;<a class="Constant" href="recover.html#E314" name="E314">E314</a><br>
:pre[serve]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 現在のバッファの全てのテキストをそのスワップファイルに<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;書き込む。回復のためにオリジナルが必要とされることは<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;なくなる。このコマンドはカレントバッファにあるフラグを<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;設定する。また、<a class="Type" href="options.html#'cpoptions'">'cpoptions'</a>&nbsp;にフラグ '&amp;' が入っている<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ならば、Vim が終了するとき、このバッファのスワップファ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;イルは削除されず、バッファは読み込まれた状態のままにな<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;る。<a class="Identifier" href="options.html#cpo-&">cpo-&amp;</a><br>
<br>
Vimのスワップファイルは最初の6文字で認識される: &quot;b0VIM &quot;。<br>
この後に &quot;3.0&quot; などのバージョン番号が続く。<br>
<br>
<br>
<span class="PreProc">リンクとシンボリックリンク</span><br>
<br>
Unix では同一のファイルに2つの名前をつけることができる。それはハードリンクまた<br>
はシンボリックリンク(symlink)を使って行う。<br>
<br>
ハードリンクの場合、Vim はそのファイルにつけられた他の名前を知ることができな<br>
い。そのため、スワップファイルの名前は、そのファイルを開くときに使った名前に基<br>
づいてつけられる。<br>
そのファイルが別の名前でも開かれているかどうかのチェックは行わない。他のスワッ<br>
プファイルを検出することはできないからである(ハードディスク全てを検索するとい<br>
う方法は除く。それはとても遅くなるから)。<br>
<br>
シンボリックリンクの場合、Vim はそのリンクが指す実際のファイルを見つけられる。<br>
スワップファイルの名前は実際の名前に基づいてつけられる。よって、ユーザーがどん<br>
な名前でそのファイルを開いたかは関係なく、スワップファイル名は同一になる。しか<br>
し次のような例外がある:<br>
- 実際のファイルのディレクトリが書き込み不可ならば、スワップファイルは別の場所<br>
&nbsp;&nbsp;に置かれる。<br>
- シンボリックリンクがなんらかの形でループになっているとき、エラーメッセージ<br>
<span class="Statement">&nbsp;&nbsp;</span><a class="Constant" href="recover.html#E773" name="E773">E773</a>&nbsp;が表示され、変更されていないファイル名が使われる。普通にファイルを保<br>
&nbsp;&nbsp;存することはできない。<br>
<br>
<span class="PreProc">==============================================================================</span><br>
2. リカバリー&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="recover.html#recovery" name="recovery">recovery</a>&nbsp;<a class="Constant" href="recover.html#E308" name="E308">E308</a>&nbsp;<a class="Constant" href="recover.html#E311" name="E311">E311</a><br>
<br>
基本的なファイルの回復方法はユーザーマニュアルの<a class="Identifier" href="usr_11.html">usr_11.txt</a>を参照すること。<br>
<br>
ファイルを回復するためのもうひとつの方法は、Vimを起動して &quot;:recover&quot; コマンド<br>
を使うことである。<br>
これはVimを起動したときに &quot;ATTENTION: Found a swap file ...&quot; というメッセージ<br>
を受け取ったときには便利である。その場合には &quot;:recover&quot; というコマンドひとつで<br>
全てが済む。<br>
recoverコマンドにはファイル名かスワップファイル名を渡すことができる:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="recover.html#:rec" name=":rec">:rec</a>&nbsp;<a class="Constant" href="recover.html#:recover" name=":recover">:recover</a>&nbsp;<a class="Constant" href="recover.html#E305" name="E305">E305</a>&nbsp;<a class="Constant" href="recover.html#E306" name="E306">E306</a>&nbsp;<a class="Constant" href="recover.html#E307" name="E307">E307</a><br>
:rec[over]&nbsp;<span class="Special">[file]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; スワップファイルから[file]を回復するよう試みる。もし<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">[file]</span>が与えられていない場合は、現在のバッファの名前が<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;用いられる。現在のバッファの内容は失われる。このコマン<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ドはバッファが修正を加えられている場合に失敗する。<br>
<br>
:rec[over]!&nbsp;<span class="Special">[file]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;:recover&quot; と同じだが、現在のバッファに対するどんな変<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;更も失われる。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="recover.html#E312" name="E312">E312</a>&nbsp;<a class="Constant" href="recover.html#E309" name="E309">E309</a>&nbsp;<a class="Constant" href="recover.html#E310" name="E310">E310</a><br>
Vimはスワップファイルが何らかの理由で壊れているときに、いくつかの対処を提供す<br>
る。Vimが見つかったものに疑問を持った場合、エラーメッセージが与えられ、&quot;???&quot;<br>
というテキストが一緒に行に挿入される。回復中にエラーメッセージを受け取ったら、<br>
&quot;???&quot; を検索することによってどこに問題があったかを知ることができる。必要なテキ<br>
ストを得るためには、カットやペーストを必要とするかもしれない。<br>
<br>
ほとんどは &quot;???LINES MISSING&quot; のようなものである。これはVimがそのテキストをオ<br>
リジナルのファイルから読み込めないことを示す。これはシステムがクラッシュした時<br>
にファイルが正しくディスクに書き込まれなかったときに起こる。<br>
<br>
オリジナルを上書きしたり、スワップファイルを削除する前に、回復が成功したことを<br>
確認すること。回復されたファイルをどこか別の場所に保存して、<a class="Type" href="options.html#'diff'">'diff'</a>&nbsp;によって変<br>
更を加えた箇所が、ちゃんと回復されたファイルに入っているか調べてみるとよい。ま<br>
たは&nbsp;<a class="Identifier" href="diff.html#:DiffOrig">:DiffOrig</a>&nbsp;を使う。<br>
<br>
回復が成功したと確信したら、スワップファイルを削除する。そうしないと、&quot;.swp&quot;<br>
が存在するというメッセージが表示されつづけることになる。<br>
<br>
<br>
<br>
暗号化とスワップファイル&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="recover.html#:recover-crypt" name=":recover-crypt">:recover-crypt</a><br>
<br>
テキストファイルが暗号化されているときはスワップファイルも暗号化される。これは<br>
リカバリーを多少複雑にする。スワップファイルからリカバリーするときにそれが暗号<br>
化されていた場合、一つか二つの秘密鍵を入力する必要があるだろう。<br>
<br>
テキストファイルが存在しない場合は入力する必要のある秘密鍵はスワップファイル用<br>
の一つだけである。<br>
<br>
テキストファイルが存在する場合、そのファイルはスワップファイルとは別の方法で復<br>
号する必要があるかもしれない。秘密鍵を二つ入力する必要がある:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">Need encryption key for &quot;/tmp/tt&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">Enter encryption key: ******</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">&quot;/tmp/tt&quot; [crypted] 23200L, 522129C</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">Using swap file &quot;/tmp/.tt.swp&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">Original file &quot;/tmp/tt&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">Swap file is encrypted: &quot;/tmp/.tt.swp&quot;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">If you entered a new crypt key but did not write the text file,</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">enter the new crypt key.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">If you wrote the text file after changing the crypt key press enter</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">to use the same key for text file and swap file</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">Enter encryption key:&nbsp;</span><br>
<br>
二つの状況が考えられる:<br>
<br>
1. 暗号化キーが変更されなかったか、キーが変更された後でファイルが保存された場<br>
&nbsp;&nbsp; 合。秘密鍵を二回入力する必要がある。二回目に入力するときは単にエンターを押<br>
&nbsp;&nbsp; すこと。そうするとテキストファイルとスワップファイルの両方に同じキーが使用<br>
&nbsp;&nbsp; される。<br>
2. 新しい暗号化キーを入力したが、ファイルは保存されなかった場合。スワップファ<br>
&nbsp;&nbsp; イルには新しいキーが使用されているが、テキストファイルは古いキーで暗号化さ<br>
&nbsp;&nbsp; れたままになっている。二回目にキーを入力するときに新しい方のキーを入力する<br>
&nbsp;&nbsp; こと。<br>
<br>
<span class="Todo">Note</span>: リカバリー実行後にはスワップファイルのキーがテキストファイルに使用され<br>
る。したがって、ファイルを書き込んだ後は新しいキーを使用する必要がある。<br>
<br>
<br>
&nbsp;vim:tw=78:ts=8:noet:ft=help:norl:<br>
</div>
