---
layout: vimdoc
helpname: 'vim9'
---
<div id='vimCodeElement'>
<a class="Constant" href="vim9.html" name="vim9.txt">vim9.txt</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;<span class="Identifier">Vim バージョン 9.0.</span>&nbsp;&nbsp;Last change: 2022 Sep 15<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Identifier">VIMリファレンスマニュアル&nbsp;&nbsp;&nbsp;&nbsp;by Bram Moolenaar</span><br>
<br>
<br>
<br>
Vim9 script のコマンドと文法&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#Vim9" name="Vim9">Vim9</a>&nbsp;<a class="Constant" href="vim9.html#vim9" name="vim9">vim9</a><br>
<br>
ほとんどの文法については&nbsp;<a class="Identifier" href="eval.html">eval.txt</a>&nbsp;で解説されています。このファイルには Vim9<br>
script の新しい文法と機能について書かれています。<br>
<br>
<br>
1.&nbsp;&nbsp;Vim9 script とは&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#Vim9-script">Vim9-script</a><br>
2.&nbsp;&nbsp;変更点&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9-differences">vim9-differences</a><br>
3.&nbsp;&nbsp;新しいスタイルの関数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#fast-functions">fast-functions</a><br>
4.&nbsp;&nbsp;型&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9-types">vim9-types</a><br>
5.&nbsp;&nbsp;名前空間、Import と Export&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9script">vim9script</a><br>
6.&nbsp;&nbsp;将来的な変更: クラス&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9-classes">vim9-classes</a><br>
<br>
9.&nbsp;&nbsp;言語設計の背景&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9-rationale">vim9-rationale</a><br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
1. Vim9 script とは&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#Vim9-script" name="Vim9-script">Vim9-script</a><br>
<br>
<br>
Vim script は、互換性の維持に気を配りながら成長してきました。そのため、古い悪<br>
しき仕様を変更できないことが多いほか、Vi との互換性に制約を受けて、より良い解<br>
決策を採用できなくなっています。処理は遅く、実行するたびに各行のパースが行われ<br>
ています。<br>
<br>
Vim9 script の主な目的は劇的な性能の向上です。これは、コマンドをより効率よく実<br>
行できる命令にコンパイルすることで実現しています。これにより、10倍から100倍の<br>
実行速度の向上が期待できます。<br>
<br>
第2の目的は、Vim script 特有の文法を回避し、より一般的に使われる JavaScript や<br>
TypeScript、Java のようなプログラミング言語に近づけることです。<br>
<br>
パフォーマンスの向上は、100% の下位互換性を捨てることによってのみ達成しうるも<br>
のです。例えば、関数の引数を辞書 &quot;a:&quot; から利用できるようにするためには、かなり<br>
のオーバーヘッドが必要になります。そのため、Vim9 script では、この辞書が利用で<br>
きなくなりました。その他の違いは、エラーの処理方法など、より微細なものです。<br>
<br>
Vim9 script は以下の場所で使用することができます:<br>
- コマンド&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義された関数の中<br>
- コマンド&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;で始まるスクリプトファイルの中<br>
- 上記のコンテキストで定義された自動コマンド<br>
- コマンド修飾子&nbsp;<a class="Comment" href="vim9.html#:vim9cmd">vim9cmd</a>&nbsp;が先頭に付いたコマンド<br>
<br>
Vim9 script ファイルの中でコマンド&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;で関数を定義すると、その中では<br>
旧来の Vim script の記法が、最新の&nbsp;<a class="Identifier" href="eval.html#scriptversion">scriptversion</a>&nbsp;とともに有効になります。し<br>
かし、これは混乱を招く可能性があるため、推奨できません。<br>
<br>
Vim9 script と旧来の Vim script は同時に利用できます。古いスクリプトを書き換え<br>
なくとも、以前と同様に実行することが可能です。高速化が必要なコードには、<a class="Comment" href="vim9.html#:def">:def</a><br>
で定義する関数を使ったほうが良いかもしれません。<br>
<br>
:vim9<span class="Special">[cmd]</span>&nbsp;<span class="Special">{cmd}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:vim9" name=":vim9">:vim9</a>&nbsp;<a class="Constant" href="vim9.html#:vim9cmd" name=":vim9cmd">:vim9cmd</a>&nbsp;<a class="Constant" href="vim9.html#E1164" name="E1164">E1164</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vim9 script の文法と方式を使用して&nbsp;<span class="Special">{cmd}</span>&nbsp;を評価、実行します。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;コマンドを入力する時と、旧来のスクリプトや関数内で使用する時に<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;便利です。<br>
<br>
:leg[acy]&nbsp;<span class="Special">{cmd}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:leg" name=":leg">:leg</a>&nbsp;<a class="Constant" href="vim9.html#:legacy" name=":legacy">:legacy</a>&nbsp;<a class="Constant" href="vim9.html#E1189" name="E1189">E1189</a>&nbsp;<a class="Constant" href="vim9.html#E1234" name="E1234">E1234</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧来の Vim script の文法と方式を利用して&nbsp;<span class="Special">{cmd}</span>&nbsp;を評価、実行し<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;します。これは Vim9 script、あるいは&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義する関数での<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;み便利です。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Todo">Note</span>&nbsp;<span class="Special">{cmd}</span>&nbsp;は旧来の Vim script の式として解釈されるため、<span class="Special">{cmd}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ではローカル変数&nbsp;<span class="Special">{訳注: Vim9 script におけるローカル変数}</span>&nbsp;を用<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;いることはできない。<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
2. 旧来の Vim script からの変更点&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-differences" name="vim9-differences">vim9-differences</a><br>
<br>
<span class="PreProc">概要</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1146" name="E1146">E1146</a><br>
Vim9 script と&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義する関数を使用する際に最もよく遭遇する変更点の概要<br>
は以下のとおりです:<br>
- コメントは &quot; ではなく、# で始めます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo &quot;hello&quot;&nbsp;&nbsp; # コメント</div>
- 行継続文字 (\) はほとんどの場合、必要ありません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo &quot;hello &quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .. yourName<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .. &quot;, how are you?&quot;</div>
- 可読性を上げるため、多くの場所にスペースが必要になります。<br>
- 値の代入には&nbsp;<a class="Comment" href="eval.html#:let">:let</a>&nbsp;<a class="Constant" href="vim9.html#E1126" name="E1126">E1126</a>&nbsp;を使用せず、変数の宣言には&nbsp;<a class="Comment" href="vim9.html#:var">:var</a>&nbsp;を使用します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var count = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count += 3</div>
-&nbsp;<a class="Comment" href="vim9.html#:final">:final</a>&nbsp;と&nbsp;<a class="Comment" href="eval.html#:const">:const</a>&nbsp;を使用して、定数を宣言できます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final matches = []&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 後でこのリストに追加する<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const names = ['Betty', 'Peter']&nbsp;&nbsp;# 変更できない</div>
-&nbsp;<a class="Comment" href="vim9.html#:final">:final</a>&nbsp;は&nbsp;<a class="Comment" href="eval.html#:finally">:finally</a>&nbsp;の略語として使用することはできません。<br>
- 変数と関数のスコープは、明示しない限りスクリプトローカルです。<br>
- 関数を引数の型、戻り値の型とともに宣言します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallMe(count: number, message: string): bool</div>
- 関数は&nbsp;<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;なしで呼び出します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writefile(['done'], 'file.txt')</div>
- 古い Exコマンドは使用できません:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="various.html#:Print">:Print</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="insert.html#:append">:append</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="change.html#:change">:change</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="change.html#:d">:d</a>&nbsp;&nbsp;直接 'd' か 'p' かが続いているもの。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="insert.html#:insert">:insert</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="motion.html#:k">:k</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="term.html#:mode">:mode</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vi_diff.html#:open">:open</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="change.html#:s">:s</a>&nbsp;&nbsp;フラグのみ与えて使用されたとき<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="change.html#:t">:t</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="editing.html#:xit">:xit</a><br>
- 一部のコマンド、特に制御構文として使われるコマンドは、省略することはできませ<br>
&nbsp;&nbsp;ん。例えば、<a class="Comment" href="eval.html#:throw">:throw</a>&nbsp;を&nbsp;<a class="Comment" href="eval.html#:th">:th</a>&nbsp;と書くことはできません。&nbsp;<a class="Constant" href="vim9.html#vim9-no-shorten" name="vim9-no-shorten">vim9-no-shorten</a><br>
- 波括弧変数は使用できません。<br>
- コマンドの前に範囲指定を置くときは、コロン (:) を前置しなくてはなりません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:%s/this/that</div>
- &quot;@r&quot; としてレジスタを実行することはできません。コロン (:) を前置するか、<br>
&nbsp;&nbsp;<a class="Comment" href="eval.html#:exe">:exe</a>&nbsp;を使ってください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:exe @a</div>
- 特に指定しない限り、最新の&nbsp;<a class="Identifier" href="eval.html#scriptversion">scriptversion</a>&nbsp;が使われます。<br>
- 式による指定のマッピングを定義する際は、その式はそのマッピングが定義されたス<br>
&nbsp;&nbsp;クリプトのコンテキストで評価されます。<br>
<br>
<span class="PreProc"># から始まるコメント</span><br>
<br>
旧来の Vim script のコメントは、ダブルクォーテーションで始めます。Vim9 script<br>
のコメントは # で始めます。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 宣言<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var count = 0&nbsp;&nbsp;# 出現回数</div>
<br>
これは、ダブルクォーテーションは文字列の開始を表す文字でもあるからです。多くの<br>
場所、特に改行を含む式の途中では、文字列とコメントの両方が現れるため、どちらを<br>
意味しているのかわかりにくくなってしまいます。この混乱を避けるために、Vim9<br>
script では、# のみをコメントとして認識します。このコメント形式はシェルスクリ<br>
プトやPythonのコードと同じです。<br>
<br>
Vi において # は行番号付きでテキストを表示します。Vim9 script では、代わりに<br>
<a class="Comment" href="various.html#:number">:number</a>&nbsp;を使用します。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:101 number</div>
<br>
可読性を向上するために、コマンドと #、コメント文の間にはスペースをおいてくださ<br>
い:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = value # コメント<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = value# エラー!</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1170" name="E1170">E1170</a><br>
コメントを #{ で始めてはいけません。旧来の Vim script の辞書リテラルと似てお<br>
り、どちらか判別がつきにくいところではエラーになるからです。折り畳みの開始に使<br>
える #{{ "{{" }} や #{{ "{{{" }} はコメントの始まりになっても良いです。<br>
<br>
スクリプトファイルの先頭では、Vim は&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;コマンドが見つかるまでそのス<br>
クリプトが&nbsp;<a class="Identifier" href="vim9.html#Vim9">Vim9</a>&nbsp;script かを知るすべがありません。なのでその行までは旧来のコ<br>
メントを使う必要があります。:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot; 旧来のコメント<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Vim9 のコメント</div>
<br>
これは不恰好なので、<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;を一番最初の行に書くのが良いでしょう:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Vim9 コメント</div>
<br>
旧来の Vim script では # は代替ファイル名としても使われます。Vim9 script で<br>
は、代わりに %% を使う必要があります。## の代わりに %%% を使います。(すべての<br>
引数を意味します)<br>
<br>
<br>
<span class="PreProc">Vim9 関数</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1099" name="E1099">E1099</a><br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義された関数はコンパイルされます。処理の実行は多くの場合、通常の関<br>
数に比べて10倍から100倍ほど速くなります。<br>
<br>
多くのエラーは関数が実行される前に、コンパイルされる段階で検出されます。読みや<br>
すく理解しやすいコードを強制するために、構文は厳密に定められています。<br>
<br>
コンパイルは以下のいずれかのタイミングで実行されます:<br>
- 関数が最初に呼び出されるとき<br>
- 関数が定義された後ろの位置で、スクリプト中に&nbsp;<a class="Comment" href="vim9.html#:defcompile">:defcompile</a>&nbsp;コマンドが見つ<br>
&nbsp;&nbsp;かったとき<br>
- 関数に対してコマンド&nbsp;<a class="Comment" href="vim9.html#:disassemble">:disassemble</a>&nbsp;が実行されたとき<br>
- コンパイルされた関数から呼び出されたり、関数リファレンスとして使用されたとき<br>
&nbsp;&nbsp;(引数と戻り値の型をチェックできるようにするため)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1091" name="E1091">E1091</a>&nbsp;<a class="Constant" href="vim9.html#E1191" name="E1191">E1191</a><br>
もし関数のコンパイルに失敗した場合は、次その関数が呼ばれたときも再度コンパイル<br>
を試みることはなく、代わりに &quot;E1091: Function is not compiled:&nbsp;<span class="Special">{name}</span>&quot; という<br>
エラーを発生させます。<span class="Special">{訳注: 日本語メッセージの場合: &quot;E1091: 関数はコンパイル</span><br>
<span class="Special">されていません: {name}&quot;}</span><br>
コンパイルはまだ作成されていないユーザーコマンドと遭遇したときに失敗するでしょ<br>
う。この場合は&nbsp;<a class="Comment" href="builtin.html#execute()">execute()</a>&nbsp;を使うことでエラーを関数の実行時に発生するようにす<br>
ることができます。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execute('DefinedLater')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;は&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;が持っているようなオプションを持っていません:<br>
&quot;range&quot;、&quot;abort&quot;、&quot;dict&quot; や &quot;closure&quot; のこと。<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義される関数は常にエ<br>
ラーが発生し次第、実行を中断します (<a class="Comment" href="various.html#:silent!">:silent!</a>&nbsp;がコマンドに対して使われた場合<br>
やエラーが&nbsp;<a class="Comment" href="eval.html#:try">:try</a>&nbsp;ブロック内で捕捉された場合でない限り) 。また与えられた「範<br>
囲」も受け取らず、&quot;dict&quot; 属性を持つ関数になることもできません。そして常にク<br>
ロージャとなれます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-no-dict-function" name="vim9-no-dict-function">vim9-no-dict-function</a><br>
いずれ、「辞書関数」機構を置き換えるクラスが追加されるでしょう。当面は明示的に<br>
辞書を渡す必要があります。:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def DictFunc(self: dict&lt;any&gt;, arg: string)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo self[arg]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ad = {item: 'value', func: DictFunc}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ad.func(ad, 'item')</div>
<br>
一方、旧来の辞書関数を呼ぶことはできます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func Legacy() dict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo self.value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfunc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallLegacy()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var d = {func: Legacy, value: 'text'}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.func()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1096" name="E1096">E1096</a>&nbsp;<a class="Constant" href="vim9.html#E1174" name="E1174">E1174</a>&nbsp;<a class="Constant" href="vim9.html#E1175" name="E1175">E1175</a><br>
引数の型と戻り値の型を指定する必要があります。型には &quot;any&quot; を指定することがで<br>
き、型のチェックは旧来の関数と同様に実行時に行われます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1106" name="E1106">E1106</a><br>
引数を参照する際は、他のプログラミング言語と同様、&quot;a:&quot; をつけずに名前だけで指定<br>
することができます。<br>
引数辞書 &quot;a:&quot; と 引数リスト &quot;a:000&quot; はありません。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-variable-arguments" name="vim9-variable-arguments">vim9-variable-arguments</a>&nbsp;<a class="Constant" href="vim9.html#E1055" name="E1055">E1055</a>&nbsp;<a class="Constant" href="vim9.html#E1160" name="E1160">E1160</a>&nbsp;<a class="Constant" href="vim9.html#E1180" name="E1180">E1180</a><br>
可変長引数を定義する場合は TypeScript のように、最後の引数として名前とlist型で<br>
定義します。例えば、数値の可変長引数の例は以下のとおりです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc(...itemlist: list&lt;number&gt;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for item in itemlist<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...</div>
<br>
関数の引数が任意 (引数に既定値が指定されている場合) のときは、その引数に<br>
<a class="Comment" href="eval.html#v:none">v:none</a>&nbsp;を渡すことでその既定値を使うことができます。これは既定値を使いたい引数<br>
の後ろの引数に値を指定したいときに便利です。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc(one = 'one', last = 'last')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyFunc(v:none, 'LAST')&nbsp;&nbsp;# 第 1 引数は既定値の 'one' を使う</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-ignored-argument" name="vim9-ignored-argument">vim9-ignored-argument</a>&nbsp;<a class="Constant" href="vim9.html#E1181" name="E1181">E1181</a><br>
引数 &quot;_&quot; (アンダースコア) は引数を無視するのに使えます。これは使わないが呼び出<br>
す際に一致するように引数を与えないといけないようなコールバックにおいて一番便利<br>
です。例えば、map() を使っていて、キーと値の 2 つの引数が与えられる時に引数の<br>
キーを無視するには:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map(numberList, (_, v) =&gt; v * 2)</div>
引数に &quot;_&quot; を複数回使ってもエラーにはなりません。また、型も指定する必要はあり<br>
ません。<br>
<br>
<br>
<span class="PreProc">関数と変数はデフォルトでスクリプトローカル</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-scopes" name="vim9-scopes">vim9-scopes</a><br>
Vim9 script でスクリプト直下に&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;や&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;を使って関数を定義する<br>
と、関数はプリフィックス &quot;s:&quot; をつけた際のように、スクリプトローカルで定義され<br>
ます。グローバルスコープの関数や変数を定義するにはプリフィックス &quot;g:&quot; をつける<br>
必要があります。 スクリプト内の関数のうち他のスクリプトからインポートされるも<br>
のとオートロードスクリプト内の関数について、他のスクリプトで利用できるようにす<br>
るためには &quot;export&quot; をつける必要があります。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def ThisFunction()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# スクリプトローカル<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def g:ThatFunction()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# グローバル<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export def Function()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # import と import autoload 関数</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1058" name="E1058">E1058</a>&nbsp;<a class="Constant" href="vim9.html#E1075" name="E1075">E1075</a><br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義される関数内で&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;か&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;でネストした関数を名前空間の<br>
指定なしに作成したときは、ネストした関数はその関数が定義されたブロックにローカ<br>
ルな関数になります。またその関数は&nbsp;<a class="Comment" href="builtin.html#function()">function()</a>&nbsp;に文字列を用いて渡すことはできず、<br>
その関数自身の参照を渡さなければいけません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Outer()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Inner()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'inner'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Fok = function(Inner)&nbsp;&nbsp;&nbsp;&nbsp; # OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Fbad = function('Inner')&nbsp;&nbsp;# 動作しない</div>
<br>
詳細: これは &quot;Inner&quot; が実際には生成された名前&nbsp;<span class="Special">{訳注: &lt;lambda&gt;XXX のこと。}</span>&nbsp;を<br>
もつ関数への関数参照になるからです。<br>
<br>
関数の中でスクリプトローカル関数を定義することはできません。代わりにローカル関<br>
数を定義して、それをスクリプトローカルな Funcref (これはスクリプトレベルで定義<br>
されていないといけません) に代入することができます。グローバル関数はプリフィッ<br>
クス &quot;g:&quot; を使うことで定義できます。<br>
<br>
関数をプリフィックス &quot;s:&quot; や &quot;g:&quot; をつけずに参照した場合、Vim は関数を次のよう<br>
に探します:<br>
- 同じ関数の中、ブロックスコープの中<br>
- スクリプトスコープの中<br>
<br>
インポートされた関数は、<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;コマンドで決まる名前を前置して見つけられます。<br>
<br>
スクリプトローカル関数の参照が &quot;s:&quot; をつけることなく使えるので、スクリプトロー<br>
カル関数の名前はプリフィックス &quot;s:&quot; をつけて宣言した場合でも大文字から始まる必<br>
要があります。旧来の Vim script では &quot;s:funcref&quot; とすることができました。なぜ<br>
なら、&quot;s:funcref&quot; を &quot;funcref&quot; として参照することができなかったからです。しか<br>
し Vim9 script ではそれが可能なので、組み込み関数との名前の干渉を避けるため<br>
に &quot;s:Funcref&quot; のように名前が指定される必要があります。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-s-namespace" name="vim9-s-namespace">vim9-s-namespace</a>&nbsp;<a class="Constant" href="vim9.html#E1268" name="E1268">E1268</a><br>
Vim9 script において、スクリプトレベルでのプリフィックス &quot;s:&quot; の使用はサポート<br>
されていません。プリフィックスのない全ての関数と変数は全てスクリプトローカルに<br>
なります。<br>
<br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義される関数内においては、&quot;s:&quot; の使用はスクリプト依存です: 旧来の<br>
Vim script 内ではスクリプトローカルな関数と変数に対して &quot;s:&quot; を使いますが、<br>
Vim9 script 内では使いません。これはこのドキュメントの以下の説明でも同様です。<br>
<br>
旧来の関数内においては、スクリプトローカルなアイテムに対しての &quot;s:&quot; の指定は従<br>
来通り必要です。これはスクリプトが Vim9 script であろうが旧来の Vim script で<br>
あろうが関係ありません。<br>
<br>
いずれの場合でも、関数は使用されるよりも前に定義されていなくてはなりません。使<br>
用されるタイミングは、コマンド&nbsp;<a class="Comment" href="vim9.html#:defcompile">:defcompile</a>&nbsp;によってコンパイルされるとき、ま<br>
たは関数を呼び出す関数がコンパイルされているとき（戻り値の型を確認するため）で<br>
す。<br>
<br>
その結果として、名前空間を持たない関数や変数は通常、スクリプト内で定義されてい<br>
るか、インポートされたものかのどちらかで見つけることができます。グローバルな関<br>
数や変数はどこでも定義できます (どこで定義されているか、見つかるといいですね！<br>
しばしば&nbsp;<a class="Identifier" href="various.html#:verbose">:verbose</a>&nbsp;を使ってどこで最後に値がセットされたか調べることができま<br>
す) 。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1102" name="E1102">E1102</a><br>
グローバル関数は引き続き、ほとんどいつでも定義し、削除することができます。Vim9<br>
script でのスクリプトローカル関数は、スクリプトが読み込まれたときに一度定義さ<br>
れたきり、そのスクリプト内で削除や置き換えはできません (スクリプトローカル関数の<br>
削除や置き換えはスクリプトの再読み込みをすることでできます)。<br>
<br>
関数のコンパイルや、関数の呼び出しが未定義の関数に遭遇したとき、自動コマンド<br>
<a class="Identifier" href="autocmd.html#FuncUndefined">FuncUndefined</a>&nbsp;は呼び出されません。必要であればオートロード関数を使用したり、<br>
旧来の関数を呼び出すことで&nbsp;<a class="Identifier" href="autocmd.html#FuncUndefined">FuncUndefined</a>&nbsp;イベントが発生します。<br>
<br>
<br>
<span class="PreProc">デフォルトでは Vim9 script の再読み込みにより関数と変数がクリアされる</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-reload" name="vim9-reload">vim9-reload</a>&nbsp;<a class="Constant" href="vim9.html#E1149" name="E1149">E1149</a>&nbsp;<a class="Constant" href="vim9.html#E1150" name="E1150">E1150</a><br>
旧来の Vim script を2回目に読み込んだときは、何も削除されることはなく、コマン<br>
ドはすでにある変数や関数を置き換えて新しいものを作り、置き換えられなかったもの<br>
はそのまま残しておきます。<br>
<br>
Vim9 script を2回目に読み込んだときは、存在するすべてのスクリプトローカルの関<br>
数や変数は削除され、クリーンな状態から開始します。これはプラグインを開発中に、<br>
新しいバージョンを試す際には便利です。いずれかの名前を変えたとしても、古い名前<br>
が残る心配はありません。<br>
<br>
消さずに残すには、以下を使用します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script noclear</div>
<br>
これを使用することで、再読み込みの際に任意の場所で&nbsp;<a class="Comment" href="repeat.html#:finish">finish</a>&nbsp;コマンドにより脱出<br>
することができます。例えば、バッファローカルオプションが関数に設定され、その関<br>
数を2回以上定義する必要がないとき:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script noclear<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setlocal completefunc=SomeFunc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists('*SomeFunc')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finish<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def SomeFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....</div>
<br>
<br>
<span class="PreProc">:var、:final や :const で宣言する変数</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-declaration" name="vim9-declaration">vim9-declaration</a>&nbsp;<a class="Constant" href="vim9.html#:var" name=":var">:var</a>&nbsp;<a class="Constant" href="vim9.html#E1079" name="E1079">E1079</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1017" name="E1017">E1017</a>&nbsp;<a class="Constant" href="vim9.html#E1020" name="E1020">E1020</a>&nbsp;<a class="Constant" href="vim9.html#E1054" name="E1054">E1054</a>&nbsp;<a class="Constant" href="vim9.html#E1087" name="E1087">E1087</a>&nbsp;<a class="Constant" href="vim9.html#E1108" name="E1108">E1108</a>&nbsp;<a class="Constant" href="vim9.html#E1124" name="E1124">E1124</a><br>
ローカル変数は&nbsp;<a class="Comment" href="vim9.html#:var">:var</a>&nbsp;で定義する必要があります。ローカル定数は&nbsp;<a class="Comment" href="vim9.html#:final">:final</a>&nbsp;または<br>
<a class="Comment" href="eval.html#:const">:const</a>&nbsp;で定義する必要があります。このセクションでは、両者を &quot;変数&quot; と呼ぶこ<br>
とにします。<br>
<br>
変数はスクリプトローカルや、関数、コードブロックのスコープで定義できます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var script_var = 123<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def SomeFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var func_var = script_var<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if cond<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var block_var = func_var<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</div>
<br>
変数は、定義されたコードブロックか、ネストされた配下のブロックで参照することが<br>
できます。コードブロックが終わったあとの処理から参照することはできません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if cond<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var inner = 5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var inner = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo inner&nbsp;&nbsp;# エラー!</div>
<br>
参照したい場合には、ブロックよりも前で宣言しなくてはなりません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var inner: number<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if cond<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner = 5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo inner</div>
<br>
こちらの方が単純な値については簡潔で早くはありますが。:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var inner = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if cond<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner = 5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo inner</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1025" name="E1025">E1025</a>&nbsp;<a class="Constant" href="vim9.html#E1128" name="E1128">E1128</a><br>
意図的に続く処理から変数を隠したいとき、ブロックを使うことができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var temp = 'temp'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo temp&nbsp;&nbsp;# エラー!</div>
<br>
これは特にユーザーコマンドで便利です:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -range Rename {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var save = @a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @a = 'some expression'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo 'do something with ' .. @a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @a = save<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<br>
また、自動コマンドでも便利です:<br>
<div class="helpExample">&nbsp;&nbsp; au BufWritePre *.go {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var save = winsaveview()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; silent! exe ':%! some formatting command'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; winrestview(save)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</div>
<br>
多分&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義される関数を使う方が良く動くでしょうが。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1022" name="E1022">E1022</a>&nbsp;<a class="Constant" href="vim9.html#E1103" name="E1103">E1103</a>&nbsp;<a class="Constant" href="vim9.html#E1130" name="E1130">E1130</a>&nbsp;<a class="Constant" href="vim9.html#E1131" name="E1131">E1131</a>&nbsp;<a class="Constant" href="vim9.html#E1133" name="E1133">E1133</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1134" name="E1134">E1134</a><br>
変数を型を指定し、初期値なしで宣言した場合、変数は false (bool 型のとき)、空<br>
(string、list、dict などの型のとき)、あるいはゼロ (number、any などの型のとき)<br>
で初期化されます。これは &quot;any&quot; 型を使う時に特に重要で、初期値は数字のゼロとな<br>
ります。例えば、リストを宣言したとき、要素を追加することができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var myList: list&lt;number&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList-&gt;add(7)</div>
<br>
変数を null、例えば&nbsp;<span class="Comment">null_list</span>、で初期化することは変数を初期化しないこととは<br>
異なります。これはエラーになります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var myList = null_list<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList-&gt;add(7)&nbsp;&nbsp;# E1130: null リストには追加できません</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1016" name="E1016">E1016</a>&nbsp;<a class="Constant" href="vim9.html#E1052" name="E1052">E1052</a>&nbsp;<a class="Constant" href="vim9.html#E1066" name="E1066">E1066</a><br>
<br>
Vim9 script では&nbsp;<a class="Comment" href="eval.html#:let">:let</a>&nbsp;は使用できません。すでに存在する変数に対してはコマンド<br>
を使用せずに代入します。実際に宣言されることがないので、グローバル変数、ウィン<br>
ドウ変数、タブ変数、バッファ変数、そして Vim の定義済変数についてもコマンドを<br>
使用せずに代入します。またそれらの変数は&nbsp;<a class="Comment" href="eval.html#:unlet">:unlet</a>&nbsp;によって削除することもできま<br>
す。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1065" name="E1065">E1065</a><br>
変数を&nbsp;<span class="Comment">:va</span>&nbsp;で宣言することはできず、それは必ず完全な名前の&nbsp;<a class="Comment" href="vim9.html#:var">:var</a>&nbsp;として書か<br>
れなければなりません。これはコードを読みやすくするためのものです。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1178" name="E1178">E1178</a><br>
<a class="Comment" href="eval.html#:lockvar">:lockvar</a>&nbsp;はローカル変数に対しては動作しません。代わりに&nbsp;<a class="Comment" href="eval.html#:const">:const</a>&nbsp;か&nbsp;<a class="Comment" href="vim9.html#:final">:final</a><br>
を使ってください。<br>
<br>
<a class="Comment" href="builtin.html#exists()">exists()</a>&nbsp;関数と&nbsp;<a class="Comment" href="builtin.html#exists_compiled()">exists_compiled()</a>&nbsp;関数はローカル変数あるいは引数に対しては<br>
動作しません。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1006" name="E1006">E1006</a>&nbsp;<a class="Constant" href="vim9.html#E1041" name="E1041">E1041</a>&nbsp;<a class="Constant" href="vim9.html#E1167" name="E1167">E1167</a>&nbsp;<a class="Constant" href="vim9.html#E1168" name="E1168">E1168</a>&nbsp;<a class="Constant" href="vim9.html#E1213" name="E1213">E1213</a><br>
変数と関数と関数の引数は、同じスクリプトファイル内で、すでに定義された、または<br>
インポートされた変数と関数をシャドーイングすることはできません。一方で変数は<br>
Ex コマンドをシャドーイングするので、必要であれば変数の名前を変更してくださ<br>
い。<br>
<br>
グローバル変数の前には、スクリプトレベルでも &quot;g:&quot; を付けなければなりません。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var script_local = 'text'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:global = 'value'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Funcref = g:ThatFunction</div>
<br>
グローバル関数は必ず先頭に &quot;g:&quot; を付けなければなりません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def g:GlobalFunc(): string<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 'text'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo g:GlobalFunc()</div>
プリフィックス &quot;g:&quot; はオートロード関数に対しては必要ありません。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-function-defined-later" name="vim9-function-defined-later">vim9-function-defined-later</a><br>
グローバル関数はプリフィックス &quot;g:&quot; なしに呼び出すことができますが、それらはコ<br>
ンパイル時に存在していなければなりません。プリフィックスを &quot;g:&quot; をつけること<br>
で、関数が後で定義されても良くなります。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallPluginFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists('g:loaded_plugin')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:PluginFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
もしこのようにすると、たとえ &quot;g:loaded_plugin&quot; が存在しない場合でも、コンパイ<br>
ル時に &quot;PluginFunc&quot; が存在しないというエラーが発生します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallPluginFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists('g:loaded_plugin')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PluginFunc()&nbsp;&nbsp; # エラー、関数が見つからない<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<a class="Comment" href="builtin.html#exists_compiled()">exists_compiled()</a>&nbsp;を使うことでエラーを回避できますが、この場合は<br>
&quot;g:loaded_plugin&quot; が後で定義されている場合でもその関数は呼ばれません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallPluginFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists_compiled('g:loaded_plugin')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PluginFunc()&nbsp;&nbsp; # 関数が呼ばれることはないかもしれない<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
現在、<span class="Comment">&amp;opt = value</span>&nbsp;は &quot;opt&quot; オプションに値を設定する目的で使用されているた<br>
め、<a class="Comment" href="change.html#:substitute">:substitute</a>&nbsp;コマンドをリピートする目的で &quot;:&amp;&quot; を使用することはできません。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-unpack-ignore" name="vim9-unpack-ignore">vim9-unpack-ignore</a><br>
アンパック代入において、アンダースコアは、関数の引数を無視するのと似たように<br>
リストの要素を無視するのに使えます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[a, _, c] = theList</div>
残りの要素全部を無視するには:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[a, b; _] = longList</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1163" name="E1163">E1163</a>&nbsp;<a class="Constant" href="vim9.html#E1080" name="E1080">E1080</a><br>
アンパックの記法を用いて、一つ以上の変数を一度に宣言することが可能です。<br>
それぞれの変数は型を持つか、値から型を推測することができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var [v1: number, v2] = GetValues()</div>
これは値を持つリストがある時にのみ利用してください。1行に 1変数を宣言する方が<br>
より読みやすく、後の変更も行いやすいです。<br>
<br>
<br>
<span class="PreProc">定数</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-const" name="vim9-const">vim9-const</a>&nbsp;<a class="Constant" href="vim9.html#vim9-final" name="vim9-final">vim9-final</a><br>
定数の働きは言語によって異なります。別の値を代入できない変数を定数とする場合も<br>
あります。JavaScript がその一例です。また、値そのものを不変にすることもあり、<br>
例えばリスト定数の内容を変更することができないとしている場合もあります。<br>
Vim9ではこのどちらも定義することができます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1021" name="E1021">E1021</a><br>
変数とその値、両方を定数とするには、<a class="Comment" href="eval.html#:const">:const</a>&nbsp;を使用します。何らかの複合的な値<br>
が変更できないようにする際に使用します。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const myList = [1, 2]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList = [3, 4]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList[0] = 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList-&gt;add(3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# エラー!</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:final" name=":final">:final</a>&nbsp;<a class="Constant" href="vim9.html#E1125" name="E1125">E1125</a><br>
変数の変更のみを禁止するには、<a class="Comment" href="vim9.html#:final">:final</a>&nbsp;を使用します。この場合は、中の値自体を<br>
変えることはできます。Java でよく知られるものです。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final myList = [1, 2]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList = [3, 4]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList[0] = 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList-&gt;add(3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# OK</div>
<br>
一般に、定数はすべて大文字 (例: ALL_CAPS) で書かれますが、必ずしもそうしなくて<br>
も構いません。<br>
<br>
定数宣言は値そのものにのみ適用され、参照先の変数には影響しません。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final females = [&quot;Mary&quot;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const NAMES = [[&quot;John&quot;, &quot;Peter&quot;], females]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES[0] = [&quot;Jack&quot;]&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES[0][0] = &quot;Jack&quot;&nbsp;&nbsp;&nbsp;&nbsp;# エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES[1] = [&quot;Emma&quot;]&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES[1][0] = &quot;Emma&quot;&nbsp;&nbsp;&nbsp;&nbsp;# OK, females[0] == &quot;Emma&quot;</div>
<br>
<br>
<span class="PreProc">:call と :eval は不要に</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1190" name="E1190">E1190</a><br>
関数は&nbsp;<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;なしで呼ぶことができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writefile(lines, 'file')</div>
<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;は引き続き使用できますが、やめたほうが良いでしょう。<br>
<br>
メソッド呼び出しには&nbsp;<a class="Comment" href="eval.html#eval">eval</a>&nbsp;は必要ありません。Exコマンドと同名の識別子ではない<br>
限り、直接に識別子から呼び出すことができます。関数の場合は、&quot;(&quot; または &quot;-&gt;&quot;の<br>
どちらかを改行せずに続けなければなりません。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList-&gt;add(123)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:myList-&gt;add(123)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1, 2, 3]-&gt;Process()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{a: 1, b: 2}-&gt;Process()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;foobar&quot;-&gt;Process()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&quot;foobar&quot;)-&gt;Process()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'foobar'-&gt;Process()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;('foobar')-&gt;Process()</div>
<br>
一部の関数と Ex コマンドが紛らわしい場合、コロン (:) を前置することでそれが Ex<br>
コマンドであることを明示することができます。例えば、<a class="Comment" href="change.html#:substitute">:substitute</a>&nbsp;コマンドと<br>
<a class="Comment" href="builtin.html#substitute()">substitute()</a>&nbsp;が該当します。<span class="Comment">substitute(</span>&nbsp;で始まる場合は関数呼び出しですが、<br>
コロンを前置することでコマンドを代わりに使用することができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:substitute(pattern (replacement (</div>
<br>
もし式が &quot;!&quot; で始まっているのであれば、それは条件の否定ではなくシェルコマンド<br>
であると解釈されます。したがって、これはシェルコマンドとなります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!shellCommand-&gt;something</div>
&quot;!&quot; を否定として用いるには、式を丸カッコで囲んでください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(!expression)-&gt;Method()</div>
<br>
<span class="Todo">Note</span>&nbsp;変数は使用する前に宣言する必要がありますが、関数は宣言するより前に使用で<br>
きます。これは関数の循環参照を可能にするためです。関数を名前で探さなければなら<br>
ないので、少し効率が悪いです。また、関数名のタイプミスは、関数が呼び出されると<br>
きまで見つかりません。<br>
<br>
<br>
<span class="PreProc">function() は不要に</span><br>
<br>
ユーザー定義の関数は、<a class="Comment" href="builtin.html#function()">function()</a>&nbsp;を使わずとも関数リファレンスとして使用する<br>
ことができます。引数の型と戻り値の型がチェックされます。関数はすでに定義されて<br>
いる必要があります。<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Funcref = MyFunction</div>
<br>
<a class="Comment" href="builtin.html#function()">function()</a>&nbsp;を使って &quot;func&quot; 型のリファレンスを得た場合、その関数は任意の個数<br>
の引数と任意の戻り値の型 (void を含めて) を持つものとされます。この場合、もし<br>
関数名がクォートで囲まれてるなら、その関数は後から宣言できます。<br>
<br>
<br>
<span class="PreProc">ラムダ式には -&gt; の代わりに =&gt; を使う</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-lambda" name="vim9-lambda">vim9-lambda</a><br>
旧来のスクリプトでは &quot;-&gt;&quot; はメソッド呼び出しとラムダ式で混同するおそれがありま<br>
す。また、&quot;{&quot; が見つかったとき、パーサーはラムダ式と辞書の開始を見分けねばなら<br>
ず、そしてそれは引数の型指定により複雑になっています。<br>
<br>
この問題を回避するため、Vim9 script ではラムダ式のために違う書式を使用し、それ<br>
は JavaScript に似ています:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Lambda = (arg) =&gt; expression<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Lambda = (arg): type =&gt; expression</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1157" name="E1157">E1157</a><br>
&quot;=&gt;&quot; まで含めて、ラムダ式の引数の定義の中では改行することはできません (Vim が<br>
丸カッコで囲まれた式とラムダ式の引数の区別をつけられるようにするため)。 これは<br>
OKです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(list, (k, v) =&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v &gt; 0)</div>
以下のように記述することはできません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(list, (k, v)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; v &gt; 0)</div>
以下のように記述することもできません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(list, (k,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v) =&gt; v &gt; 0)</div>
ただし、バックスラッシュを使ってパースする前に行をつなげることができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(list, (k,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; v)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&gt; v &gt; 0)</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-lambda-arguments" name="vim9-lambda-arguments">vim9-lambda-arguments</a>&nbsp;<a class="Constant" href="vim9.html#E1172" name="E1172">E1172</a><br>
旧来の Vim script においては、ラムダ関数はいくつもの余分な引数を与えて呼ぶこと<br>
ができ、そしてその余分な引数を使わないことに対しての警告をする方法がありません<br>
でした。Vim9 script では引数の数は必ず一致しなければなりません。もし任意の<br>
引数、またはその他の引数を受け入れたい場合は、関数が&nbsp;<a class="Identifier" href="vim9.html#vim9-variable-arguments">vim9-variable-arguments</a><br>
を受け入れられるようにする &quot;..._&quot; を使ってください。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Callback = (..._) =&gt; 'anything'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo Callback(1, 2, 3)&nbsp;&nbsp;# &quot;anything&quot; を表示する</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#inline-function" name="inline-function">inline-function</a>&nbsp;<a class="Constant" href="vim9.html#E1171" name="E1171">E1171</a><br>
加えて、ラムダ式には {} に複数のステートメントを含むことができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Lambda = (arg) =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:was_called = 'yes'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return expression<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
これはタイマーに便利です。例えば:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var count = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var timer = timer_start(500, (_) =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; count += 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echom 'Handler called ' .. count<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, {repeat: 3})</div>
<br>
閉じの &quot;}&quot; は行の先頭にこなければなりません。後ろに他の文字が続いても良いで<br>
す。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var d = mapnew(dict, (k, v): string =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 'value'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</div>
いかなるコマンドも &quot;{&quot; の後ろに続いてはいけません。コメントのみが利用可能で<br>
す。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#command-block" name="command-block">command-block</a>&nbsp;<a class="Constant" href="vim9.html#E1026" name="E1026">E1026</a><br>
ブロックはユーザーコマンドを定義するのにも使えます。ブロックの内側では Vim9<br>
script の文法が使われます。<br>
<br>
もしブロックが辞書を含むのであれば、辞書の閉じカッコは行頭に書かれてはいけませ<br>
ん。さもなくば閉じカッコがブロックの終了としてパースされてしまいます。これは動<br>
作しません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command NewCommand {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; g:mydict = {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'key': 'value',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;# エラー: ブロックの終了として認識される<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</div>
これを避けるには、'}' を最後の要素の後ろにおいてください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command NewCommand {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; g:mydict = {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'key': 'value' }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</div>
<br>
根拠: &quot;}&quot; がコマンドの後にきてはならないのは、ブロックの閉じカッコを見つけるの<br>
にコマンドのパースが必要だろうからです。一貫性のために、いかなるコマンドも &quot;{&quot;<br>
に続けることはできません。残念ながら、これは &quot;() =&gt; { command }&quot; が動作せず、<br>
常に改行が必要であることを意味します。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-curly" name="vim9-curly">vim9-curly</a><br>
辞書リテラルの &quot;{&quot; がステートメントブロックと認識されてしまうのを回避するため<br>
には、括弧で包みます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Lambda = (arg) =&gt; ({key: 42})</div>
<br>
さらに、コマンドブロックの開始と混同してしまう場合:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key: value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })-&gt;method()</div>
<br>
<br>
<span class="PreProc">自動行継続</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-line-continuation" name="vim9-line-continuation">vim9-line-continuation</a>&nbsp;<a class="Constant" href="vim9.html#E1097" name="E1097">E1097</a><br>
多くの場合、式が次の行に続くことは明らかです。継続行の先頭に行継続のためのバッ<br>
クスラッシュ (<a class="Identifier" href="repeat.html#line-continuation">line-continuation</a>&nbsp;参照) を置く必要はありません。例えば、複数行<br>
にまたぐリストの場合:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist = [<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'one',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'two',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</div>
辞書の場合:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mydict = {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;one: 1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;two: 2,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
関数の呼び出しで:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = Func(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</div>
<br>
角カッコ []、波カッコ {}、または丸カッコの中‘以外で’二項演算子御使用する場<br>
合、その前後で改行することができます。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var text = lead<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .. middle<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .. end<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var total = start +<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end -<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;correction<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = positive<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;? PosFunc(arg)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: NegFunc(arg)</div>
<br>
&quot;-&gt;&quot; を使用したメソッド呼び出し、そしてドット (.) を使用したメンバー参照の場<br>
合、その前に改行を置くことができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = GetBuilder()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;BuilderSetWidth(333)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;BuilderSetHeight(777)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;BuilderBuild()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = MyDict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.member</div>
<br>
複数のコマンドのリストを引数に持つコマンドでは、行の先頭に置かれた文字 | は行<br>
継続を表します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;autocmd BufNewFile *.match if condition<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp; echo 'match'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| endif</div>
<br>
<span class="Todo">Note</span>&nbsp;これはヒアドキュメントの最初の行は | で始めることができないことを意味しま<br>
す:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var lines =&lt;&lt; trim END<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | これは動作しない<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END</div>
ヒアドキュメントの先頭行を空行にする、あるいはヒアドキュメントを使わないように<br>
してください。あるいは一時的にフラグ &quot;C&quot; を&nbsp;<a class="Type" href="options.html#'cpoptions'">'cpoptions'</a>&nbsp;に追加してください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set cpo+=C<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var lines =&lt;&lt; trim END<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | これは動作する<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set cpo-=C</div>
もしヒアドキュメントが関数の中で使われているのであれば、<a class="Type" href="options.html#'cpoptions'">'cpoptions'</a>&nbsp;は :def の<br>
前で変更され、かつ :enddef の後ろで元に戻されなければなりません。<br>
<br>
例えば長い Ex コマンドを分割しているときのような、依然として行連結にバックス<br>
ラッシュが必要な場所では、'#\ ' でコメントを開始することができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syn region Text<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ start='foo'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#\ コメント<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ end='bar'</div>
これは旧来の Vim script で '&quot;\ ' が使われているのと似ています。またこれはバッ<br>
クスラッシュ抜きで行連結が使用され、かつ行が | で開始しているときにも必要で<br>
す:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;au CursorHold * echom 'BEFORE bar'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#\ 何かのコメント<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| echom 'AFTER bar'</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1050" name="E1050">E1050</a><br>
行頭の演算子と識別できるようにするために、範囲指定の前にはコロンを置きま<br>
す。&quot;start&quot; と &quot;print&quot; をつなげる例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = start<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ print</div>
これは以下の記述と同じです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = start + print</div>
<br>
次のように書くと、&quot;start&quot; を代入して、1行表示します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = start<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:+ print</div>
<br>
「範囲」の後ろには必ず Ex コマンドが続かなければなりません。コロンを付けてい<br>
ない時は&nbsp;<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;抜きで関数を呼ぶことができますが、「範囲」の後ろではそれが必<br>
要です。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:% call MyFunc()<br>
<br>
<span class="Todo">Note</span>&nbsp;<a class="Identifier" href="editing.html#+cmd">+cmd</a>&nbsp;の引数にはコロンは不要です:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edit +6 fname</div>
<br>
関数の定義部においても、引数の間で改行をおくことができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text: string,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;separator = '-'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;): string</div>
<br>
継続行を識別することは容易ではないため、コマンドの解析はより厳格化されていま<br>
す。例えば、一行目のエラーにより、2行目は別のコマンドとみなされます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_create(some invalid expression, {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit_cb: Func})</div>
ここで &quot;exit_cb: Func})&quot; は実際に有効なコマンドです: 変更をファイル<br>
&quot;_cb: Func})&quot; に保存して閉じます。Vim9 script の中ではこの種のミスを回避するた<br>
めに、コマンド名と引数の間にはスペースを置かなくてはなりません。<br>
<a class="Constant" href="vim9.html#E1144" name="E1144">E1144</a><br>
<br>
ただし、コマンドの引数に置いたコマンドは認識されません。例えば、&quot;windo echo<br>
expr&quot; に続く &quot;expr&quot; の式の中で改行しても認識されません。<br>
<br>
<br>
<span class="Todo">Notes</span>:<br>
- &quot;enddef&quot; は継続行の先頭に置くことはできません。それは関数の終端を意味します。<br>
- 代入式の左辺を複数の行に分割できません。特にリストのアンパック&nbsp;<a class="Identifier" href="eval.html#:let-unpack">:let-unpack</a><br>
&nbsp;&nbsp;を使用する場合は注意が必要です。これはOKです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[var1, var2] =<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func()</div>
&nbsp;&nbsp;&nbsp;以下のように記述することはできません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[var1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var2] =<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func()</div>
-&nbsp;<a class="Comment" href="eval.html#:echo">:echo</a>&nbsp;や&nbsp;<a class="Comment" href="eval.html#:execute">:execute</a>&nbsp;のようなコマンドの引数は複数の行に分割できません。これ<br>
&nbsp;&nbsp;はOKです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo [1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2] [3,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4]</div>
&nbsp;&nbsp;&nbsp;以下のように記述することはできません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo [1, 2]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[3, 4]</div>
- いくつかの場合、特に&nbsp;<a class="Comment" href="windows.html#:windo">:windo</a>&nbsp;のようなコマンドが他のコマンドの引数として使わ<br>
&nbsp;&nbsp;れるような場合では、Vim にとってコマンドのパースが困難です。このような場合で<br>
&nbsp;&nbsp;では、バックスラッシュを使った行継続を使わなければなりません。<br>
<br>
<br>
<span class="PreProc">ホワイトスペース</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1004" name="E1004">E1004</a>&nbsp;<a class="Constant" href="vim9.html#E1068" name="E1068">E1068</a>&nbsp;<a class="Constant" href="vim9.html#E1069" name="E1069">E1069</a>&nbsp;<a class="Constant" href="vim9.html#E1074" name="E1074">E1074</a>&nbsp;<a class="Constant" href="vim9.html#E1127" name="E1127">E1127</a>&nbsp;<a class="Constant" href="vim9.html#E1202" name="E1202">E1202</a><br>
Vim9 script ではホワイトスペースの適切な使用を強制します。これはもはや許可され<br>
ません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name=234&nbsp;&nbsp;&nbsp;&nbsp;# エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name= 234&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name =234&nbsp;&nbsp; # エラー!</div>
&quot;=&quot; の前後にホワイトスペースがなければいけません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = 234&nbsp;&nbsp;# OK</div>
コマンドの後ろでコメントを開始する # の前にもホワイトスペースが置かれなければ<br>
なりません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = 234# エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = 234 # OK</div>
<br>
ホワイトスペースは大抵の演算子の周りで必須です。<br>
<br>
始まりと終わりと除いて、サブリスト (リストのスライス) の &quot;:&quot; の周りにホワイト<br>
スペースが必要です。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherlist = mylist[v : count]&nbsp;&nbsp; # v:count は異なる意味を持つ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherlist = mylist[:]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # リストのコピーを作る<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherlist = mylist[v :]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherlist = mylist[: v]<br>
<br>
ホワイトスペースは許可されません:<br>
- 関数名と &quot;(&quot; の間:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func (arg)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \ (arg)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(arg)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func(arg)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1205" name="E1205">E1205</a><br>
<a class="Comment" href="options.html#:set">:set</a>&nbsp;コマンドでのオプション名と続く &quot;&amp;&quot;、&quot;!&quot;、&quot;&lt;&quot;、&quot;=&quot;、&quot;+=&quot;、&quot;-=&quot; や &quot;^=&quot;<br>
の間にはホワイトスペースは許可されません。<br>
<br>
<br>
<span class="PreProc">波括弧変数の廃止</span><br>
<br>
波括弧変数&nbsp;<a class="Identifier" href="eval.html#curly-braces-names">curly-braces-names</a>&nbsp;は使用できません。<br>
<br>
<br>
<span class="PreProc">コマンド修飾子は無視されない</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1176" name="E1176">E1176</a><br>
コマンド修飾子を使わないコマンドにコマンド修飾子を使うとエラーになります。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1082" name="E1082">E1082</a><br>
同様に、続くコマンドなしにコマンド修飾子を使うことも今はエラーになります。<br>
<br>
<br>
<span class="PreProc">辞書リテラル</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-literal-dict" name="vim9-literal-dict">vim9-literal-dict</a>&nbsp;<a class="Constant" href="vim9.html#E1014" name="E1014">E1014</a><br>
従来、Vim は波括弧 {} で辞書リテラルの表記をサポートしてきました:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let dict = {'key': value}</div>
<br>
後に、辞書にシンプルなキーを使用することが非常に一般的であることが明らかになっ<br>
たため、キーをクォーテーションなしで指定できる表記が後方互換的に導入されまし<br>
た:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let dict = #{key: value}</div>
<br>
しかし、この #{} という表記は他の言語に比べて異色なものです。キーには式よりも<br>
リテラルを使うほうが一般的で、JavaScript が使っている構文を考えると、辞書リテ<br>
ラルに {} の表記を使うほうがずっと便利です:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {key: value}</div>
<br>
これは英数字、アンダースコアとダッシュのキーで利用できます。異なる文字を使用す<br>
る場合は、シングルクォートまたはダブルクォートで囲まれた文字列を使用します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {'key with space': value}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {&quot;key\twith\ttabs&quot;: value}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {'': value}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 空のキー</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1139" name="E1139">E1139</a><br>
キーに式を使用する必要がある場合は、JavaScript と同様に角括弧を使用することが<br>
できます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {[&quot;key&quot; .. nr]: value}</div>
<br>
キーの型には、文字列、数値、真偽値、浮動小数点のいずれかを指定できます。その他<br>
の型の場合はエラーが発生します。[] を使わない場合は文字列として扱われ、先頭の<br>
0 を保持します。[] を使って式が与えられた場合は、式を評価し、文字列に変換しま<br>
す。先頭の 0 は省かれます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {000123: 'without', [000456]: 'with'}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo dict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{'456': 'with', '000123': 'without'}</div>
[] 外ではドットは受け入れられないので、浮動小数点数は [] の中でのみ動作しま<br>
す:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {[00.013]: 'float'}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo dict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{'0.013': 'float'}</div>
<br>
<br>
<span class="PreProc">:xit、:t、:k、:append、:change、:insert の廃止</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1100" name="E1100">E1100</a><br>
これらのコマンドは容易にローカル変数の名前と混同します。<br>
<a class="Comment" href="editing.html#:x">:x</a>&nbsp;や&nbsp;<a class="Comment" href="editing.html#:xit">:xit</a>&nbsp;の代わりに&nbsp;<a class="Comment" href="editing.html#:exit">:exit</a>&nbsp;を使用できます。<br>
<a class="Comment" href="change.html#:t">:t</a>&nbsp;の代わりに&nbsp;<a class="Comment" href="change.html#:copy">:copy</a>&nbsp;を使用できます。<br>
<a class="Comment" href="motion.html#:k">:k</a>&nbsp;の代わりに&nbsp;<a class="Comment" href="motion.html#:mark">:mark</a>&nbsp;を使用できます。<br>
<br>
<span class="PreProc">比較</span><br>
<br>
オプション&nbsp;<a class="Type" href="options.html#'ignorecase'">'ignorecase'</a>&nbsp;は文字列の比較には作用しません。なので、&quot;=~&quot; は &quot;=~#&quot;<br>
と同じように動作します。<br>
<br>
現状では、&quot;is&quot; と &quot;isnot&quot; (<a class="Identifier" href="eval.html#expr-is">expr-is</a>&nbsp;と&nbsp;<a class="Identifier" href="eval.html#expr-isnot">expr-isnot</a>) を文字列に対して使うと<br>
常に偽を返します。旧来の Vim script では文字列の比較を行うだけでしたが、Vim9<br>
script ではそれらは文字列オブジェクトが同一であることをチェックします。文字列<br>
は使われるときに複製されるので、二つの文字列は同一と判定されることはありませ<br>
ん。 (いつか、もし文字列が複製されるのではなく参照カウントで管理されるようにな<br>
ると、この挙動は変更されるかもしれません)<br>
<br>
<br>
<span class="PreProc">エラー後の中断</span><br>
<br>
旧来の Vim script では、エラーに遭遇したとき、Vim は後続の行の実行を続けます。<br>
これは長いエラーの列を生みかねず、そしてそのエラーを止めるための&nbsp;<span class="Special">CTRL-C</span>&nbsp;の入力<br>
が必要になります。Vim9 script ではコマンドの実行は最初のエラーに遭遇した段階で<br>
終了します。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var x = does-not-exist<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'not executed'</div>
<br>
<br>
<span class="PreProc">For ループ</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1254" name="E1254">E1254</a><br>
ループ変数は先に宣言されていてはいけません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var i = 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for i in [1, 2, 3]&nbsp;&nbsp; # エラー!</div>
<br>
ただ、グローバル変数を使うことは可能です:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:i = 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for g:i in [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo g:i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor</div>
<br>
旧来の Vim script では、リストのループ内で現在または前の項目を削除するための<br>
for ループをつくるために幾つかのトリックがあります。Vim9 script では、単純にイ<br>
ンデックスを使用することで、リストから削除された場合はスキップされます。<br>
旧来のスクリプトの例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let l = [1, 2, 3, 4]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for i in l<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call remove(l, index(l, i))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor</div>
出力は以下の通り:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4<br>
コンパイルされた Vim9 script での出力は以下の通り:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3<br>
一般的に、反復しているリストを変更してはいけません。必要であれば最初にコピーを<br>
作ります。<br>
<br>
<br>
<span class="PreProc">条件と式</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-boolean" name="vim9-boolean">vim9-boolean</a><br>
条件と式は、他の言語とおよそ同じように扱われます。いくつかの値は旧来の Vim<br>
script と扱いが異なります:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">値&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧来の Vim script&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vim9 script</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; falsy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; falsy<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; truthy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;truthy<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;truthy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;0&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; falsy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;99&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;truthy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;text&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;falsy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; エラー!<br>
<br>
&quot;??&quot; 演算子か &quot;!&quot; を使用している場合はエラーとなることはなく、すべての値は<br>
falsy か truthy として評価されます。これは JavaScript とほぼ同じですが、空の<br>
リストと辞書は falsy として評価されます:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">型&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;真と評価される値</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true, v:true または 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;非0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 非0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;空文字列以外<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blob&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;空ブロブ以外<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;空リスト以外 (JavaScript とは異なります)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dictionary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;空辞書以外 (JavaScript とは異なります)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;関数名があるとき<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;special&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; true または v:true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 非 NULL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 非 NULL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 非 NULL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;非 NULL (TODO: isTrue() が true を返すとき)<br>
<br>
真偽値演算子 &quot;||&quot; と &quot;&amp;&amp;&quot; は、値が真偽値、0または1であることを期待します:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 || false&nbsp;&nbsp; == true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 || 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; == true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 || false&nbsp;&nbsp; == false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &amp;&amp; true&nbsp;&nbsp;&nbsp;&nbsp;== true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &amp;&amp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; == false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8 || 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'yes' &amp;&amp; 0&nbsp;&nbsp; エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[] || 99&nbsp;&nbsp;&nbsp;&nbsp; エラー!</div>
<br>
&quot;!&quot; を使って論理否定をすると、どのような型に対しても結果は真偽値になります。<br>
&quot;!!&quot; と二重論理否定をすることで、あらゆる型を真偽値に変換することができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!'yes'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;== false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!![]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;== false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!![1, 2, 3]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; == true</div>
<br>
文字列の結合に&nbsp;<span class="Comment">..</span>&nbsp;を使用すると、すべての単純型の被演算子は常に文字列に変換さ<br>
れます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'hello ' .. 123&nbsp;&nbsp;== 'hello 123'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'hello ' .. v:true&nbsp;&nbsp;== 'hello true'</div>
<br>
単純型とは、文字列 (string)、数値 (float)、特殊値 (special) と真偽値 (bool) で<br>
す。他の型では&nbsp;<a class="Identifier" href="builtin.html#string()">string()</a>&nbsp;を使う必要があります。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#false" name="false">false</a>&nbsp;<a class="Constant" href="vim9.html#true" name="true">true</a>&nbsp;<a class="Constant" href="vim9.html#null" name="null">null</a>&nbsp;<a class="Constant" href="vim9.html#E1034" name="E1034">E1034</a><br>
Vim9 script では以下の定義済みの値が使えます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_blob<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_channel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_dict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_function<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_job<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_list<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_partial<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_string</div>
<a class="Comment" href="vim9.html#true">true</a>&nbsp;は&nbsp;<a class="Comment" href="eval.html#v:true">v:true</a>&nbsp;と同じ、<a class="Comment" href="vim9.html#false">false</a>&nbsp;は&nbsp;<a class="Comment" href="eval.html#v:false">v:false</a>&nbsp;と同じ、そして<a class="Comment" href="vim9.html#null">null</a>&nbsp;は<br>
<a class="Comment" href="eval.html#v:null">v:null</a>&nbsp;と同じです。<br>
<br>
<a class="Comment" href="vim9.html#null">null</a>&nbsp;の型が &quot;special&quot; であるのに対し、他の &quot;null_&quot; の値の型はそれぞれの名前<br>
で示される型になります。かなり多くの場面で null 値は空の値と同値と扱われます<br>
が、いつでもそうだというわけではありません。スクリプトローカル変数は&nbsp;<a class="Comment" href="eval.html#:unlet">:unlet</a><br>
で削除することができないので、これらの null 値はスクリプトローカル変数をクリア<br>
するのに便利です。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var theJob = job_start(...)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ジョブに仕事をさせる<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theJob = null_job</div>
<br>
また、それらの値は引数の既定値とするのにも便利です:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc(b: blob = null_blob)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if b == null_blob<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 引数 b が与えられなかった</div>
<br>
<a class="Comment" href="vim9.html#null">null</a>&nbsp;はどんな値と比較すること可能で、型エラーが発生することはありません。<br>
しかし、<a class="Comment" href="vim9.html#null">null</a>&nbsp;と数値、浮動小数点数、真偽値との比較は常に&nbsp;<a class="Comment" href="vim9.html#false">false</a>&nbsp;になります。<br>
これは&nbsp;<a class="Comment" href="vim9.html#null">null</a>&nbsp;と 0 あるいは&nbsp;<a class="Comment" href="vim9.html#false">false</a>&nbsp;を比較した時に&nbsp;<a class="Comment" href="vim9.html#true">true</a>&nbsp;になる旧来の Vim<br>
script とは異なる点です。<br>
<br>
真偽値を文字列に変換するときは、旧来の Vim script のように&nbsp;<a class="Comment" href="eval.html#v:false">v:false</a>&nbsp;と<br>
<a class="Comment" href="eval.html#v:true">v:true</a>&nbsp;が使われるのではなく、<a class="Comment" href="vim9.html#false">false</a>&nbsp;と&nbsp;<a class="Comment" href="vim9.html#true">true</a>&nbsp;が使われます。<a class="Comment" href="eval.html#v:none">v:none</a>&nbsp;につい<br>
ては、他の言語に同等のものが存在しないので、<a class="Comment" href="eval.html#v:none">v:none</a>&nbsp;が&nbsp;<span class="Comment">none</span>&nbsp;に変換されるよ<br>
うになることはありません。<br>
<br>
文字列に対してインデックス&nbsp;<span class="Special">[idx]</span>&nbsp;や [idx : idx] を使用すると、バイト単位ではな<br>
く文字単位のインデックスとして扱われます。結合文字が含まれています。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'bár'[1]</div>
旧来の Vim script ではこれは文字 0xc3 (不正な文字) となりますが、Vim9 script<br>
では文字列 'á' が得られます。<br>
負のインデックスを指定すると、文字列の末尾から数えられます。&quot;[-1]&quot; は最後の文<br>
字です。<br>
最後の文字を除外するには&nbsp;<a class="Identifier" href="builtin.html#slice()">slice()</a>&nbsp;を使用します。<br>
合成文字を分けてカウントするには&nbsp;<a class="Identifier" href="builtin.html#strcharpart()">strcharpart()</a>&nbsp;を使ってください。<br>
インデックスが範囲外の場合は、空文字列になります。<br>
<br>
旧来のスクリプトでは &quot;++var&quot; と &quot;--var&quot; は寡黙に処理され、何の効果ももたらしま<br>
せん。これは Vim9 script ではエラーになります。<br>
<br>
ゼロから始まる数値は8進数とはみなされません、&quot;0o&quot; から始まる数値だけが8進数と<br>
みなされます: &quot;0o744&quot;。<a class="Identifier" href="eval.html#scriptversion-4">scriptversion-4</a><br>
<br>
<br>
<span class="PreProc">気をつけるべきこと</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-gotchas" name="vim9-gotchas">vim9-gotchas</a><br>
Vim9 は、一般的なプログラミング言語に近づくように設計されていますが、同時に旧<br>
来の Vim コマンドをサポートしようとしています。そのため、いくつかの妥協をしな<br>
ければなりませんでした。ここでは、意外と知られていないことをまとめてみました。<br>
<br>
Exコマンドの範囲指定にはコロンを前置する必要があります。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧来の Vim&#0058; 前の行を右にシフト<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;func()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vim9: 継続行におけるメソッド呼び出し<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:-&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vim9&#0058; 前の行を右にシフト</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%s/a/b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧来の Vim&#0058; すべての行を置換<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x = alongname<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; % another&nbsp;&nbsp;&nbsp;&nbsp;Vim9: 継続行の剰余演算<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:%s/a/b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vim9&#0058; すべての行を置換<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧来の Vim&#0058; マーク t へのジャンプ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'text'-&gt;func()&nbsp;&nbsp;&nbsp;&nbsp;Vim9: メソッド呼び出し<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:'t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vim9&#0058; マーク t へのジャンプ</div>
<br>
いくつかのExコマンドは Vim9 script の代入式と紛らわしくなります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:name = value&nbsp;&nbsp;&nbsp;&nbsp;# 代入<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:g:pattern:cmd&nbsp;&nbsp;&nbsp;&nbsp;# :グローバルコマンド</div>
<br>
コマンド&nbsp;<a class="Comment" href="repeat.html#:global">:global</a>&nbsp;や&nbsp;<a class="Comment" href="change.html#:substitute">:substitute</a>&nbsp;と式や代入文が紛らわしくなるのを避けるた<br>
め、これらのコマンドが一文字に省略されているとき、一部のセパレータは使うことが<br>
できません: ':'、'-' と '.' が利用不可です。:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:pattern:cmd&nbsp;&nbsp;&nbsp;&nbsp; # 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s:pattern:repl&nbsp;&nbsp;&nbsp;&nbsp;# 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g-pattern-cmd&nbsp;&nbsp;&nbsp;&nbsp; # 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s-pattern-repl&nbsp;&nbsp;&nbsp;&nbsp;# 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g.pattern.cmd&nbsp;&nbsp;&nbsp;&nbsp; # 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.pattern.repl&nbsp;&nbsp;&nbsp;&nbsp;# 無効なコマンド - エラー</div>
<br>
同様に、コマンドとセパレータの間にスペースがあってはいけません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g /pattern/cmd&nbsp;&nbsp;&nbsp;&nbsp;# 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s /pattern/repl&nbsp;&nbsp; # 無効なコマンド - エラー</div>
<br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義した関数はすべてコンパイルされます。旧来の関数は途中で脱出するこ<br>
とができ、それ以降の行はパースされません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func Maybe()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !has('feature')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use-feature<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfunc</div>
Vim9 関数はすべてコンパイルされます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Maybe()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !has('feature')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use-feature&nbsp;&nbsp;# コンパイルエラーが発生する可能性がある<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
応急的に、2つの関数に分けることができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func Maybe()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if has('feature')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call MaybeInner()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfunc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if has('feature')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MaybeInner()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use-feature<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif</div>
また、偽として評価される定数式の条件をもった&nbsp;<a class="Comment" href="eval.html#:if">if</a>&nbsp;の配下にサポート外のコードを<br>
置くことができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Maybe()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if has('feature')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use-feature<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
これには&nbsp;<a class="Comment" href="builtin.html#exists_compiled()">exists_compiled()</a>&nbsp;関数も同様に使えます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-user-command" name="vim9-user-command">vim9-user-command</a><br>
関数のコンパイルによる他の副作用として、ユーザーコマンドの存在がコンパイルの時<br>
点でチェックされます。ユーザーコマンドが後で定義されている場合、エラーとなりま<br>
す。これはOKです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -nargs=1 MyCommand echom &lt;q-args&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Works()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyCommand 123<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
これは &quot;MyCommand&quot; が定義されていないというエラーが発生します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Works()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -nargs=1 MyCommand echom &lt;q-args&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyCommand 123<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
回避策は、<a class="Comment" href="eval.html#:execute">:execute</a>&nbsp;を使用して間接的にコマンドを呼び出すことです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Works()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -nargs=1 MyCommand echom &lt;q-args&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execute 'MyCommand 123'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<span class="Todo">Note</span>&nbsp;認識されていないコマンドを &quot;|&quot; でつなぐと、その後のコマンドは認識されませ<br>
ん。次のような記述は&nbsp;<a class="Comment" href="eval.html#:endif">endif</a>&nbsp;がないというエラーになります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Maybe()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if has('feature') | use-feature | endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<span class="PreProc">その他の変更点</span><br>
<br>
パターンは、明示的に上書きされない限り&nbsp;<a class="Type" href="options.html#'magic'">'magic'</a>&nbsp;が設定されている状態と同様に作<br>
用します。<br>
オプション&nbsp;<a class="Type" href="options.html#'edcompatible'">'edcompatible'</a>&nbsp;の値は使用されません。<br>
オプション&nbsp;<a class="Type" href="options.html#'gdefault'">'gdefault'</a>&nbsp;の値は使用されません。<br>
<br>
また、このwikiも参考になるでしょう。これは Vim9 script のアーリーアダプターに<br>
よって書かれました:&nbsp;<span class="Constant"><a href="https://github.com/lacygoill/wiki/blob/master/vim/vim9.md">https://github.com/lacygoill/wiki/blob/master/vim/vim9.md</a></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:++" name=":++">:++</a>&nbsp;<a class="Constant" href="vim9.html#:--" name=":--">:--</a><br>
++ と -- コマンドが追加されました。1 を足し引きするのとそっくりです。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++var<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var += 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--var<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var -= 1<br>
<br>
式中で ++var や --var を使うことはまだサポートされていません。<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
3. 新しいスタイルの関数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#fast-functions" name="fast-functions">fast-functions</a><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:def" name=":def">:def</a>&nbsp;<a class="Constant" href="vim9.html#E1028" name="E1028">E1028</a><br>
:def[!]&nbsp;<span class="Special">{name}</span>(<span class="Special">[arguments]</span>)[:&nbsp;<span class="Special">{return-type}</span>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{name}</span>&nbsp;という名前の新しい関数を定義します。関数の本体<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;は次の行から&nbsp;<a class="Comment" href="vim9.html#:enddef">:enddef</a>&nbsp;と一致するまで続きます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1073" name="E1073">E1073</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1011" name="E1011">E1011</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{name}</span>&nbsp;は必ず 100 バイト未満でなければなりません。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1003" name="E1003">E1003</a>&nbsp;<a class="Constant" href="vim9.html#E1027" name="E1027">E1027</a>&nbsp;<a class="Constant" href="vim9.html#E1056" name="E1056">E1056</a>&nbsp;<a class="Constant" href="vim9.html#E1059" name="E1059">E1059</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="userfunc.html#:return">:return</a>&nbsp;で返される値の型は必ず&nbsp;<span class="Special">{return-type}</span>&nbsp;と一致<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;しなければなりません。<span class="Special">{return-type}</span>&nbsp;が省略された、ある<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;いは &quot;void&quot; である場合は、その関数は何も返さないと想定<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;されます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1077" name="E1077">E1077</a>&nbsp;<a class="Constant" href="vim9.html#E1123" name="E1123">E1123</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{arguments}</span>&nbsp;は 0 あるいはそれ以上の引数の宣言列です。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引数の宣言には 3 つの書式があります:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{name}</span>:&nbsp;<span class="Special">{type}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{name}</span>&nbsp;=&nbsp;<span class="Special">{value}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{name}</span>:&nbsp;<span class="Special">{type}</span>&nbsp;=&nbsp;<span class="Special">{value}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最初の書式は必須の引数の書式で、呼び出す側は必ず実引数<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;を与える必要があります。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 つ目と 3 つ目の書式は任意の引数の書式です。呼び出す<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;側が実引数を省略した場合は、<span class="Special">{value}</span>&nbsp;が使われます。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;関数は呼び出された時、<a class="Comment" href="vim9.html#:disassemble">:disassemble</a>&nbsp;が使われたとき、<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;あるいは&nbsp;<a class="Comment" href="vim9.html#:defcompile">:defcompile</a>&nbsp;が使われたときに命令列にコンパ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;イルされます。文法および型のエラーはこの時に提示されま<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;す。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;を他の&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;や&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;の内側で大体 50 階<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;層の深さまでまでネストすることが可能です。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1117" name="E1117">E1117</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[!] は&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;と同様に使われます。<span class="Todo">Note</span>&nbsp;Vim9<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script において、スクリプトローカル関数は後で削除され<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;たり再定義されたりしてはいけません。スクリプトローカル<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;の削除は、同じスクリプトの再読み込みによってのみ行えま<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;す。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:enddef" name=":enddef">:enddef</a>&nbsp;<a class="Constant" href="vim9.html#E1057" name="E1057">E1057</a>&nbsp;<a class="Constant" href="vim9.html#E1152" name="E1152">E1152</a>&nbsp;<a class="Constant" href="vim9.html#E1173" name="E1173">E1173</a><br>
:enddef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義された関数の終了。<a class="Comment" href="vim9.html#:enddef">:enddef</a>&nbsp;はそれだけで<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;行にあるべきです。<br>
<br>
また、このwikiも参考になるでしょう。これは Vim9 script のアーリーアダプターに<br>
よって書かれました:&nbsp;<span class="Constant"><a href="https://github.com/lacygoill/wiki/blob/master/vim/vim9.md">https://github.com/lacygoill/wiki/blob/master/vim/vim9.md</a></span><br>
<br>
もし関数が定義されたスクリプトが Vim9 script であるなら、スクリプトローカル変<br>
数はプリフィックス &quot;s:&quot; なしでアクセスすることができます。それらは関数がコンパ<br>
イルされる前に定義されている必要があります。もし関数が定義されたスクリプトが旧<br>
来の Vim script であるなら、スクリプトローカル変数は、コンパイル時に存在しない<br>
場合は、プリフィックス &quot;s:&quot; をつけてアクセスする必要があります。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1269" name="E1269">E1269</a><br>
<a class="Identifier" href="vim9.html#Vim9">Vim9</a>&nbsp;script では、スクリプトローカル変数はスクリプトレベルで宣言されなければ<br>
なりません。それらは関数内で、旧来の関数内でも作成することはできません。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:defc" name=":defc">:defc</a>&nbsp;<a class="Constant" href="vim9.html#:defcompile" name=":defcompile">:defcompile</a><br>
:defc[ompile]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 現在のスクリプトで定義されている関数のうち、まだコンパ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;イルされていないものをコンパイルします。これはコンパイ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ル時に見つかったいかなるエラーも報告します。<br>
<br>
:defc[ompile]&nbsp;<span class="Special">{func}</span><br>
:defc[ompile] debug&nbsp;<span class="Special">{func}</span><br>
:defc[ompile] profile&nbsp;<span class="Special">{func}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;必要であれば関数&nbsp;<span class="Special">{func}</span>&nbsp;をコンパイルします。&quot;debug&quot; と<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;profile&quot; はコンパイルモードを指定するのに使います。こ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;れはコンパイル時に見つかったいかなるエラーも報告しま<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;す。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:disa" name=":disa">:disa</a>&nbsp;<a class="Constant" href="vim9.html#:disassemble" name=":disassemble">:disassemble</a><br>
:disa[ssemble]&nbsp;<span class="Special">{func}</span>&nbsp;&nbsp;&nbsp;<span class="Special">{func}</span>&nbsp;用に生成された命令列を表示します。これはデバ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ッグ及びテスト用です。<span class="MissingTag">E1061</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Todo">Note</span>&nbsp;<span class="Special">{func}</span>&nbsp;のコマンドライン補完において、スクリプト<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ローカル関数を見つけるのに &quot;s:&quot; を前置することができ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ます。<br>
<br>
:disa[ssemble] profile&nbsp;<span class="Special">{func}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vim9.html#:disassemble">:disassemble</a>&nbsp;と似ていますが、プロファイルをとるとき<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;に使われる命令列を表示します。<br>
<br>
:disa[ssemble] debug&nbsp;<span class="Special">{func}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vim9.html#:disassemble">:disassemble</a>&nbsp;と似ていますが、デバッグをするときに使<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;われる命令列を表示します。<br>
<br>
<span class="PreProc">制約</span><br>
<br>
ローカル変数は文字列式からは見えません。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MapList(): list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var list = ['aa', 'bb', 'cc', 'dd']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return range(1, 2)-&gt;map('list[v:val]')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
この map の引数は関数のスコープ抜きに評価される文字列式です。代わりにラムダ式<br>
を使ってください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MapList(): list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var list = ['aa', 'bb', 'cc', 'dd']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return range(1, 2)-&gt;map((_, v) =&gt; list[v])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<a class="Comment" href="editing.html#:edit">:edit</a>&nbsp;のような、コンパイルされないコマンドには、バッククォートによる展開が<br>
使え、またそれはローカルスコープを使うことができます。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Replace()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var fname = 'blah.txt'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edit `=fname`<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
ループ内で定義されたクロージャは同じコンテキストを共有します。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var flist: list&lt;func&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for i in range(5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var inloop = i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flist[i] = () =&gt; inloop<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo range(5)-&gt;map((i, _) =&gt; flist[i]())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 結果: [4, 4, 4, 4, 4]</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1271" name="E1271">E1271</a><br>
クロージャはそのコンテキスト内の変数を見つけられるように、必ずそれが定義された<br>
コンテキストでコンパイルされます。これは関数がコンパイルされた後に&nbsp;<a class="Comment" href="repeat.html#:breakadd">:breakadd</a><br>
で関数がデバッグ対象だとマークされたときを除いて、これは大体正しく行われます。<br>
必ず外側の関数がコンパイルされるより前にブレークポイントを定義するように気をつ<br>
けてください。<br>
<br>
「ループ中」の変数は一度しか存在しません。リストに入れた全てのクロージャは同じ<br>
インスタンス、すなわち最後に 4 の値をもつインスタンスを参照します。これは効率<br>
的で、何回もループする場合でも同様です。もしそれぞれのクロージャでコンテキスト<br>
を分けたいのであれば、コンテキストを定義するため関数を呼んでください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def GetClosure(i: number): func<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var infunc = i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return () =&gt; infunc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var flist: list&lt;func&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for i in range(5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flist[i] = GetClosure(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo range(5)-&gt;map((i, _) =&gt; flist[i]())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 結果: [0, 1, 2, 3, 4]</div>
<br>
いくらかの場面で、特に旧来の Vim script のコンテキストから Vim9 のクロージャを<br>
呼ぶとき、その評価は失敗するでしょう。&nbsp;<a class="Constant" href="vim9.html#E1248" name="E1248">E1248</a><br>
<br>
<span class="Todo">Note</span>&nbsp;スクリプトレベルにおいて、ループ変数はループの後では無効になります。これ<br>
はループ変数が後で呼ばれるクロージャで使われている場合、例えばタイマーと組み合<br>
わせる場合でも同様です。これは&nbsp;<a class="Identifier" href="eval.html#E1302">E1302</a>&nbsp;エラーを発生させます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for n in range(4)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timer_start(500 * n, (_) =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echowin n<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor</div>
<br>
ブロックを使って変数を定義し、その変数をクロージャで使う必要があります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for n in range(4)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var nr = n<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timer_start(500 * n, (_) =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echowin nr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor</div>
<br>
タイマーにおいて&nbsp;<a class="Comment" href="eval.html#:echowindow">:echowindow</a>&nbsp;を使うのは便利です。メッセージはポップアップに<br>
表示され、タイマーがトリガーされたときにユーザーが行っていることに干渉しませ<br>
ん。<br>
<br>
<br>
<span class="PreProc">旧来の関数から Vim9 の関数への変換</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#convert_legacy_function_to_vim9" name="convert_legacy_function_to_vim9">convert_legacy_function_to_vim9</a><br>
これらが旧来の関数から Vim9 の関数へ変換するために行われる必要のある変更の大部<br>
分です。<br>
<br>
-&nbsp;<span class="Comment">func</span>&nbsp;や&nbsp;<a class="Comment" href="userfunc.html#:function">function</a>&nbsp;を&nbsp;<a class="Comment" href="vim9.html#:def">def</a>&nbsp;に変更する。<br>
-&nbsp;<span class="Comment">endfunc</span>&nbsp;や&nbsp;<a class="Comment" href="userfunc.html#:endfunction">endfunction</a>&nbsp;を&nbsp;<a class="Comment" href="vim9.html#:enddef">enddef</a>&nbsp;に変更する。<br>
- 関数の引数に型をつける。<br>
- もし関数が何か返すのであれば、戻り値の型をつける。<br>
- コメントが &quot; に代わって # で始まるように変更する。<br>
<br>
&nbsp;&nbsp;例えば旧来の Vim script の関数:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func MyFunc(text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot; 関数の本体<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfunc</div>
&nbsp;&nbsp;&nbsp;がこうなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc(text: string): number<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 関数の本体<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
- 引数に使われる &quot;a:&quot; を削除する。 例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return len(a:text)</div>
&nbsp;&nbsp;&nbsp;がこうなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return len(text)</div>
<br>
- 変数の宣言に使われる&nbsp;<a class="Comment" href="eval.html#:let">let</a>&nbsp;を&nbsp;<a class="Comment" href="vim9.html#:var">var</a>&nbsp;に変更する。<br>
- 変数への値の代入に使われる&nbsp;<a class="Comment" href="eval.html#:let">let</a>&nbsp;を削除する。これは既に宣言されているローカ<br>
&nbsp;&nbsp;ル変数と b: w: g: t: 変数が対象である。<br>
<br>
&nbsp;&nbsp;例えば旧来の Vim script の関数:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let lnum = 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let lnum += 3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let b:result = 42</div>
&nbsp;&nbsp;&nbsp;がこうなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var lnum = 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lnum += 3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b:result = 42</div>
<br>
- 式中の必要なところへホワイトスペースを挿入する。<br>
- 結合に使われる &quot;.&quot; を &quot;..&quot; に変更する。<br>
<br>
&nbsp;&nbsp;例えば旧来の Vim script の関数:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo line(1).line(2)</div>
&nbsp;&nbsp;&nbsp;がこうなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo line(1) .. line(2)</div>
<br>
- 常に行継続にバックスラッシュが必要なわけではない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo ['one',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ 'two',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ 'three'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ ]</div>
&nbsp;&nbsp;&nbsp;がこうなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo ['one',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'two',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'three'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</div>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
4. 型&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-types" name="vim9-types">vim9-types</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1008" name="E1008">E1008</a>&nbsp;<a class="Constant" href="vim9.html#E1009" name="E1009">E1009</a>&nbsp;<a class="Constant" href="vim9.html#E1010" name="E1010">E1010</a>&nbsp;<a class="Constant" href="vim9.html#E1012" name="E1012">E1012</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1013" name="E1013">E1013</a>&nbsp;<a class="Constant" href="vim9.html#E1029" name="E1029">E1029</a>&nbsp;<a class="Constant" href="vim9.html#E1030" name="E1030">E1030</a><br>
以下の組み込み型がサポートされています:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;number<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blob<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list&lt;<span class="Special">{type}</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dict&lt;<span class="Special">{type}</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func:&nbsp;<span class="Special">{type}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func(<span class="Special">{type}</span>, ...)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func(<span class="Special">{type}</span>, ...):&nbsp;<span class="Special">{type}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void<br>
<br>
まだサポートされていません:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tuple&lt;a:&nbsp;<span class="Special">{type}</span>, b:&nbsp;<span class="Special">{type}</span>, ...&gt;<br>
<br>
これらの型は宣言において使えますが、いかなる単純値も実際に &quot;void&quot; 型を持つこと<br>
はありません。void (例えば、戻り値のない関数) を使おうとするとエラーがでます。<br>
<a class="Constant" href="vim9.html#E1031" name="E1031">E1031</a>&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1186" name="E1186">E1186</a><br>
<br>
配列型はありません。代わりに list&lt;<span class="Special">{type}</span>&gt; を使ってください。不変のリストに<br>
対しては大量の細かいメモリを割り当てするのを避ける効率的な実装が使われます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1005" name="E1005">E1005</a>&nbsp;<a class="Constant" href="vim9.html#E1007" name="E1007">E1007</a><br>
部分適用と関数は幾らかの方法で宣言することができます:<br>
func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;任意の種類の関数参照。引数や戻り値への型チェッ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;クはない。<br>
func: void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;任意の数および型の引数で、戻り値はない。<br>
func:&nbsp;<span class="Special">{type}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;任意の数および型の引数で、特定の型の戻り値があ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;る。<br>
<br>
func()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引数がなく、値を返さない関数。<br>
func(): void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;同上<br>
func():&nbsp;<span class="Special">{type}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引数がなく、戻り値の型がある関数。<br>
<br>
func(<span class="Special">{type}</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引数の型があり、値を返さない関数。<br>
func(<span class="Special">{type}</span>):&nbsp;<span class="Special">{type}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引数の型と戻り値の型がある関数。<br>
func(?<span class="Special">{type}</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 任意の引数の型があり、値を返さない関数。<br>
func(...<span class="Special">{type}</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 可変長の引数の型があり、値を返さない関数。<br>
func(<span class="Special">{type}</span>, ?<span class="Special">{type}</span>, ...<span class="Special">{type}</span>):&nbsp;<span class="Special">{type}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;以下をもつ関数:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 必須の引数の型<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 任意の引数の型<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 可変長引数の型<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 戻り値の型<br>
<br>
もし戻り値の型が &quot;void&quot; なら、関数は値を返しません。<br>
<br>
関数参照はそれが呼び出し側から見えない追加の引数および・あるいは辞書を保存して<br>
いる場合、<a class="Identifier" href="eval.html#Partial">Partial</a>&nbsp;にすることもできます。それらは同じように呼び出されるた<br>
め、宣言も同じです。<br>
<br>
<a class="Comment" href="vim9.html#:type">:type</a>&nbsp;を使ってカスタム型を定義できます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:type MyList list&lt;string&gt;</div>
ユーザー関数と似たように、後から追加される組み込み型との名前の衝突を避けるた<br>
め、カスタム型は大文字から始まらなければなりません。<br>
<span class="Special">{not implemented yet}</span><br>
<br>
そしてクラスとインターフェイスも型として使えます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:class MyClass<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyClass</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:interface MyInterface<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyInterface</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:class MyTemplate&lt;Targ&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyTemplate&lt;number&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyTemplate&lt;string&gt;</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:class MyInterface&lt;Targ&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyInterface&lt;number&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyInterface&lt;string&gt;</div>
<span class="Special">{not implemented yet}</span><br>
<br>
<br>
<span class="PreProc">変数の型と型キャスト</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#variable-types" name="variable-types">variable-types</a><br>
Vim9 script か&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義される関数内で宣言された変数は明示的に示された型<br>
か、初期値から推測された型のどちらかの型を持っています。<br>
<br>
グローバル、バッファ、ウィンドウ、タブページ変数は特定の型を持たず、値はいつで<br>
も書き換えられ、そしてそれは型の変更も含み得ます。なので、コンパイルされたコー<br>
ドでは &quot;any&quot; 型が仮定されます。<br>
<br>
これは &quot;any&quot; 型が望ましくなく、実際の型が常に同じであると想定されるときに問題<br>
になり得ます。例えば、リストを宣言したとき:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var l: list&lt;number&gt; = [1, g:two]</div>
コンパイル時には Vim は &quot;g:two&quot; の型を知らず、式の型は list<span class="Special">&lt;any&gt;</span>&nbsp;になります。<br>
左辺への代入の前にリストの型をチェックするための命令が生成され、少々非効率で<br>
す。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#type-casting" name="type-casting">type-casting</a>&nbsp;<a class="Constant" href="vim9.html#E1104" name="E1104">E1104</a><br>
これを避けるには、型キャストを使ってください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var l: list&lt;number&gt; = [1, &lt;number&gt;g:two]</div>
コンパイルされたコードは今度は &quot;g:two&quot; が数値かどうかをチェックするだけで、も<br>
しそうでないならエラーを与えます。これは型キャストと呼ばれます。<br>
<br>
型キャストの文法は: &quot;&lt;&quot;&nbsp;<span class="Special">{type}</span>&nbsp;&quot;&gt;&quot; です。&quot;&lt;&quot; の後ろ、あるいは &quot;&gt;&quot; の前にホワイ<br>
トスペースがあってはいけません (小なりと大なりの演算子との混乱を避けるためで<br>
す)。<br>
<br>
意味としては、必要であれば実行時の型チェックが行われます。実際に値が変更される<br>
こことはありません。もし型を変える必要があるのであれば、例えば文字列に変換する<br>
のであれば&nbsp;<a class="Identifier" href="builtin.html#string()">string()</a>&nbsp;関数を使ってください。あるいは文字列を数値に変換するので<br>
あれば&nbsp;<a class="Identifier" href="builtin.html#str2nr()">str2nr()</a>&nbsp;関数を使ってください。<br>
<br>
もし想定されない場所で型が与えられた場合、<span class="MissingTag">E1272</span>&nbsp;を得るかもしれません。<br>
<br>
<br>
<span class="PreProc">型インターフェイス</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#type-inference" name="type-inference">type-inference</a><br>
一般的に: 型が明確な時はいつも型を省略することができます。例えば、変数を宣言<br>
し、値を与えた時:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 数値型と推測する<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = 'hello'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 文字列型と推測する</div>
<br>
リストと辞書の型は、要素の値の型の共通のものからきます。もしその値が全て同じ型<br>
をもつなら、その型がリストか辞書に使われます。もし型が混在しているなら、&quot;any&quot;<br>
型が使われます。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1, 2, 3]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list&lt;number&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;['a', 'b', 'c'] list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1, 'x', 3]&nbsp;&nbsp;&nbsp;&nbsp; list&lt;any&gt;</div>
<br>
関数参照の共通の型は、もしそれらが全て同じ数の引数をもつのでなければ、引数の<br>
数が指定されていないことを示すため &quot;(...)&quot; を使います。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Foo(x: bool)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Bar(x: bool, y: bool)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var funclist = [Foo, Bar]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo funclist-&gt;typename()</div>
結果はこうなります:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list&lt;func(...)&gt;<br>
<br>
Vim9 script のスクリプトローカル変数は型がチェックされ、それは変数が旧来の Vim<br>
script の関数内で宣言されたときでも同様です。<br>
<br>
型が宣言されたとき、これはリストや辞書に付け加えられます。後のある式がその型を<br>
変えようとすると、エラーが与えられます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ll: list&lt;number&gt; = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ll-&gt;extend(['x'])&nbsp;&nbsp;# エラー、'x' は数値ではない</div>
<br>
もし型が宣言されていないのであれば、そのときは変えることは許可されます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1, 2, 3]-&gt;extend(['x'])&nbsp;&nbsp;# 結果: [1, 2, 3, 'x']</div>
<br>
変数の宣言においては、推測された型は重要です:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ll = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ll-&gt;extend(['x'])&nbsp;&nbsp;# エラー、'x' は数値ではない</div>
これは宣言が数値のリストのように見えるためで、それゆえ以下と等しいからです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ll: list&lt;number&gt; = [1, 2, 3]</div>
もし、もっと寛容なリストが欲しいのであれば、型を宣言する必要があります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ll: list&lt;any&gt; = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ll-&gt;extend(['x'])&nbsp;&nbsp;# OK</div>
<br>
<br>
<span class="PreProc">より厳格な型チェック</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#type-checking" name="type-checking">type-checking</a><br>
旧来の Vim script では、数値が予期されるところでは、文字列は自動的に数値に変換<br>
されます。これは &quot;123&quot; のような実際の数値に対しては便利でしたが、もし文字列が<br>
数字で始まらないときは予期しない問題 (加えてエラーメッセージなしで) を引き起こ<br>
します。これは頻繁に見つけにくいバグを引き起こします。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 123 == '123'</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">1</span><br>
思いがけないスペースがあるとき:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 123 == ' 123'</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">0</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1206" name="E1206">E1206</a>&nbsp;<a class="Constant" href="vim9.html#E1210" name="E1210">E1210</a>&nbsp;<a class="Constant" href="vim9.html#E1212" name="E1212">E1212</a><br>
Vim9 script ではこれは厳格にされています。使われている値が予期される型と一致す<br>
る場合は、ほとんどの場所で前と同じように動作します。時々エラーになり、それゆえ<br>
後方互換性が壊れています。例:<br>
- 真偽値が期待されるところで、値が 0 か 1 でない数値を使う。&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1023" name="E1023">E1023</a><br>
- 数値のオプションを設定するときに文字列を使う。&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1024" name="E1024">E1024</a>&nbsp;<a class="Constant" href="vim9.html#E1105" name="E1105">E1105</a><br>
- 文字列が期待されるところで数値を用いる。<br>
<br>
一つの影響として、型が宣言された場合は&nbsp;<a class="Identifier" href="builtin.html#map()">map()</a>&nbsp;に渡されたリストか辞書の要素の<br>
型は変更されてはいけません。これは Vim9 script ではエラーになります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist: list&lt;number&gt; = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo map(mylist, (i, v) =&gt; 'item ' .. i)</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">E1012: Type mismatch; expected number but got string in map()</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{訳注: 日本語メッセージの場合: &quot;E1012: 型が不一致です。number が必要で</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">すが string でした (map() 内)&quot;}</span><br>
<br>
代わりに、新しくリストを作成する&nbsp;<a class="Identifier" href="builtin.html#mapnew()">mapnew()</a>&nbsp;を使ってください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist: list&lt;number&gt; = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo mapnew(mylist, (i, v) =&gt; 'item ' .. i)</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">['item 0', 'item 1', 'item 2']</span><br>
<br>
もし要素の型が宣言されていない、あるいは &quot;any&quot; と決定されているなら、型はより<br>
具体的なものに変更することができます。例えば、型の混ざったリストが文字列のリス<br>
トに変更される場合:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist = [1, 2.0, '3']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# typename(mylist) == &quot;list&lt;any&gt;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map(mylist, (i, v) =&gt; 'item ' .. i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# typename(mylist) == &quot;list&lt;string&gt;&quot;、エラーなし</div>
<br>
リスト定数を直接使うのと、変数宣言を通して使うのには少しの差異があります。<br>
理由は型推論で、リスト定数を変数を初期化するのに使うとき、それは同時に宣言した<br>
型をつけます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# typename(mylist) == &quot;list&lt;number&gt;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo map(mylist, (i, v) =&gt; 'item ' .. i)&nbsp;&nbsp;# エラー!</div>
<br>
リスト定数を直接使うときは、型は宣言されず、変更することが許可されます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo map([1, 2, 3], (i, v) =&gt; 'item ' .. i)&nbsp;&nbsp;# OK</div>
<br>
The reasoning behind this is that when a type is declared and the list is<br>
passed around and changed, the declaration must always hold.&nbsp;&nbsp;So that you can<br>
rely on the type to match the declared type.&nbsp;&nbsp;For a constant this is not<br>
needed.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1158" name="E1158">E1158</a><br>
Same for&nbsp;<a class="Identifier" href="builtin.html#extend()">extend()</a>, use&nbsp;<a class="Identifier" href="builtin.html#extendnew()">extendnew()</a>&nbsp;instead, and for&nbsp;<a class="Identifier" href="builtin.html#flatten()">flatten()</a>, use<br>
<a class="Identifier" href="builtin.html#flattennew()">flattennew()</a>&nbsp;instead.&nbsp;&nbsp;Since&nbsp;<a class="Identifier" href="builtin.html#flatten()">flatten()</a>&nbsp;is intended to always change the<br>
type, it can not be used in Vim9 script.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1211" name="E1211">E1211</a>&nbsp;<a class="Constant" href="vim9.html#E1217" name="E1217">E1217</a>&nbsp;<a class="Constant" href="vim9.html#E1218" name="E1218">E1218</a>&nbsp;<a class="Constant" href="vim9.html#E1219" name="E1219">E1219</a>&nbsp;<a class="Constant" href="vim9.html#E1220" name="E1220">E1220</a>&nbsp;<a class="Constant" href="vim9.html#E1221" name="E1221">E1221</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1222" name="E1222">E1222</a>&nbsp;<a class="Constant" href="vim9.html#E1223" name="E1223">E1223</a>&nbsp;<a class="Constant" href="vim9.html#E1224" name="E1224">E1224</a>&nbsp;<a class="Constant" href="vim9.html#E1225" name="E1225">E1225</a>&nbsp;<a class="Constant" href="vim9.html#E1226" name="E1226">E1226</a>&nbsp;<a class="Constant" href="vim9.html#E1227" name="E1227">E1227</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1228" name="E1228">E1228</a>&nbsp;<a class="Constant" href="vim9.html#E1238" name="E1238">E1238</a>&nbsp;<a class="Constant" href="vim9.html#E1250" name="E1250">E1250</a>&nbsp;<a class="Constant" href="vim9.html#E1251" name="E1251">E1251</a>&nbsp;<a class="Constant" href="vim9.html#E1252" name="E1252">E1252</a>&nbsp;<a class="Constant" href="vim9.html#E1253" name="E1253">E1253</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1256" name="E1256">E1256</a>&nbsp;<a class="Constant" href="vim9.html#E1297" name="E1297">E1297</a>&nbsp;<a class="Constant" href="vim9.html#E1298" name="E1298">E1298</a>&nbsp;<a class="Constant" href="vim9.html#E1301" name="E1301">E1301</a><br>
Types are checked for most builtin functions to make it easier to spot<br>
mistakes.<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
5. Namespace, Import and Export<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9script" name="vim9script">vim9script</a>&nbsp;<a class="Constant" href="vim9.html#vim9-export" name="vim9-export">vim9-export</a>&nbsp;<a class="Constant" href="vim9.html#vim9-import" name="vim9-import">vim9-import</a><br>
<br>
A Vim9 script can be written to be imported.&nbsp;&nbsp;This means that some items are<br>
intentionally exported, made available to other scripts.&nbsp;&nbsp;When the exporting<br>
script is imported in another script, these exported items can then be used in<br>
that script.&nbsp;&nbsp;All the other items remain script-local in the exporting script<br>
and cannot be accessed by the importing script.<br>
<br>
This mechanism exists for writing a script that can be sourced (imported) by<br>
other scripts, while making sure these other scripts only have access to what<br>
you want them to.&nbsp;&nbsp;This also avoids using the global namespace, which has a<br>
risk of name collisions.&nbsp;&nbsp;For example when you have two plugins with similar<br>
functionality.<br>
<br>
You can cheat by using the global namespace explicitly.&nbsp;&nbsp;That should be done<br>
only for things that really are global.<br>
<br>
<br>
<span class="PreProc">Namespace</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-namespace" name="vim9-namespace">vim9-namespace</a><br>
To recognize a file that can be imported the&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;statement must<br>
appear as the first statement in the file (see&nbsp;<a class="Identifier" href="vim9.html#vim9-mix">vim9-mix</a>&nbsp;for an exception).<br>
It tells Vim to interpret the script in its own namespace, instead of the<br>
global namespace.&nbsp;&nbsp;If a file starts with:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var myvar = 'yes'</div>
Then &quot;myvar&quot; will only exist in this file.&nbsp;&nbsp;While without&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;it would<br>
be available as&nbsp;<span class="Comment">g:myvar</span>&nbsp;from any other script and function.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1101" name="E1101">E1101</a><br>
The variables at the file level are very much like the script-local &quot;s:&quot;<br>
variables in legacy Vim script, but the &quot;s:&quot; is omitted.&nbsp;&nbsp;And they cannot be<br>
deleted.<br>
<br>
In Vim9 script the global &quot;g:&quot; namespace can still be used as before.&nbsp;&nbsp;And the<br>
&quot;w:&quot;, &quot;b:&quot; and &quot;t:&quot; namespaces.&nbsp;&nbsp;These have in common that variables are not<br>
declared, have no specific type and they can be deleted.&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1304" name="E1304">E1304</a><br>
<br>
A side effect of&nbsp;<a class="Comment" href="repeat.html#:vim9script">:vim9script</a>&nbsp;is that the&nbsp;<a class="Type" href="options.html#'cpoptions'">'cpoptions'</a>&nbsp;option is set to the<br>
Vim default value, like with:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:set cpo&amp;vim</div>
One of the effects is that&nbsp;<a class="Identifier" href="repeat.html#line-continuation">line-continuation</a>&nbsp;is always enabled.<br>
The original value of&nbsp;<a class="Type" href="options.html#'cpoptions'">'cpoptions'</a>&nbsp;is restored at the end of the script, while<br>
flags added or removed in the script are also added to or removed from the<br>
original value to get the same effect.&nbsp;&nbsp;The order of flags may change.<br>
In the&nbsp;<a class="Identifier" href="starting.html#vimrc">vimrc</a>&nbsp;file sourced on startup this does not happen.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-mix" name="vim9-mix">vim9-mix</a><br>
There is one way to use both legacy and Vim9 syntax in one script file:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot; comments may go here<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !has('vim9script')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot; legacy script commands go here<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finish<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Vim9 script commands go here</div>
This allows for writing a script that takes advantage of the Vim9 script<br>
syntax if possible, but will also work on a Vim version without it.<br>
<br>
This can only work in two ways:<br>
1. The &quot;if&quot; statement evaluates to false, the commands up to&nbsp;<a class="Comment" href="eval.html#:endif">endif</a>&nbsp;are<br>
&nbsp;&nbsp; skipped and&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;is then the first command actually executed.<br>
2. The &quot;if&quot; statement evaluates to true, the commands up to&nbsp;<a class="Comment" href="eval.html#:endif">endif</a>&nbsp;are<br>
&nbsp;&nbsp; executed and&nbsp;<a class="Comment" href="repeat.html#:finish">finish</a>&nbsp;bails out before reaching&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>.<br>
<br>
<br>
<span class="PreProc">Export</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:export" name=":export">:export</a>&nbsp;<a class="Constant" href="vim9.html#:exp" name=":exp">:exp</a><br>
Exporting an item can be written as:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export const EXPORTED_CONST = 1234<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export var someValue = ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export final someValue = ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export const someValue = ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export def MyFunc() ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export class MyClass ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export interface MyClass ...</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1043" name="E1043">E1043</a>&nbsp;<a class="Constant" href="vim9.html#E1044" name="E1044">E1044</a><br>
As this suggests, only constants, variables,&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;functions and classes can<br>
be exported.&nbsp;<span class="Special">{not implemented yet: class, interface}</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1042" name="E1042">E1042</a><br>
<a class="Comment" href="vim9.html#:export">:export</a>&nbsp;can only be used in Vim9 script, at the script level.<br>
<br>
<br>
<span class="PreProc">Import</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:import" name=":import">:import</a>&nbsp;<a class="Constant" href="vim9.html#:imp" name=":imp">:imp</a>&nbsp;<a class="Constant" href="vim9.html#E1094" name="E1094">E1094</a>&nbsp;<a class="Constant" href="vim9.html#E1047" name="E1047">E1047</a>&nbsp;<a class="Constant" href="vim9.html#E1262" name="E1262">E1262</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1048" name="E1048">E1048</a>&nbsp;<a class="Constant" href="vim9.html#E1049" name="E1049">E1049</a>&nbsp;<a class="Constant" href="vim9.html#E1053" name="E1053">E1053</a>&nbsp;<a class="Constant" href="vim9.html#E1071" name="E1071">E1071</a>&nbsp;<a class="Constant" href="vim9.html#E1088" name="E1088">E1088</a>&nbsp;<a class="Constant" href="vim9.html#E1236" name="E1236">E1236</a><br>
The exported items can be imported in another script. The import syntax has<br>
two forms. The simple form:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import {filename}</div>
<br>
Where&nbsp;<span class="Special">{filename}</span>&nbsp;is an expression that must evaluate to a string.&nbsp;&nbsp;In this<br>
form the filename should end in &quot;.vim&quot; and the portion before &quot;.vim&quot; will<br>
become the script local name of the namespace. For example:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import &quot;myscript.vim&quot;</div>
<br>
This makes each exported item in &quot;myscript.vim&quot; available as &quot;myscript.item&quot;.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:import-as" name=":import-as">:import-as</a>&nbsp;<a class="Constant" href="vim9.html#E1257" name="E1257">E1257</a>&nbsp;<a class="Constant" href="vim9.html#E1261" name="E1261">E1261</a><br>
In case the name is long or ambiguous, this form can be used to specify<br>
another name:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import {longfilename} as {name}</div>
<br>
In this form&nbsp;<span class="Special">{name}</span>&nbsp;becomes a specific script local name for the imported<br>
namespace.&nbsp;&nbsp;Therefore&nbsp;<span class="Special">{name}</span>&nbsp;must consist of letters, digits and '_', like<br>
<a class="Identifier" href="eval.html#internal-variables">internal-variables</a>.&nbsp;&nbsp;The&nbsp;<span class="Special">{longfilename}</span>&nbsp;expression must evaluate to any<br>
filename.&nbsp;&nbsp;For example:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import &quot;thatscript.vim.v2&quot; as that</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1060" name="E1060">E1060</a>&nbsp;<a class="Constant" href="vim9.html#E1258" name="E1258">E1258</a>&nbsp;<a class="Constant" href="vim9.html#E1259" name="E1259">E1259</a>&nbsp;<a class="Constant" href="vim9.html#E1260" name="E1260">E1260</a><br>
Then you can use &quot;that.item&quot;, etc.&nbsp;&nbsp;You are free to choose the name &quot;that&quot;.<br>
Use something that will be recognized as referring to the imported script.<br>
Avoid command names, command modifiers and builtin function names, because the<br>
name will shadow them.&nbsp;&nbsp;Better not start the name starts with a capital<br>
letter, since it can then also shadow global user commands and functions.<br>
Also, you cannot use the name for something else in the script, such as a<br>
function or variable name.<br>
<br>
In case the dot in the name is undesired, a local reference can be made for a<br>
function:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var LongFunc = that.LongFuncName</div>
<br>
This also works for constants:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const MAXLEN = that.MAX_LEN_OF_NAME</div>
<br>
This does not work for variables, since the value would be copied once and<br>
when changing the variable the copy will change, not the original variable.<br>
You will need to use the full name, with the dot.<br>
<br>
<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;can also be used in legacy Vim script.&nbsp;&nbsp;The imported items still<br>
become script-local, even when the &quot;s:&quot; prefix is not given.<br>
<br>
<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;can not be used in a function.&nbsp;&nbsp;Imported items are intended to exist<br>
at the script level and only imported once.<br>
<br>
The script name after&nbsp;<a class="Comment" href="vim9.html#:import">import</a>&nbsp;can be:<br>
- A relative path, starting &quot;.&quot; or &quot;..&quot;.&nbsp;&nbsp;This finds a file relative to the<br>
&nbsp;&nbsp;location of the script file itself.&nbsp;&nbsp;This is useful to split up a large<br>
&nbsp;&nbsp;plugin into several files.<br>
- An absolute path, starting with &quot;/&quot; on Unix or &quot;D:/&quot; on MS-Windows.&nbsp;&nbsp;This<br>
&nbsp;&nbsp;will rarely be used.<br>
- A path not being relative or absolute.&nbsp;&nbsp;This will be found in the<br>
&nbsp;&nbsp;&quot;import&quot; subdirectories of&nbsp;<a class="Type" href="options.html#'runtimepath'">'runtimepath'</a>&nbsp;entries.&nbsp;&nbsp;The name will usually be<br>
&nbsp;&nbsp;longer and unique, to avoid loading the wrong file.<br>
&nbsp;&nbsp;<span class="Todo">Note</span>&nbsp;that &quot;after/import&quot; is not used.<br>
<br>
If the name does not end in &quot;.vim&quot; then the use of &quot;as name&quot; is required.<br>
<br>
Once a vim9 script file has been imported, the result is cached and used the<br>
next time the same script is imported.&nbsp;&nbsp;It will not be read again.<br>
<br>
It is not allowed to import the same script twice, also when using two<br>
different &quot;as&quot; names.<br>
<br>
When using the imported name the dot and the item name must be in the same<br>
line, there can be no line break:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo that.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp; # Error!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo that<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.name&nbsp;&nbsp;# Error!</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#import-map" name="import-map">import-map</a><br>
When you've imported a function from one script into a vim9 script you can<br>
refer to the imported function in a mapping by prefixing it with&nbsp;<a class="Identifier" href="map.html#<SID>">&lt;SID&gt;</a>:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noremap &lt;silent&gt; ,a :call &lt;SID&gt;name.Function()&lt;CR&gt;</div>
<br>
When the mapping is defined &quot;<span class="Special">&lt;SID&gt;</span>name.&quot; will be replaced with&nbsp;<span class="Special">&lt;SNR&gt;</span>&nbsp;and the<br>
script ID of the imported script.<br>
An even simpler solution is using&nbsp;<a class="Identifier" href="map.html#<ScriptCmd>">&lt;ScriptCmd&gt;</a>:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noremap ,a &lt;ScriptCmd&gt;name.Function()&lt;CR&gt;</div>
<br>
<span class="Todo">Note</span>&nbsp;that this does not work for variables, only for functions.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#import-legacy" name="import-legacy">import-legacy</a>&nbsp;<a class="Constant" href="vim9.html#legacy-import" name="legacy-import">legacy-import</a><br>
<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;can also be used in legacy Vim script.&nbsp;&nbsp;The imported namespace still<br>
becomes script-local, even when the &quot;s:&quot; prefix is not given. For example:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import &quot;myfile.vim&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call s:myfile.MyFunc()</div>
<br>
And using the &quot;as name&quot; form:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import &quot;otherfile.vim9script&quot; as that<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call s:that.OtherFunc()</div>
<br>
However, the namespace cannot be resolved on its own:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import &quot;that.vim&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s:that<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot; ERROR: E1060: Expected dot after name: s:that</div>
<br>
This also affects the use of&nbsp;<a class="Identifier" href="map.html#<SID>">&lt;SID&gt;</a>&nbsp;in the legacy mapping context.&nbsp;&nbsp;Since<br>
<a class="Identifier" href="map.html#<SID>">&lt;SID&gt;</a>&nbsp;is only a valid prefix for a function and NOT for a namespace, you<br>
cannot use it<br>
to scope a function in a script local namespace. Instead of prefixing the<br>
function with&nbsp;<a class="Identifier" href="map.html#<SID>">&lt;SID&gt;</a>&nbsp;you should use<a class="Identifier" href="map.html#<ScriptCmd>">&lt;ScriptCmd&gt;</a>. For example:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noremap ,a &lt;ScriptCmd&gt;:call s:that.OtherFunc()&lt;CR&gt;</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:import-cycle" name=":import-cycle">:import-cycle</a><br>
The&nbsp;<a class="Comment" href="vim9.html#:import">import</a>&nbsp;commands are executed when encountered.&nbsp;&nbsp;If script A imports<br>
script B, and B (directly or indirectly) imports A, this will be skipped over.<br>
At this point items in A after &quot;import B&quot; will not have been processed and<br>
defined yet.&nbsp;&nbsp;Therefore cyclic imports can exist and not result in an error<br>
directly, but may result in an error for items in A after &quot;import B&quot; not being<br>
defined.&nbsp;&nbsp;This does not apply to autoload imports, see the next section.<br>
<br>
<br>
<span class="PreProc">Importing an autoload script</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-autoload" name="vim9-autoload">vim9-autoload</a>&nbsp;<a class="Constant" href="vim9.html#import-autoload" name="import-autoload">import-autoload</a><br>
For optimal startup speed, loading scripts should be postponed until they are<br>
actually needed.&nbsp;&nbsp;Using the autoload mechanism is recommended:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1264" name="E1264">E1264</a><br>
1. In the plugin define user commands, functions and/or mappings that refer to<br>
&nbsp;&nbsp; items imported from an autoload script.<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import autoload 'for/search.vim'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -nargs=1 SearchForStuff search.Stuff(&lt;f-args&gt;)</div>
<br>
&nbsp;&nbsp;&nbsp; This goes in .../plugin/anyname.vim.&nbsp;&nbsp;&quot;anyname.vim&quot; can be freely chosen.<br>
&nbsp;&nbsp; The &quot;SearchForStuff&quot; command is now available to the user.<br>
<br>
&nbsp;&nbsp; The &quot;autoload&quot; argument to&nbsp;<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;means that the script is not loaded<br>
&nbsp;&nbsp; until one of the items is actually used.&nbsp;&nbsp;The script will be found under<br>
&nbsp;&nbsp; the &quot;autoload&quot; directory in&nbsp;<a class="Type" href="options.html#'runtimepath'">'runtimepath'</a>&nbsp;instead of the &quot;import&quot;<br>
&nbsp;&nbsp; directory.&nbsp;&nbsp;Alternatively a relative or absolute name can be used, see<br>
&nbsp;&nbsp; below.<br>
<br>
2. In the autoload script put the bulk of the code.<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export def Stuff(arg: string)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</div>
<br>
&nbsp;&nbsp;&nbsp; This goes in .../autoload/for/search.vim.<br>
<br>
&nbsp;&nbsp; Putting the &quot;search.vim&quot; script under the &quot;/autoload/for/&quot; directory has<br>
&nbsp;&nbsp; the effect that &quot;for#search#&quot; will be prefixed to every exported item.&nbsp;&nbsp;The<br>
&nbsp;&nbsp; prefix is obtained from the file name, as you would to manually in a<br>
&nbsp;&nbsp; legacy autoload script.&nbsp;&nbsp;Thus the exported function can be found with<br>
&nbsp;&nbsp; &quot;for#search#Stuff&quot;, but you would normally use&nbsp;<span class="Comment">import autoload</span>&nbsp;and not<br>
&nbsp;&nbsp; use the prefix (which has the side effect of loading the autoload script<br>
&nbsp;&nbsp; when compiling a function that encounters this name).<br>
<br>
&nbsp;&nbsp; You can split up the functionality and import other scripts from the<br>
&nbsp;&nbsp; autoload script as you like.&nbsp;&nbsp;This way you can share code between plugins.<br>
<br>
Searching for the autoload script in all entries in&nbsp;<a class="Type" href="options.html#'runtimepath'">'runtimepath'</a>&nbsp;can be a bit<br>
slow.&nbsp;&nbsp;If the plugin knows where the script is located, quite often a relative<br>
path can be used.&nbsp;&nbsp;This avoids the search and should be quite a bit faster.<br>
Another advantage is that the script name does not need to be unique.&nbsp;&nbsp;An<br>
absolute path is also possible.&nbsp;&nbsp;Examples:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import autoload '../lib/implement.vim'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import autoload MyScriptsDir .. '/lib/implement.vim'</div>
<br>
For defining a mapping that uses the imported autoload script the special key<br>
<a class="Identifier" href="map.html#<ScriptCmd>">&lt;ScriptCmd&gt;</a>&nbsp;is useful.&nbsp;&nbsp;It allows for a command in a mapping to use the<br>
script context of where the mapping was defined.<br>
<br>
When compiling a&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;function and a function in an autoload script is<br>
encountered, the script is not loaded until the&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;function is called.<br>
This also means you get any errors only at runtime, since the argument and<br>
return types are not known yet.&nbsp;&nbsp;If you would use the name with '#' characters<br>
then the autoload script IS loaded.<br>
<br>
Be careful to not refer to an item in an autoload script that does trigger<br>
loading it unintentionally.&nbsp;&nbsp;For example, when setting an option that takes a<br>
function name, make sure to use a string, not a function reference:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import autoload 'qftf.vim'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quickfixtextfunc = 'qftf.Func'&nbsp;&nbsp;# autoload script NOT loaded<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quickfixtextfunc = qftf.Func&nbsp;&nbsp;&nbsp;&nbsp;# autoload script IS loaded</div>
On the other hand, it can be useful to load the script early, at a time when<br>
any errors should be given.<br>
<br>
For testing the&nbsp;<a class="Identifier" href="testing.html#test_override()">test_override()</a>&nbsp;function can be used to have the<br>
<span class="Comment">import autoload</span>&nbsp;load the script right away, so that the items and types can<br>
be checked without waiting for them to be actually used:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_override('autoload', 1)</div>
Reset it later with:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_override('autoload', 0)</div>
Or:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_override('ALL', 0)</div>
<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
6. Future work: classes&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-classes" name="vim9-classes">vim9-classes</a><br>
<br>
Above &quot;class&quot; was mentioned a few times, but it has not been implemented yet.<br>
Most of Vim9 script can be created without this functionality, and since<br>
implementing classes is going to be a lot of work, it is left for the future.<br>
For now we'll just make sure classes can be added later.<br>
<br>
Thoughts:<br>
-&nbsp;<a class="Comment" href="vim9.html#:class">class</a>&nbsp;/&nbsp;<a class="Comment" href="vim9.html#:endclass">endclass</a>, the whole class must be in one file<br>
- Class names are always CamelCase (to avoid a name clash with builtin types)<br>
- A single constructor called &quot;constructor&quot;<br>
- Single inheritance with&nbsp;<span class="Comment">class ThisClass extends BaseClass</span><br>
-&nbsp;<span class="Comment">abstract class</span>&nbsp;(class with incomplete implementation)<br>
-&nbsp;<a class="Comment" href="vim9.html#:interface">interface</a>&nbsp;/&nbsp;<a class="Comment" href="vim9.html#:endinterface">endinterface</a>&nbsp;(abstract class without any implementation)<br>
-&nbsp;<span class="Comment">class SomeClass implements SomeInterface</span><br>
- Generics for class:&nbsp;<span class="Comment">class &lt;Tkey, Tentry&gt;</span><br>
- Generics for function:&nbsp;<span class="Comment">def &lt;Tkey&gt; GetLast(key: Tkey)</span><br>
<br>
Again, much of this is from TypeScript with a slightly different syntax.<br>
<br>
Some things that look like good additions:<br>
- Use a class as an interface (like Dart)<br>
- Extend a class with methods, using an import (like Dart)<br>
- Mixins<br>
- For testing: Mock mechanism<br>
<br>
An important class that will be provided is &quot;Promise&quot;.&nbsp;&nbsp;Since Vim is single<br>
threaded, connecting asynchronous operations is a natural way of allowing<br>
plugins to do their work without blocking the user.&nbsp;&nbsp;It's a uniform way to<br>
invoke callbacks and handle timeouts and errors.<br>
<br>
Some commands have already been reserved:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:class" name=":class">:class</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:endclass" name=":endclass">:endclass</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:abstract" name=":abstract">:abstract</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:enum" name=":enum">:enum</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:endenum" name=":endenum">:endenum</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:interface" name=":interface">:interface</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:endinterface" name=":endinterface">:endinterface</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:static" name=":static">:static</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:type" name=":type">:type</a><br>
<br>
Some examples:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abstract class Person&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static const prefix = 'xxx'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name: string<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def constructor(name: string)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.name = name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def display(): void<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;abstract def find(string): Person<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endclass</div>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
9. Rationale&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-rationale" name="vim9-rationale">vim9-rationale</a><br>
<br>
<span class="PreProc">The :def command</span><br>
<br>
Plugin writers have asked for much faster Vim script.&nbsp;&nbsp;Investigations have<br>
shown that keeping the existing semantics of function calls make this close to<br>
impossible, because of the overhead involved with calling a function, setting<br>
up the local function scope and executing lines.&nbsp;&nbsp;There are many details that<br>
need to be handled, such as error messages and exceptions.&nbsp;&nbsp;The need to create<br>
a dictionary for a: and l: scopes, the a:000 list and several others add too<br>
much overhead that cannot be avoided.<br>
<br>
Therefore the&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;method to define a new-style function had to be added,<br>
which allows for a function with different semantics.&nbsp;&nbsp;Most things still work<br>
as before, but some parts do not.&nbsp;&nbsp;A new way to define a function was<br>
considered the best way to separate the legacy style code from Vim9 style code.<br>
<br>
Using &quot;def&quot; to define a function comes from Python. Other languages use<br>
&quot;function&quot; which clashes with legacy Vim script.<br>
<br>
<br>
<span class="PreProc">Type checking</span><br>
<br>
When compiling lines of Vim commands into instructions as much as possible<br>
should be done at compile time.&nbsp;&nbsp;Postponing it to runtime makes the execution<br>
slower and means mistakes are found only later.&nbsp;&nbsp;For example, when<br>
encountering the &quot;+&quot; character and compiling this into a generic add<br>
instruction, at runtime the instruction would have to inspect the type of the<br>
arguments and decide what kind of addition to do.&nbsp;&nbsp;And when the type is<br>
dictionary throw an error.&nbsp;&nbsp;If the types are known to be numbers then an &quot;add<br>
number&quot; instruction can be used, which is faster.&nbsp;&nbsp;The error can be given at<br>
compile time, no error handling is needed at runtime, since adding two numbers<br>
cannot fail.<br>
<br>
The syntax for types, using&nbsp;<span class="Special">&lt;type&gt;</span>&nbsp;for compound types, is similar to Java.&nbsp;&nbsp;It<br>
is easy to understand and widely used.&nbsp;&nbsp;The type names are what were used in<br>
Vim before, with some additions such as &quot;void&quot; and &quot;bool&quot;.<br>
<br>
<br>
<span class="PreProc">Removing clutter and weirdness</span><br>
<br>
Once decided that&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;functions have different syntax than legacy functions,<br>
we are free to add improvements to make the code more familiar for users who<br>
know popular programming languages.&nbsp;&nbsp;In other words: remove weird things that<br>
only Vim does.<br>
<br>
We can also remove clutter, mainly things that were done to make Vim script<br>
backwards compatible with the good old Vi commands.<br>
<br>
Examples:<br>
- Drop&nbsp;<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;for calling a function and&nbsp;<a class="Comment" href="eval.html#:eval">:eval</a>&nbsp;for evaluating an<br>
&nbsp;&nbsp;expression.<br>
- Drop using a leading backslash for line continuation, automatically figure<br>
&nbsp;&nbsp;out where an expression ends.<br>
<br>
However, this does require that some things need to change:<br>
- Comments start with # instead of &quot;, to avoid confusing them with strings.<br>
&nbsp;&nbsp;This is good anyway, it is also used by several popular languages.<br>
- Ex command ranges need to be prefixed with a colon, to avoid confusion with<br>
&nbsp;&nbsp;expressions (single quote can be a string or a mark, &quot;/&quot; can be divide or a<br>
&nbsp;&nbsp;search command, etc.).<br>
<br>
Goal is to limit the differences.&nbsp;&nbsp;A good criteria is that when the old syntax<br>
is accidentally used you are very likely to get an error message.<br>
<br>
<br>
<span class="PreProc">Syntax and semantics from popular languages</span><br>
<br>
Script writers have complained that the Vim script syntax is unexpectedly<br>
different from what they are used to.&nbsp;&nbsp;To reduce this complaint popular<br>
languages are used as an example.&nbsp;&nbsp;At the same time, we do not want to abandon<br>
the well-known parts of legacy Vim script.<br>
<br>
For many things TypeScript is followed.&nbsp;&nbsp;It's a recent language that is<br>
gaining popularity and has similarities with Vim script.&nbsp;&nbsp;It also has a<br>
mix of static typing (a variable always has a known value type) and dynamic<br>
typing (a variable can have different types, this changes at runtime).&nbsp;&nbsp;Since<br>
legacy Vim script is dynamically typed and a lot of existing functionality<br>
(esp. builtin functions) depends on that, while static typing allows for much<br>
faster execution, we need to have this mix in Vim9 script.<br>
<br>
There is no intention to completely match TypeScript syntax and semantics.&nbsp;&nbsp;We<br>
just want to take those parts that we can use for Vim and we expect Vim users<br>
will be happy with.&nbsp;&nbsp;TypeScript is a complex language with its own history,<br>
advantages and disadvantages.&nbsp;&nbsp;To get an idea of the disadvantages read the<br>
book: &quot;JavaScript: The Good Parts&quot;.&nbsp;&nbsp;Or find the article &quot;TypeScript: the good<br>
parts&quot; and read the &quot;Things to avoid&quot; section.<br>
<br>
People familiar with other languages (Java, Python, etc.) will also find<br>
things in TypeScript that they do not like or do not understand.&nbsp;&nbsp;We'll try to<br>
avoid those things.<br>
<br>
Specific items from TypeScript we avoid:<br>
- Overloading &quot;+&quot;, using it both for addition and string concatenation.&nbsp;&nbsp;This<br>
&nbsp;&nbsp;goes against legacy Vim script and often leads to mistakes.&nbsp;&nbsp;For that reason<br>
&nbsp;&nbsp;we will keep using &quot;..&quot; for string concatenation.&nbsp;&nbsp;Lua also uses &quot;..&quot; this<br>
&nbsp;&nbsp;way.&nbsp;&nbsp;And it allows for conversion to string for more values.<br>
- TypeScript can use an expression like &quot;99 ||&nbsp;<span class="MissingTag">'yes'</span>&quot; in a condition, but<br>
&nbsp;&nbsp;cannot assign the value to a boolean.&nbsp;&nbsp;That is inconsistent and can be<br>
&nbsp;&nbsp;annoying.&nbsp;&nbsp;Vim recognizes an expression with &amp;&amp; or || and allows using the<br>
&nbsp;&nbsp;result as a bool.&nbsp;&nbsp;The&nbsp;<a class="Identifier" href="eval.html#falsy-operator">falsy-operator</a>&nbsp;was added for the mechanism to use a<br>
&nbsp;&nbsp;default value.<br>
- TypeScript considers an empty string as Falsy, but an empty list or dict as<br>
&nbsp;&nbsp;Truthy.&nbsp;&nbsp;That is inconsistent.&nbsp;&nbsp;In Vim an empty list and dict are also<br>
&nbsp;&nbsp;Falsy.<br>
- TypeScript has various &quot;Readonly&quot; types, which have limited usefulness,<br>
&nbsp;&nbsp;since a type cast can remove the immutable nature.&nbsp;&nbsp;Vim locks the value,<br>
&nbsp;&nbsp;which is more flexible, but is only checked at runtime.<br>
- TypeScript has a complicated &quot;import&quot; statement that does not match how the<br>
&nbsp;&nbsp;Vim import mechanism works.&nbsp;&nbsp;A much simpler mechanism is used instead, which<br>
&nbsp;&nbsp;matches that the imported script is only sourced once.<br>
<br>
<br>
<span class="PreProc">Declarations</span><br>
<br>
Legacy Vim script uses&nbsp;<a class="Comment" href="eval.html#:let">:let</a>&nbsp;for every assignment, while in Vim9 declarations<br>
are used.&nbsp;&nbsp;That is different, thus it's good to use a different command:<br>
<a class="Comment" href="vim9.html#:var">:var</a>.&nbsp;&nbsp;This is used in many languages.&nbsp;&nbsp;The semantics might be slightly<br>
different, but it's easily recognized as a declaration.<br>
<br>
Using&nbsp;<a class="Comment" href="eval.html#:const">:const</a>&nbsp;&nbsp;for constants is common, but the semantics varies.&nbsp;&nbsp;Some<br>
languages only make the variable immutable, others also make the value<br>
immutable.&nbsp;&nbsp;Since &quot;final&quot; is well known from Java for only making the variable<br>
immutable we decided to use that.&nbsp;&nbsp;And then&nbsp;<a class="Comment" href="eval.html#:const">:const</a>&nbsp;can be used for making<br>
both immutable.&nbsp;&nbsp;This was also used in legacy Vim script and the meaning is<br>
almost the same.<br>
<br>
What we end up with is very similar to Dart:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # mutable variable and value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:final name&nbsp;&nbsp;&nbsp;&nbsp; # immutable variable, mutable value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:const name&nbsp;&nbsp;&nbsp;&nbsp; # immutable variable and value</div>
<br>
Since legacy and Vim9 script will be mixed and global variables will be<br>
shared, optional type checking is desirable.&nbsp;&nbsp;Also, type inference will avoid<br>
the need for specifying the type in many cases.&nbsp;&nbsp;The TypeScript syntax fits<br>
best for adding types to declarations:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name: string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# string type is specified<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name = 'John'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const greeting = 'hello'&nbsp;&nbsp;# string type is inferred</div>
<br>
This is how we put types in a declaration:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist: list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final mylist: list&lt;string&gt; = ['foo']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Func(arg1: number, arg2: string): bool</div>
<br>
Two alternatives were considered:<br>
1. Put the type before the name, like Dart:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var list&lt;string&gt; mylist<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final list&lt;string&gt; mylist = ['foo']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Func(number arg1, string arg2) bool</div>
2. Put the type after the variable name, but do not use a colon, like Go:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final mylist list&lt;string&gt; = ['foo']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Func(arg1 number, arg2 string) bool</div>
<br>
The first is more familiar for anyone used to C or Java.&nbsp;&nbsp;The second one<br>
doesn't really have an advantage over the first, so let's discard the second.<br>
<br>
Since we use type inference the type can be left out when it can be inferred<br>
from the value.&nbsp;&nbsp;This means that after&nbsp;<a class="Comment" href="vim9.html#:var">var</a>&nbsp;we don't know if a type or a name<br>
follows.&nbsp;&nbsp;That makes parsing harder, not only for Vim but also for humans.<br>
Also, it will not be allowed to use a variable name that could be a type name,<br>
using&nbsp;<span class="Comment">var string string</span>&nbsp;is too confusing.<br>
<br>
The chosen syntax, using a colon to separate the name from the type, adds<br>
punctuation, but it actually makes it easier to recognize the parts of a<br>
declaration.<br>
<br>
<br>
<span class="PreProc">Expressions</span><br>
<br>
Expression evaluation was already close to what other languages are doing.<br>
Some details are unexpected and can be improved.&nbsp;&nbsp;For example a boolean<br>
condition would accept a string, convert it to a number and check if the<br>
number is non-zero.&nbsp;&nbsp;This is unexpected and often leads to mistakes, since<br>
text not starting with a number would be converted to zero, which is<br>
considered false.&nbsp;&nbsp;Thus using a string for a condition would often not give an<br>
error and be considered false.&nbsp;&nbsp;That is confusing.<br>
<br>
In Vim9 type checking is stricter to avoid mistakes.&nbsp;&nbsp;Where a condition is<br>
used, e.g. with the&nbsp;<a class="Comment" href="eval.html#:if">:if</a>&nbsp;command and the&nbsp;<span class="Comment">||</span>&nbsp;operator, only boolean-like<br>
values are accepted:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true:&nbsp;&nbsp;<a class="Comment" href="vim9.html#true">true</a>,&nbsp;<a class="Comment" href="eval.html#v:true">v:true</a>,&nbsp;<span class="Comment">1</span>,&nbsp;<span class="Comment">0 &lt; 9</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false:&nbsp;<a class="Comment" href="vim9.html#false">false</a>,&nbsp;<a class="Comment" href="eval.html#v:false">v:false</a>,&nbsp;<a class="Comment" href="motion.html#0">0</a>,&nbsp;<span class="Comment">0 &gt; 9</span><br>
<span class="Todo">Note</span>&nbsp;that the number zero is false and the number one is true.&nbsp;&nbsp;This is more<br>
permissive than most other languages.&nbsp;&nbsp;It was done because many builtin<br>
functions return these values, and changing that causes more problems than it<br>
solves.&nbsp;&nbsp;After using this for a while it turned out to work well.<br>
<br>
If you have any type of value and want to use it as a boolean, use the&nbsp;<a class="Comment" href="change.html#!!">!!</a><br>
operator:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true:&nbsp;<span class="Comment">!!'text'</span>&nbsp;&nbsp;&nbsp;<span class="Comment">!![99]</span>&nbsp;&nbsp;&nbsp;<span class="Comment">!!{'x': 1}</span>&nbsp;&nbsp;&nbsp;<span class="Comment">!!99</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false:&nbsp;<span class="Comment">!!''</span>&nbsp;&nbsp;&nbsp;<span class="Comment">!![]</span>&nbsp;&nbsp;&nbsp;<span class="Comment">!!{}</span><br>
<br>
From a language like JavaScript we have this handy construct:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetName() || 'unknown'</div>
However, this conflicts with only allowing a boolean for a condition.<br>
Therefore the &quot;??&quot; operator was added:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetName() ?? 'unknown'</div>
Here you can explicitly express your intention to use the value as-is and not<br>
result in a boolean. This is called the&nbsp;<a class="Identifier" href="eval.html#falsy-operator">falsy-operator</a>.<br>
<br>
<br>
<span class="PreProc">Import and Export</span><br>
<br>
A problem of legacy Vim script is that by default all functions and variables<br>
are global.&nbsp;&nbsp;It is possible to make them script-local, but then they are not<br>
available in other scripts.&nbsp;&nbsp;This defies the concept of a package that only<br>
exports selected items and keeps the rest local.<br>
<br>
In Vim9 script a mechanism very similar to the JavaScript import and export<br>
mechanism is supported.&nbsp;&nbsp;It is a variant to the existing&nbsp;<a class="Comment" href="repeat.html#:source">:source</a>&nbsp;command<br>
that works like one would expect:<br>
- Instead of making everything global by default, everything is script-local,<br>
&nbsp;&nbsp;some of these are exported.<br>
- When importing a script the symbols that are imported are explicitly listed,<br>
&nbsp;&nbsp;avoiding name conflicts and failures if functionality is added later.<br>
- The mechanism allows for writing a big, long script with a very clear API:<br>
&nbsp;&nbsp;the exported functions, variables and classes.<br>
- By using relative paths loading can be much faster for an import inside of a<br>
&nbsp;&nbsp;package, no need to search many directories.<br>
- Once an import has been used, its items are cached and loading it again is<br>
&nbsp;&nbsp;not needed.<br>
- The Vim-specific use of &quot;s:&quot; to make things script-local can be dropped.<br>
<br>
When sourcing a Vim9 script (from a Vim9 or legacy script), only the items<br>
defined globally can be used, not the exported items.&nbsp;&nbsp;Alternatives<br>
considered:<br>
- All the exported items become available as script-local items.&nbsp;&nbsp;This makes<br>
&nbsp;&nbsp;it uncontrollable what items get defined and likely soon leads to trouble.<br>
- Use the exported items and make them global.&nbsp;&nbsp;Disadvantage is that it's then<br>
&nbsp;&nbsp;not possible to avoid name clashes in the global namespace.<br>
- Completely disallow sourcing a Vim9 script, require using&nbsp;<a class="Comment" href="vim9.html#:import">:import</a>.&nbsp;&nbsp;That<br>
&nbsp;&nbsp;makes it difficult to use scripts for testing, or sourcing them from the<br>
&nbsp;&nbsp;command line to try them out.<br>
<span class="Todo">Note</span>&nbsp;that you CAN also use&nbsp;<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;in legacy Vim script, see above.<br>
<br>
<br>
<span class="PreProc">Compiling functions early</span><br>
<br>
Functions are compiled when called or when&nbsp;<a class="Comment" href="vim9.html#:defcompile">:defcompile</a>&nbsp;is used.&nbsp;&nbsp;Why not<br>
compile them early, so that syntax and type errors are reported early?<br>
<br>
The functions can't be compiled right away when encountered, because there may<br>
be forward references to functions defined later.&nbsp;&nbsp;Consider defining functions<br>
A, B and C, where A calls B, B calls C, and C calls A again.&nbsp;&nbsp;It's impossible<br>
to reorder the functions to avoid forward references.<br>
<br>
An alternative would be to first scan through the file to locate items and<br>
figure out their type, so that forward references are found, and only then<br>
execute the script and compile the functions.&nbsp;&nbsp;This means the script has to be<br>
parsed twice, which is slower, and some conditions at the script level, such<br>
as checking if a feature is supported, are hard to use.&nbsp;&nbsp;An attempt was made<br>
to see if it works, but it turned out to be impossible to make work well.<br>
<br>
It would be possible to compile all the functions at the end of the script.<br>
The drawback is that if a function never gets called, the overhead of<br>
compiling it counts anyway.&nbsp;&nbsp;Since startup speed is very important, in most<br>
cases it's better to do it later and accept that syntax and type errors are<br>
only reported then.&nbsp;&nbsp;In case these errors should be found early, e.g. when<br>
testing, a&nbsp;<a class="Comment" href="vim9.html#:defcompile">:defcompile</a>&nbsp;command at the end of the script will help out.<br>
<br>
<br>
<span class="PreProc">Why not use an existing embedded language?</span><br>
<br>
Vim supports interfaces to Perl, Python, Lua, Tcl and a few others.&nbsp;&nbsp;But<br>
these interfaces have never become widely used, for various reasons.&nbsp;&nbsp;When<br>
Vim9 was designed a decision was made to make these interfaces lower priority<br>
and concentrate on Vim script.<br>
<br>
Still, plugin writers may find other languages more familiar, want to use<br>
existing libraries or see a performance benefit.&nbsp;&nbsp;We encourage plugin authors<br>
to write code in any language and run it as an external process, using jobs<br>
and channels.&nbsp;&nbsp;We can try to make this easier somehow.<br>
<br>
Using an external tool also has disadvantages.&nbsp;&nbsp;An alternative is to convert<br>
the tool into Vim script.&nbsp;&nbsp;For that to be possible without too much<br>
translation, and keeping the code fast at the same time, the constructs of the<br>
tool need to be supported.&nbsp;&nbsp;Since most languages support classes the lack of<br>
support for classes in Vim is then a problem.<br>
<br>
<br>
<span class="PreProc">Classes</span><br>
<br>
Vim supports a kind-of object oriented programming by adding methods to a<br>
dictionary.&nbsp;&nbsp;With some care this can be made to work, but it does not look<br>
like real classes.&nbsp;&nbsp;On top of that, it's quite slow, because of the use of<br>
dictionaries.<br>
<br>
It would be good to support real classes, and this is planned for a later<br>
version.&nbsp;&nbsp;The support is a &quot;minimal common functionality&quot; of class support in<br>
most languages.&nbsp;&nbsp;It will work much like Java, which is the most popular<br>
programming language.<br>
<br>
<br>
<br>
&nbsp;vim:tw=78:ts=8:noet:ft=help:norl:<br>
</div>
