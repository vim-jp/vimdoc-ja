---
layout: vimdoc
helpname: 'vim9'
---
<div id='vimCodeElement'>
<a class="Constant" href="vim9.html" name="vim9.txt">vim9.txt</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For&nbsp;<span class="Identifier">Vim バージョン 9.1.</span>&nbsp;&nbsp;Last change: 2025 Oct 06<br>
<br>
<br>
<span class="Identifier">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;VIM リファレンスマニュアル&nbsp;&nbsp;&nbsp;&nbsp;by Bram Moolenaar</span><br>
<br>
<br>
Vim9 script のコマンドと文法&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#Vim9" name="Vim9">Vim9</a>&nbsp;<a class="Constant" href="vim9.html#vim9" name="vim9">vim9</a><br>
<br>
ほとんどの文法については&nbsp;<a class="Identifier" href="eval.html">eval.txt</a>&nbsp;で解説されている。このファイルには Vim9<br>
script の新しい文法と機能について書かれている。<br>
<br>
<br>
1.&nbsp;&nbsp;Vim9 script とは&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#Vim9-script">Vim9-script</a><br>
2.&nbsp;&nbsp;変更点&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9-differences">vim9-differences</a><br>
3.&nbsp;&nbsp;新しいスタイルの関数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#fast-functions">fast-functions</a><br>
4.&nbsp;&nbsp;型&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9-types">vim9-types</a><br>
5.&nbsp;&nbsp;ジェネリック関数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#generic-functions">generic-functions</a><br>
6.&nbsp;&nbsp;名前空間、Import と Export&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9script">vim9script</a><br>
7.&nbsp;&nbsp;クラスとインターフェイス&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9-classes">vim9-classes</a><br>
8.&nbsp;&nbsp;理論的根拠&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9-rationale">vim9-rationale</a><br>
<br>
<br>
<span class="PreProc">------------------------------------------------------------------------------</span><br>
<br>
&nbsp;&nbsp;<span class="Todo">NOTE</span>: この vim9.txt ヘルプファイルでは、<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;で始まる Vim9 script の<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;コードブロックは、Vim9 script の構文がハイライトされている。また、これ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;らはソースとして実行できるため、実行して出力内容を確認できる。ソースと<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;して実行するには、<span class="Comment">:'&lt;,'&gt;source</span>&nbsp;を使用する (<a class="Identifier" href="repeat.html#:source-range">:source-range</a>&nbsp;を参照)。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;これは、<a class="Identifier" href="visual.html#V">V</a>&nbsp;で行を視覚的に選択し、<a class="Comment" href="repeat.html#:so">:so</a>&nbsp;と入力することで実行できる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;例えば、以下の Vim9 script で試してみてほしい: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echowindow &quot;Welcome to Vim9 script!&quot;<br>
&lt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ソースコードとして提供すべきではないコード例もある。これらは、ソース<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;コードとして提供可能な例を必要としない概念を説明しているものである。こ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;のようなコードブロックは、以下のように、汎用コード構文のハイライトで表<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;示される:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def ThisFunction()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# スクリプトローカル<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def g:ThatFunction()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# グローバル<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export def Function()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # import および import の自動ロー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ド用</div>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
1. Vim9 script とは&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#Vim9-script" name="Vim9-script">Vim9-script</a><br>
<br>
<br>
Vim script は、互換性の維持に気を配りながら成長してきた。そのため、古い悪しき<br>
仕様を変更できないことが多い他、Vi との互換性に制約を受けて、より良い解決策を<br>
採用できなくなっている。処理は遅く、実行するたびに各行のパースが行われている。<br>
<br>
Vim9 script の主な目的は劇的な性能の向上である。これは、コマンドをより効率よく<br>
実行できる命令にコンパイルすることで実現している。これにより、10 倍から 100 倍<br>
の実行速度の向上が期待できる。<br>
<br>
第 2 の目的は、Vim script 特有の文法を回避し、より一般的に使われる JavaScript<br>
や TypeScript、Java のようなプログラミング言語に近づけることである。<br>
<br>
パフォーマンスの向上は、100% の下位互換性を捨てることによってのみ達成しうるも<br>
のである。例えば、関数の引数を辞書 &quot;a:&quot; から利用できるようにするためには、かな<br>
りのオーバーヘッドが必要になる。そのため、Vim9 script では、この辞書が使用でき<br>
なくなった。その他の違いは、エラーの処理方法など、より微細なものである。<br>
<br>
Vim9 script は以下の場所で使用することができる:<br>
- コマンド&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義された関数の中<br>
- コマンド&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;で始まるスクリプトファイルの中<br>
- 上記のコンテキストで定義された自動コマンド<br>
- コマンド修飾子&nbsp;<a class="Comment" href="vim9.html#:vim9cmd">vim9cmd</a>&nbsp;が先頭に付いたコマンド<br>
<br>
Vim9 script ファイル内で&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;を使用する場合、最高の&nbsp;<a class="Identifier" href="eval.html#scriptversion">scriptversion</a>&nbsp;を<br>
持つ旧来の構文が使用される。ただし、これは混乱を招く可能性があるため、推奨され<br>
ない。<br>
<br>
Vim9 script と旧来の Vim script を混在させることができる。古いスクリプトを書き<br>
直す必要はなく、以前と同じように動作する。高速化が必要なコードには、いくつかの<br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;関数を使用するとよいだろう。<br>
<br>
:vim9<span class="Special">[cmd]</span>&nbsp;<span class="Special">{cmd}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:vim9" name=":vim9">:vim9</a>&nbsp;<a class="Constant" href="vim9.html#:vim9cmd" name=":vim9cmd">:vim9cmd</a>&nbsp;<a class="Constant" href="vim9.html#E1164" name="E1164">E1164</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vim9 script の構文とセマンティクスを使用して&nbsp;<span class="Special">{cmd}</span>&nbsp;を評価、実<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;行する。コマンドを入力する時や、旧来のスクリプトまたは関数内で<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;便利である。<br>
<br>
:leg[acy]&nbsp;<span class="Special">{cmd}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:leg" name=":leg">:leg</a>&nbsp;<a class="Constant" href="vim9.html#:legacy" name=":legacy">:legacy</a>&nbsp;<a class="Constant" href="vim9.html#E1189" name="E1189">E1189</a>&nbsp;<a class="Constant" href="vim9.html#E1234" name="E1234">E1234</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧来のスクリプト構文とセマンティクスを使用して&nbsp;<span class="Special">{cmd}</span>&nbsp;を評価、<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;実行する。Vim9 script または :def 関数内でのみ便利である。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Todo">Note</span>&nbsp;<span class="Special">{cmd}</span>&nbsp;は旧来の式構文で解析されるため、ローカル変数を使用<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;できないことに注意。<br>
<br>
<a class="Identifier" href="usr_52.html#52.6">52.6</a>&nbsp;の Vim9 script の例を参照。<br>
<span class="PreProc">==============================================================================</span><br>
<br>
2. 旧来の Vim script からの変更点&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-differences" name="vim9-differences">vim9-differences</a><br>
<br>
<span class="PreProc">概要</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1146" name="E1146">E1146</a><br>
Vim9 script と :def 関数を使用するときに最も頻繁に遭遇する違いの簡単な概要。<br>
詳細は以下の通り:<br>
- コメントは &quot; ではなく、# で始める:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo &quot;hello&quot;&nbsp;&nbsp; # コメント</div>
- 行継続にバックスラッシュを使用する必要はほとんどない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo &quot;hello &quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .. yourName<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .. &quot;, how are you?&quot;</div>
- 読みやすさを向上させるために、多くの場所で空白が必要である。<br>
-&nbsp;<a class="Comment" href="eval.html#:let">:let</a>&nbsp;<a class="Constant" href="vim9.html#E1126" name="E1126">E1126</a>&nbsp;を使用せずに値を代入し、<a class="Comment" href="vim9.html#:var">:var</a>&nbsp;を使用して変数を宣言する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var count = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count += 3</div>
-&nbsp;<a class="Comment" href="vim9.html#:final">:final</a>&nbsp;と&nbsp;<a class="Comment" href="eval.html#:const">:const</a>&nbsp;を使用して、定数を宣言できる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final matches = []&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 後でこのリストに追加する<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const names = ['Betty', 'Peter']&nbsp;&nbsp;# 変更できない</div>
-&nbsp;<a class="Comment" href="vim9.html#:final">:final</a>&nbsp;は&nbsp;<a class="Comment" href="eval.html#:finally">:finally</a>&nbsp;の略語として使用することはできない。<br>
- 変数と関数は、デフォルトではスクリプトローカルである。<br>
- 関数は引数の型と戻り値の型で宣言される:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallMe(count: number, message: string): bool</div>
-&nbsp;<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;なしで関数を呼び出す:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writefile(['done'], 'file.txt')</div>
- 古い Ex コマンドは使用できない:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="various.html#:Print">:Print</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="insert.html#:append">:append</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="change.html#:change">:change</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="change.html#:d">:d</a>&nbsp;&nbsp;の直後に 'd' または 'p' が続く。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="insert.html#:insert">:insert</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="motion.html#:k">:k</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="term.html#:mode">:mode</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vi_diff.html#:open">:open</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="change.html#:s">:s</a>&nbsp;&nbsp;とフラグのみ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="change.html#:t">:t</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="editing.html#:xit">:xit</a><br>
- 一部のコマンド、特にフロー制御に使用されるコマンドは短縮できない。<br>
&nbsp;&nbsp;例えば、<a class="Comment" href="eval.html#:throw">:throw</a>&nbsp;を&nbsp;<a class="Comment" href="eval.html#:th">:th</a>&nbsp;と書くことはできない。&nbsp;<a class="Constant" href="vim9.html#vim9-no-shorten" name="vim9-no-shorten">vim9-no-shorten</a><br>
- 波括弧変数は使用できない。<br>
- コマンドの前の範囲にはコロンを前に付ける必要がある:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:%s/this/that</div>
- &quot;@r&quot; でレジスタを実行しても機能しない。先頭にコロンを追加するか、<a class="Comment" href="eval.html#:exe">:exe</a>&nbsp;を使<br>
&nbsp;&nbsp;用する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:exe @a</div>
- 特に指定がない限り、最高の&nbsp;<a class="Identifier" href="eval.html#scriptversion">scriptversion</a>&nbsp;が使用される。<br>
- 式のマッピングを定義すると、式は定義されたスクリプトのコンテキストで評価され<br>
&nbsp;&nbsp;る。<br>
- 文字列をインデックスする場合、インデックスはバイトではなく文字数でカウントさ<br>
&nbsp;&nbsp;れる:<br>
&nbsp;&nbsp;<a class="Identifier" href="vim9.html#vim9-string-index">vim9-string-index</a><br>
- 予想外の相違点がいくつかある:&nbsp;<a class="Identifier" href="vim9.html#vim9-gotchas">vim9-gotchas</a>.<br>
<br>
<span class="PreProc"># から始まるコメント</span><br>
<br>
旧来の Vim script ではコメントは、ダブルクォーテーションで始める。Vim9 script<br>
ではコメントは # で始める。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 宣言<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var count = 0&nbsp;&nbsp;# 出現回数</div>
<br>
理由は、ダブルクォーテーションは文字列の始まりにもなり得るからである。多くの場<br>
所、特に式の途中で改行がある場合、文字列とコメントの両方の後に任意のテキストが<br>
続く可能性があるため、意味がわかりにくくなる。混乱を避けるために、# コメントの<br>
みが認識される。これは、シェルスクリプトや Python プログラムの場合と同じであ<br>
る。<br>
<br>
Vi では、# は数字付きのテキストをリストするコマンドである。Vim9 script では、<br>
そのために&nbsp;<a class="Comment" href="various.html#:number">:number</a>&nbsp;を使用できる。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:101 number</div>
<br>
読みやすさを向上させるには、コマンドとコメントを開始する # の間にスペースが必<br>
要である:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = value # コメント<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = value# エラー!</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1170" name="E1170">E1170</a><br>
コメントを #{ で始めてはならない。これは旧来の辞書リテラルに似ており、混乱を招<br>
く可能性がある場合にエラーが発生する。#{{ "{{" }} または #{{ "{{{" }} は問題ない。これらは折り<br>
たたみを開始するために使用できる。<br>
<br>
スクリプトファイルの読み込みを開始すると、Vim は&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;コマンドが見つか<br>
るまではそれが&nbsp;<a class="Identifier" href="vim9.html#Vim9">Vim9</a>&nbsp;script であることを認識しない。その時点までは、旧来のコ<br>
メントを使用する必要がある:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot; 旧来のコメント<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Vim9 のコメント</div>
<br>
これは見た目が悪いので、<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;を最初の行に置いた方がよい:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Vim9 コメント</div>
<br>
旧来の Vim script では、# は代替ファイル名としても使用される。Vim9 script で<br>
は、代わりに %% を使用する必要がある。## の代わりに %%% (すべての引数を表す)<br>
を使用する。<br>
<br>
<br>
<span class="PreProc">Vim9 関数</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1099" name="E1099">E1099</a><br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義された関数はコンパイルされる。実行速度が何倍も速くなり、多くの場<br>
合 10 から 100 倍になる。<br>
<br>
関数が実行される前に、コンパイル時にすでに多くのエラーが見つかる。構文は厳密<br>
で、読みやすく理解しやすいコードが強制される。<br>
<br>
コンパイルは、以下のいずれかに遭遇した時に実行される:<br>
- 関数が初めて呼び出されたとき<br>
- 関数が定義された後にスクリプト内で&nbsp;<a class="Comment" href="vim9.html#:defcompile">:defcompile</a>&nbsp;コマンドが見つかったとき<br>
- 関数に&nbsp;<a class="Comment" href="vim9.html#:disassemble">:disassemble</a>&nbsp;が使用されるとき<br>
- コンパイルされた関数が関数を呼び出すか、関数参照として使用するとき (引数と戻<br>
&nbsp;&nbsp;り値の型をチェックできるようにするため)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1091" name="E1091">E1091</a>&nbsp;<a class="Constant" href="vim9.html#E1191" name="E1191">E1191</a><br>
コンパイルが失敗した場合、次回の呼び出しでは再試行されず、代わりに次のエラーが<br>
表示される: &quot;E1091: Function is not compiled:&nbsp;<span class="Special">{name}</span>&quot;<br>
まだ作成されていないユーザーコマンドに遭遇すると、コンパイルは失敗する。この場<br>
合、<a class="Comment" href="builtin.html#execute()">execute()</a>&nbsp;を呼び出して実行時に呼び出すことができる。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execute('DefinedLater')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;には、<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;のようなオプションはない: &quot;range&quot;、&quot;abort&quot;、&quot;dict&quot;、<br>
&quot;closure&quot;。<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;関数は、エラーが発生すると常に中止する (コマンドに&nbsp;<a class="Comment" href="various.html#:silent!">:silent!</a><br>
が使用されている場合、またはエラーが&nbsp;<a class="Comment" href="eval.html#:try">:try</a>&nbsp;ブロックでキャッチされた場合を除<br>
く)。範囲は渡されず、&quot;dict&quot; 関数になることはできず、常にクロージャになることが<br>
できる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-no-dict-function" name="vim9-no-dict-function">vim9-no-dict-function</a>&nbsp;<a class="Constant" href="vim9.html#E1182" name="E1182">E1182</a><br>
&quot;dict 関数&quot; の代わりに Vim9 クラス (<a class="Identifier" href="vim9class.html#Vim9-class">Vim9-class</a>) を使用できる。辞書を明示的に<br>
渡すこともできる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def DictFunc(self: dict&lt;any&gt;, arg: string)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo self[arg]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ad = {item: 'value', func: DictFunc}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ad.func(ad, 'item')</div>
<br>
ただし、旧来の辞書関数を呼ぶことはできる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func Legacy() dict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo self.value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfunc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallLegacy()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var d = {func: Legacy, value: 'text'}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d.func()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1096" name="E1096">E1096</a>&nbsp;<a class="Constant" href="vim9.html#E1174" name="E1174">E1174</a>&nbsp;<a class="Constant" href="vim9.html#E1175" name="E1175">E1175</a><br>
引数の型と戻り値の型を指定する必要がある。&quot;any&quot; 型を使用することができ、その場<br>
合は旧来の関数と同様に実行時に型チェックが行われる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1106" name="E1106">E1106</a><br>
引数は、他の言語と同様に、&quot;a:&quot; なしで名前でアクセスされる。&quot;a:&quot; 辞書や &quot;a:000&quot;<br>
リストはない。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-variable-arguments" name="vim9-variable-arguments">vim9-variable-arguments</a>&nbsp;<a class="Constant" href="vim9.html#E1055" name="E1055">E1055</a>&nbsp;<a class="Constant" href="vim9.html#E1160" name="E1160">E1160</a>&nbsp;<a class="Constant" href="vim9.html#E1180" name="E1180">E1180</a><br>
可変引数は最後の引数として定義され、名前を持ち、TypeScript と同様にリスト型を<br>
持つ。例えば、数値のリストは次のようになる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc(...itemlist: list&lt;number&gt;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for item in itemlist<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...</div>
<br>
関数の引数が任意 (デフォルト値を持つ) の場合、引数として&nbsp;<a class="Comment" href="eval.html#v:none">v:none</a>&nbsp;を渡すとデ<br>
フォルト値が使用される。これは、デフォルト値を使用する引数の後に来る引数の値を<br>
指定する場合に便利である。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc(one = 'one', last = 'last')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyFunc(v:none, 'LAST')&nbsp;&nbsp;# 第 1 引数は既定値の 'one' を使う</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-ignored-argument" name="vim9-ignored-argument">vim9-ignored-argument</a>&nbsp;<a class="Constant" href="vim9.html#E1181" name="E1181">E1181</a><br>
引数 &quot;_&quot; (アンダースコア) は、引数を無視するために使用できる。これは引数は必要<br>
ではないが、呼び出しに一致する引数を与える必要があるコールバックで最も役立つ。<br>
例えば、map() を使用する場合、キーと値の 2 つの引数が渡され、キーを無視するに<br>
は:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map(numberList, (_, v) =&gt; v * 2)</div>
&quot;_&quot; 引数を複数回使用してもエラーは発生しない。タイプを指定する必要はない。<br>
<br>
<br>
<span class="PreProc">関数と変数はデフォルトでスクリプトローカル</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-scopes" name="vim9-scopes">vim9-scopes</a><br>
Vim9 script のスクリプトレベルで&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;または&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;を使用して新しい関<br>
数を指定する場合、関数はスクリプトローカルになる。旧来のスクリプトで &quot;s:&quot; をプ<br>
リフィックスとして付けるのと同じである。グローバル関数または変数を定義するに<br>
は、&quot;g:&quot; プリフィックスを使用する必要がある。インポートされるスクリプト内の関<br>
数やオートロードスクリプト内の関数を他の場所で使用するには、&quot;export&quot; を使用す<br>
る必要がある。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def ThisFunction()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# スクリプトローカル<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def g:ThatFunction()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# グローバル<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export def Function()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # import および import autoload 用</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1058" name="E1058">E1058</a>&nbsp;<a class="Constant" href="vim9.html#E1075" name="E1075">E1075</a><br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;関数内で&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;または&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;を使用してネストされた関数を指定し、<br>
名前空間が指定されていない場合、このネストされた関数は定義されているコードブ<br>
ロックに対してローカルになる。文字列引数を持つ&nbsp;<a class="Comment" href="builtin.html#function()">function()</a>&nbsp;で使用することはで<br>
きない。関数参照自体を渡すこと:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Outer()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Inner()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'inner'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Fok = function(Inner)&nbsp;&nbsp;&nbsp;&nbsp; # OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Fbad = function('Inner')&nbsp;&nbsp;# 動作しない</div>
<br>
詳細: これは、&quot;Inner&quot; が実際には生成された名前を持つ関数への関数参照になるため<br>
である。<br>
<br>
関数内でスクリプトローカル関数を定義することはできない。ローカル関数を定義し<br>
て、それをスクリプトローカル Funcref に割り当てることができる (スクリプトレベ<br>
ルで宣言されている必要がある)。&quot;g:&quot; プリフィックスを使用してグローバル関数を定<br>
義することは可能である。<br>
<br>
関数を参照するときに &quot;s:&quot; または &quot;g:&quot; プリフィックスが使用されていない場合、<br>
Vim は関数を次の場所で検索する:<br>
- 関数スコープ内、ブロックスコープ内<br>
- スクリプトスコープ内<br>
<br>
import された関数は、<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;コマンドのプリフィックスで見つかる。<br>
<br>
スクリプトローカル関数の参照は &quot;s:&quot; なしでも使用できるため、&quot;s:&quot; プリフィック<br>
スを使用する場合でも、名前は大文字で始まる必要がある。旧来のスクリプトで<br>
は、&quot;funcref&quot; で参照できなかったため、&quot;s:funcref&quot; を使用できた。Vim9 script で<br>
は参照できるため、組み込み関数と名前が干渉しないように、&quot;s:Funcref&quot; を使用する<br>
必要がある。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-s-namespace" name="vim9-s-namespace">vim9-s-namespace</a>&nbsp;<a class="Constant" href="vim9.html#E1268" name="E1268">E1268</a><br>
Vim9 script レベルでは、プリフィックス &quot;s:&quot; の使用はサポートされていない。プリ<br>
フィックスのないすべての関数と変数はスクリプトローカルである。<br>
<br>
:def 関数では、&quot;s:&quot; の使用はスクリプトによって異なる。旧来のスクリプトのスクリ<br>
プトローカル変数と関数は &quot;s:&quot; を使用するが、Vim9 script では &quot;s:&quot; を使用しな<br>
い。これは、このファイルの残りの部分で見られる内容と一致する。<br>
<br>
旧来の関数では、スクリプト項目に &quot;s:&quot; を以前と同様に使用する必要がある。スクリ<br>
プトが Vim9 であるか旧来のものであるかは関係ない。<br>
<br>
いずれの場合も、関数は使用前に定義する必要がある。つまり、関数が呼び出されると<br>
き、<a class="Comment" href="vim9.html#:defcompile">:defcompile</a>&nbsp;によってコンパイルされるとき、または関数を呼び出すコードがコ<br>
ンパイルされるとき (戻り値の型を判断するため) である。<br>
<br>
その結果、名前空間のない関数と変数は通常、スクリプト内で定義されるか、import<br>
されるかのどちらかで見つかる。グローバル関数と変数はどこでも定義できる (どこで<br>
定義されているか見つけるのは大変である!&nbsp;<a class="Identifier" href="various.html#:verbose">:verbose</a>&nbsp;を使用して最後に設定された<br>
場所を確認できる場合がよくある)。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1102" name="E1102">E1102</a><br>
グローバル関数は、ほぼいつでも定義および削除できる。Vim9 script では、スクリプ<br>
トローカル関数はスクリプトが読み込まれたときに一度定義され、それ自体では削除ま<br>
たは置換できない (スクリプトを再読み込みすることで削除または置換できる)。<br>
<br>
関数をコンパイルし、(まだ) 定義されていない関数の関数呼び出しに遭遇した場合、<br>
<a class="Identifier" href="autocmd.html#FuncUndefined">FuncUndefined</a>&nbsp;自動コマンドはトリガーされない。必要であれば、オートロード関数<br>
を使用するか、旧来の関数を呼び出してそこで&nbsp;<a class="Identifier" href="autocmd.html#FuncUndefined">FuncUndefined</a>&nbsp;をトリガーすること<br>
もできる。<br>
<br>
<br>
<span class="PreProc">デフォルトでは Vim9 script の再読み込みにより関数と変数がクリアされる</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-reload" name="vim9-reload">vim9-reload</a>&nbsp;<a class="Constant" href="vim9.html#E1149" name="E1149">E1149</a>&nbsp;<a class="Constant" href="vim9.html#E1150" name="E1150">E1150</a><br>
旧来の Vim script を 2 回目に読み込むと、何も削除されず、コマンドによって既存<br>
の変数と関数が置き換えられ新しいものが作成され、削除されたものはそのまま残る。<br>
<br>
Vim9 script を 2 回目に読み込むと、既存のスクリプトローカル関数と変数がすべて<br>
削除されるため、クリーンの状態から開始できる。これはプラグインを開発中に新しい<br>
バージョンを試したい場合に便利である。何かの名前を変更した場合、古い名前が残っ<br>
ていることを心配する必要はない。<br>
<br>
アイテムを保持したい場合は、以下を使用する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script noclear</div>
<br>
これは、再度読み込まれたときに、どこかの時点で&nbsp;<a class="Comment" href="repeat.html#:finish">finish</a>&nbsp;コマンドを使用して抜け<br>
出すスクリプトで使用することを想定してる。例えば、バッファローカルなオプション<br>
が関数に設定されている場合、関数を複数回定義する必要はない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script noclear<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setlocal completefunc=SomeFunc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists('*SomeFunc')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finish<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def SomeFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;....</div>
<br>
<br>
<span class="PreProc">:var、:final や :const で宣言する変数</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-declaration" name="vim9-declaration">vim9-declaration</a>&nbsp;<a class="Constant" href="vim9.html#:var" name=":var">:var</a>&nbsp;<a class="Constant" href="vim9.html#E1079" name="E1079">E1079</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1017" name="E1017">E1017</a>&nbsp;<a class="Constant" href="vim9.html#E1020" name="E1020">E1020</a>&nbsp;<a class="Constant" href="vim9.html#E1054" name="E1054">E1054</a>&nbsp;<a class="Constant" href="vim9.html#E1087" name="E1087">E1087</a>&nbsp;<a class="Constant" href="vim9.html#E1124" name="E1124">E1124</a><br>
ローカル変数は&nbsp;<a class="Comment" href="vim9.html#:var">:var</a>&nbsp;で宣言する必要がある。ローカル定数は&nbsp;<a class="Comment" href="vim9.html#:final">:final</a>&nbsp;または<br>
<a class="Comment" href="eval.html#:const">:const</a>&nbsp;で宣言する必要がある。このセクションでは、両方を &quot;変数&quot; と呼ぶ。<br>
<br>
変数はスクリプト、関数、またはコードブロックに対しローカルにすることができる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var script_var = 123<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def SomeFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var func_var = script_var<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if cond<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var block_var = func_var<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</div>
<br>
変数は、それが定義されているブロックとネストされたブロック内でのみ参照できる。<br>
ブロックが終了すると変数にはアクセスできなくなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if cond<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var inner = 5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var inner = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo inner&nbsp;&nbsp;# エラー!</div>
<br>
宣言は早めに行う必要がある:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var inner: number<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if cond<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner = 5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo inner</div>
<br>
単純な値の場合は、これは短くて高速である:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var inner = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if cond<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; inner = 5<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo inner</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1025" name="E1025">E1025</a>&nbsp;<a class="Constant" href="vim9.html#E1128" name="E1128">E1128</a><br>
後続のコードから意図的に変数を隠すには、ブロックを使用できる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var temp = 'temp'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo temp&nbsp;&nbsp;# エラー!</div>
<br>
これはユーザーコマンドで特に役立つ:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -range Rename {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var save = @a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @a = 'some expression'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo 'do something with ' .. @a<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; @a = save<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<br>
自動コマンドでの場合:<br>
<div class="helpExample">&nbsp;&nbsp; au BufWritePre *.go {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var save = winsaveview()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; silent! exe ':%! some formatting command'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; winrestview(save)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</div>
<br>
ただし、:def 関数を使用する方がおそらくうまく動作する。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1022" name="E1022">E1022</a>&nbsp;<a class="Constant" href="vim9.html#E1103" name="E1103">E1103</a>&nbsp;<a class="Constant" href="vim9.html#E1130" name="E1130">E1130</a>&nbsp;<a class="Constant" href="vim9.html#E1131" name="E1131">E1131</a>&nbsp;<a class="Constant" href="vim9.html#E1133" name="E1133">E1133</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1134" name="E1134">E1134</a><br>
型を指定して変数を宣言し初期化子を指定しない場合、値は false (boolの場合)、空<br>
(文字列、リスト、辞書などの場合)、ゼロ (数値、any などの場合) に初期化される。<br>
これは特に &quot;any&quot; 型を使用する場合に重要で、値はデフォルトで数値のゼロになる。<br>
例えば、リストを宣言する場合、以下のように項目を追加できる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var myList: list&lt;number&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList-&gt;add(7)</div>
<br>
変数を null 値、例えば&nbsp;<a class="Comment" href="vim9.html#null_list">null_list</a>、で初期化することは、変数を初期化しないこと<br>
とは異なる。これはエラーが発生する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var myList = null_list<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList-&gt;add(7)&nbsp;&nbsp;# E1130: null リストには追加できません</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1016" name="E1016">E1016</a>&nbsp;<a class="Constant" href="vim9.html#E1052" name="E1052">E1052</a>&nbsp;<a class="Constant" href="vim9.html#E1066" name="E1066">E1066</a><br>
<br>
Vim9 script では<a class="Comment" href="eval.html#:let">:let</a>&nbsp;は使用できない。既存の変数にコマンドなしで代入される。<br>
グローバル変数、ウィンドウ変数、タブ変数、バッファ変数および Vim 変数も同様で<br>
ある。これらは実際には宣言されていないためである。<a class="Comment" href="eval.html#:unlet">:unlet</a>&nbsp;で削除することもで<br>
きる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1065" name="E1065">E1065</a><br>
変数の宣言に&nbsp;<span class="Comment">:va</span>&nbsp;は使用できない。<a class="Comment" href="vim9.html#:var">:var</a>&nbsp;という完全な名前で記述する必要があ<br>
る。読みやすさを確保するためである。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1178" name="E1178">E1178</a><br>
<a class="Comment" href="eval.html#:lockvar">:lockvar</a>&nbsp;はローカル変数では動作しない。代わりに&nbsp;<a class="Comment" href="eval.html#:const">:const</a>&nbsp;および&nbsp;<a class="Comment" href="vim9.html#:final">:final</a>&nbsp;を<br>
使用する。<br>
<br>
<a class="Comment" href="builtin.html#exists()">exists()</a>&nbsp;および&nbsp;<a class="Comment" href="builtin.html#exists_compiled()">exists_compiled()</a>&nbsp;関数は、ローカル変数または引数では動作し<br>
ない。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1006" name="E1006">E1006</a>&nbsp;<a class="Constant" href="vim9.html#E1041" name="E1041">E1041</a>&nbsp;<a class="Constant" href="vim9.html#E1167" name="E1167">E1167</a>&nbsp;<a class="Constant" href="vim9.html#E1168" name="E1168">E1168</a>&nbsp;<a class="Constant" href="vim9.html#E1213" name="E1213">E1213</a><br>
変数、関数および関数の引数は、同じスクリプトファイル内で既に定義またはインポー<br>
トされた変数や関数をシャドウすることはできない。<br>
変数は Ex コマンドをシャドウすることがあるので、必要に応じて変数名を変更するこ<br>
と。<br>
<br>
グローバル変数はスクリプトレベルでも &quot;g:&quot; をプリフィックスとして付ける必要があ<br>
る。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var script_local = 'text'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:global = 'value'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Funcref = g:ThatFunction</div>
<br>
グローバル関数には &quot;g:&quot; というプリフィックスを付ける必要がある:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def g:GlobalFunc(): string<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return 'text'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo g:GlobalFunc()</div>
オートロード関数には &quot;g:&quot; プリフィックスは必要ない。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-function-defined-later" name="vim9-function-defined-later">vim9-function-defined-later</a><br>
グローバル関数は &quot;g:&quot; プリフィックスなしでも呼び出すことができるが、コンパイル<br>
時に存在している必要がある。&quot;g:&quot; プリフィックスを追加することで、関数を後から<br>
定義できる。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallPluginFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists('g:loaded_plugin')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:PluginFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
以下のようにすると、&quot;g:loaded_plugin&quot; が存在しない場合でも、コンパイル時に<br>
&quot;PluginFunc&quot; が存在しないというエラーが発生する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallPluginFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists('g:loaded_plugin')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PluginFunc()&nbsp;&nbsp; # エラー、関数が見つからない<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
このエラーを回避するために exists_compiled() を使用できるが、その後で<br>
&quot;g:loaded_plugin&quot; が定義されたとしても、この関数は呼び出されない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallPluginFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if exists_compiled('g:loaded_plugin')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PluginFunc()&nbsp;&nbsp; # 関数が呼ばれることはないかもしれない<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<span class="Comment">&amp;opt = value</span>&nbsp;はオプション &quot;opt&quot; に値を代入するようになったため、&quot;:&amp;&quot; を使用<br>
して&nbsp;<a class="Comment" href="change.html#:substitute">:substitute</a>&nbsp;コマンドを繰り返すことはできない。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-unpack-ignore" name="vim9-unpack-ignore">vim9-unpack-ignore</a><br>
アンパック代入では、関数の引数を無視するのと同様に、アンダースコアを使用してリ<br>
スト項目を無視できる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[a, _, c] = theList</div>
残りの項目を無視するには:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[a, b; _] = longList</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1163" name="E1163">E1163</a>&nbsp;<a class="Constant" href="vim9.html#E1080" name="E1080">E1080</a><br>
アンパック記法を用いることで、1 度に複数の変数を宣言することが可能である。各変<br>
数は型を持つか、値から型を推測することができる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var [v1: number, v2] = GetValues()</div>
値を含むリストがある場合にのみこれを使用する。1 行に 1 つの変数を宣言すると、<br>
読みやすく後で変更しやすくなる。<br>
<br>
<br>
<span class="PreProc">定数</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-const" name="vim9-const">vim9-const</a>&nbsp;<a class="Constant" href="vim9.html#vim9-final" name="vim9-final">vim9-final</a><br>
定数の扱い方は言語によって異なる。ある言語では、別の値を代入できない変数を定数<br>
とみす。JavaScript がその一例である。また、他の言語では値を不変とするため、定<br>
数がリストを使用している場合は、リストを変更できない。Vim9 では、どちらも使用<br>
できる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1021" name="E1021">E1021</a>&nbsp;<a class="Constant" href="vim9.html#E1307" name="E1307">E1307</a><br>
<a class="Comment" href="eval.html#:const">:const</a>&nbsp;は、変数と値の両方を定数にするために使用される。これは、変更されない<br>
ことを確実にしたい複合構造に使用する。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const myList = [1, 2]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList = [3, 4]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList[0] = 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList-&gt;add(3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# エラー!</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:final" name=":final">:final</a>&nbsp;<a class="Constant" href="vim9.html#E1125" name="E1125">E1125</a><br>
<a class="Comment" href="vim9.html#:final">:final</a>&nbsp;は変数を定数にするために使用され、値は変更可能である。これは Java で<br>
よく知られている。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final myList = [1, 2]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList = [3, 4]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList[0] = 9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList-&gt;add(3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# OK</div>
<br>
定数は ALL_CAPS (すべて大文字) で書くのが一般的であるが、必須ではない。<br>
<br>
この定数は値自体にのみ適用され、それが参照するものには適用されない。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final females = [&quot;Mary&quot;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const NAMES = [[&quot;John&quot;, &quot;Peter&quot;], females]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES[0] = [&quot;Jack&quot;]&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES[0][0] = &quot;Jack&quot;&nbsp;&nbsp;&nbsp;&nbsp;# エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES[1] = [&quot;Emma&quot;]&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES[1][0] = &quot;Emma&quot;&nbsp;&nbsp;&nbsp;&nbsp;# OK, females[0] == &quot;Emma&quot;</div>
<br>
<br>
<span class="PreProc">:call と :eval の省略</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1190" name="E1190">E1190</a><br>
関数は&nbsp;<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;なしで呼ぶことができる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writefile(lines, 'file')</div>
<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;の使用はまだ可能だが、推奨されない。<br>
<br>
<a class="Comment" href="eval.html#eval">eval</a>&nbsp;なしのメソッド呼び出しは、先頭が識別子であるか、Ex コマンドでない限り可<br>
能である。関数の場合は、改行なしで &quot;(&quot; または &quot;-&gt;&quot; のいずれかが続く必要がある。<br>
例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myList-&gt;add(123)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:myList-&gt;add(123)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1, 2, 3]-&gt;Process()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{a: 1, b: 2}-&gt;Process()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;foobar&quot;-&gt;Process()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(&quot;foobar&quot;)-&gt;Process()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'foobar'-&gt;Process()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;('foobar')-&gt;Process()</div>
<br>
関数名と Ex コマンドが曖昧になる稀なケースでは、Ex コマンドを使用することを明<br>
確にするために、先頭に &quot;:&quot; を付ける。例えば、<a class="Comment" href="change.html#:substitute">:substitute</a>&nbsp;コマンドと<br>
<a class="Comment" href="builtin.html#substitute()">substitute()</a>&nbsp;関数の両方がある。行が&nbsp;<span class="Comment">substitute(</span>&nbsp;で始まる場合は関数が使用さ<br>
れる。代わりにコマンドを使用する場合は、先頭にコロンを付ける:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:substitute(pattern (replacement (</div>
<br>
式が &quot;!&quot; で始まる場合、これは条件の否定ではなくシェルコマンドとして解釈される。<br>
つまり、これはシェルコマンドである:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!shellCommand-&gt;something</div>
否定を表す &quot;!&quot; を使用するには、式を括弧で囲む:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(!expression)-&gt;Method()</div>
<br>
<span class="Todo">Note</span>&nbsp;変数は使用する前に定義する必要があるが、関数は定義前に呼び出すことができ<br>
る。これは、関数間の循環的な依存関係を可能にするために必要である。関数を名前で<br>
検索する必要があるため、効率は少し悪くなる。また、関数名のタイプミスは、関数が<br>
呼び出されたときにのみ検出される。<br>
<br>
<br>
<span class="PreProc">function() の省略</span><br>
<br>
ユーザー定義関数は、<a class="Comment" href="builtin.html#function()">function()</a>&nbsp;を使わずに式の中で関数参照として使用できる。<br>
その場合、引数の型と戻り値の型がチェックされる。関数は事前に定義されている必要<br>
がある。<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Funcref = MyFunction</div>
<br>
<a class="Comment" href="builtin.html#function()">function()</a>&nbsp;を使用すると、結果の型は &quot;func&quot; になる。これは、任意の数の引数と<br>
任意の戻り値 (void を含む) を持つ関数である。引数をクォートで囲めば、関数は後<br>
で定義できる。<br>
<br>
<br>
<span class="PreProc">ラムダ式は -&gt; の代わりに =&gt; を使う</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-lambda" name="vim9-lambda">vim9-lambda</a><br>
旧来のスクリプトでは、メソッド呼び出しとラムダ式で &quot;-&gt;&quot; を使用することが混乱を<br>
招く可能性がある。また、&quot;{&quot; が見つかった場合、パーサーはそれがラムダ式の開始な<br>
のか辞書の開始なのかを判断する必要があるが、引数の型が使用されるようになったた<br>
め、この判断はより複雑になっている。<br>
<br>
これらの問題を回避するために、Vim9 script は JavaScript に似たラムダ式の異なる<br>
構文を使用する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Lambda = (arg) =&gt; expression<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Lambda = (arg): type =&gt; expression</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1157" name="E1157">E1157</a><br>
ラムダ式の引数では、&quot;=&gt;&quot; まで改行は許可されない (Vim が括弧内の式とラムダ式の<br>
引数を区別できるようにするため)。これは OK である:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(list, (k, v) =&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v &gt; 0)</div>
これは動作しない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(list, (k, v)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt; v &gt; 0)</div>
これも動作しない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(list, (k,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v) =&gt; v &gt; 0)</div>
ただし、パースする前にバックスラッシュを使用して行を連結することができる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;filter(list, (k,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; v)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; =&gt; v &gt; 0)</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-lambda-arguments" name="vim9-lambda-arguments">vim9-lambda-arguments</a>&nbsp;<a class="Constant" href="vim9.html#E1172" name="E1172">E1172</a><br>
旧来のスクリプトでは、ラムダ式は任意の数の追加引数で呼び出すことができ、引数を<br>
指定しなかった場合の警告を出す方法がなかった。Vim9 script では、引数の数は一致<br>
している必要がある。任意の引数、あるいは追加の引数を受け入れたい場合は、&quot;..._&quot;<br>
を使用する。これにより、関数は&nbsp;<a class="Identifier" href="vim9.html#vim9-variable-arguments">vim9-variable-arguments</a>&nbsp;を受け入れるようにな<br>
る。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Callback = (..._) =&gt; 'anything'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo Callback(1, 2, 3)&nbsp;&nbsp;# &quot;anything&quot; を表示する</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#inline-function" name="inline-function">inline-function</a>&nbsp;<a class="Constant" href="vim9.html#E1171" name="E1171">E1171</a><br>
さらに、ラムダ式には {} 内のステートメント群を含めることができる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Lambda = (arg) =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:was_called = 'yes'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return expression<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
これはタイマーに役立つ。例えば:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var count = 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var timer = timer_start(500, (_) =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; count += 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echom 'Handler called ' .. count<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, {repeat: 3})</div>
<br>
終わりの &quot;}&quot; は行頭になければならない。その後に他の文字を続けることもできる。<br>
例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var d = mapnew(dict, (k, v): string =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return 'value'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })</div>
&quot;{&quot; の後にコマンドは使用できない。コメントのみ使用できる。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#command-block" name="command-block">command-block</a>&nbsp;<a class="Constant" href="vim9.html#E1026" name="E1026">E1026</a><br>
このブロックはユーザーコマンドの定義にも使用できる。ブロック内では Vim9 script<br>
の構文が使用される。<br>
<br>
以下はヒアドキュメントの使用例である:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;com SomeCommand {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:someVar =&lt;&lt; trim eval END<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ccc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ddd<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<br>
文に辞書が含まれる場合、その閉じ括弧を行頭に記述してはいけない。そうしないと、<br>
ブロックの終わりとして解釈されてしまう。これは動作しない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command NewCommand {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; g:mydict = {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'key': 'value',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp;&nbsp;# エラー: ブロックの終了として認識される<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</div>
これを回避するには、最後の項目の後に '}' を配置する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command NewCommand {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; g:mydict = {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'key': 'value' }<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</div>
<br>
理由: コマンドの後に &quot;}&quot; を置くことはできない。コマンドをパースして &quot;}&quot; を見つ<br>
ける必要があるためである。一貫性を保つため、&quot;{&quot; の後にコマンドを置くことはでき<br>
ない。残念ながら、これは &quot;() =&gt; { command }&quot; という表現が機能しないことを意味<br>
する。常に改行が必要である。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-curly" name="vim9-curly">vim9-curly</a><br>
辞書リテラルの &quot;{&quot; がステートメントブロックとして認識されるのを避けるには、そ<br>
れを括弧で囲む:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var Lambda = (arg) =&gt; ({key: 42})</div>
<br>
また、コマンドブロックの開始と混同された場合:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;({<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;key: value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })-&gt;method()</div>
<br>
<br>
<span class="PreProc">自動行継続</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-line-continuation" name="vim9-line-continuation">vim9-line-continuation</a>&nbsp;<a class="Constant" href="vim9.html#E1097" name="E1097">E1097</a><br>
多くの場合、式が次の行に続くことは明らかである。そのような場合、行頭にバックス<br>
ラッシュ (<a class="Identifier" href="repeat.html#line-continuation">line-continuation</a>&nbsp;を参照) を付ける必要はない。例えば、リストが複数<br>
行にまたがる場合:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist = [<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'one',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'two',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</div>
辞書が複数行にまたがる場合:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mydict = {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;one: 1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;two: 2,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
関数呼び出しの場合:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = Func(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</div>
<br>
[]、{}、() 以外の式における二項演算子については、演算子の直前または直後で改行<br>
が可能である。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var text = lead<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .. middle<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .. end<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var total = start +<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end -<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;correction<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = positive<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;? PosFunc(arg)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: NegFunc(arg)</div>
<br>
&quot;-&gt;&quot; を使用するメソッド呼び出しとドットを使用するメンバーの場合、その前に改行<br>
が許可される:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = GetBuilder()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;BuilderSetWidth(333)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;BuilderSetHeight(777)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;BuilderBuild()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = MyDict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.member</div>
<br>
コマンドリストを引数として持つコマンドの場合、行の先頭の | 文字は行の継続を示<br>
す:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;autocmd BufNewFile *.match if condition<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp; echo 'match'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| endif</div>
<br>
<span class="Todo">Note</span>&nbsp;これは、ヒアドキュメントの最初の行をバーで始めることができないことを意味<br>
することに注意:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var lines =&lt;&lt; trim END<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | これは動作しない<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END</div>
先頭に空行を入れるか、ヒアドキュメントを使わないようにすること。あるいは、一時<br>
的に&nbsp;<a class="Type" href="options.html#'cpoptions'">'cpoptions'</a>&nbsp;に &quot;C&quot; フラグを追加する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set cpo+=C<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var lines =&lt;&lt; trim END<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; | これは動作する<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;END<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set cpo-=C</div>
ヒアドキュメントが関数内にある場合、<a class="Type" href="options.html#'cpoptions'">'cpoptions'</a>&nbsp;は :def の前に設定し、:enddef<br>
の後に復元する必要がある。<br>
<br>
長い Ex コマンドを分割するなど、バックスラッシュによる行継続が必要な場所では、<br>
コメントを '#\ ' で開始することができる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;syn region Text<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ start='foo'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#\ コメント<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ end='bar'</div>
旧来のスクリプトと同様に、'&quot;\ ' が使用される。これは、バックスラッシュなしで行<br>
継続が使用され、行がバーで始まる場合にも必要である:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;au CursorHold * echom 'BEFORE bar'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#\ 何かのコメント<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| echom 'AFTER bar'</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1050" name="E1050">E1050</a><br>
行頭の演算子を認識できるようにするには、範囲の前にコロンを置く必要がある。次の<br>
例では、&quot;start&quot; と &quot;print&quot; を追加する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = start<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ print</div>
以下と同様:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = start + print</div>
<br>
これにより、&quot;start&quot; が割り当てられ、1 行表示する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var result = start<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:+ print</div>
<br>
範囲指定の後には Ex コマンドが必要である。コロンがなくても&nbsp;<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;なしで関数<br>
を呼び出すことができるが、範囲指定の後には&nbsp;<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;が必要である:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyFunc()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:% call MyFunc()</div>
<br>
<span class="Todo">Note</span>&nbsp;<a class="Identifier" href="editing.html#+cmd">+cmd</a>&nbsp;引数にはコロンは不要であることに注意:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edit +6 fname</div>
<br>
関数冒頭を引数間で複数行に分割することもできる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text: string,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;separator = '-'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;): string</div>
<br>
継続行は容易に認識できないため、コマンドのパースはより厳密になった。例えば、1<br>
行目のエラーのため、2 行目は別のコマンドとして認識される:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;popup_create(some invalid expression, {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; exit_cb: Func})</div>
これで &quot;exit_cb: Func})&quot; は実際に有効なコマンドになった。つまり、&quot;_cb: Func})&quot;<br>
ファイルへの変更を保存して終了する。Vim9 script でこのような間違いを避けるに<br>
は、ほとんどのコマンド名と引数の間に空白を入れる必要がある。<br>
<a class="Constant" href="vim9.html#E1144" name="E1144">E1144</a><br>
<br>
ただし、コマンドの引数がコマンドである場合は認識されない。例えば、&quot;windo echo<br>
expr&quot; の後では、&quot;expr&quot; 内の改行は認識されない。<br>
<br>
<br>
<span class="Todo">Notes</span>:<br>
- &quot;enddef&quot; は継続行の先頭では使用できない。現在の関数を終了させるためである。<br>
- 代入の左辺では改行は許可されない。特にリストを展開する場合に当てはまる<br>
&nbsp;&nbsp;<a class="Identifier" href="eval.html#:let-unpack">:let-unpack</a>。これは OK である:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[var1, var2] =<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func()</div>
&nbsp;&nbsp;&nbsp;これは動作しない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[var1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var2] =<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func()</div>
-&nbsp;<a class="Comment" href="eval.html#:echo">:echo</a>、<a class="Comment" href="eval.html#:execute">:execute</a>、および類似のコマンドの引数の間には改行を入れることはで<br>
&nbsp;&nbsp;きない。これは OK である:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo [1,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2] [3,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4]</div>
&nbsp;&nbsp;&nbsp;これは動作しない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo [1, 2]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[3, 4]</div>
- Vim では、コマンドのパースが困難な場合がある。特に、<a class="Comment" href="windows.html#:windo">:windo</a>&nbsp;のようにコマン<br>
&nbsp;&nbsp;ドが別のコマンドの引数として使用されている場合には、その傾向が顕著である。そ<br>
&nbsp;&nbsp;のような場合は、バックスラッシュによる行継続を使用する必要がある。<br>
<br>
<br>
<span class="PreProc">空白</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1004" name="E1004">E1004</a>&nbsp;<a class="Constant" href="vim9.html#E1068" name="E1068">E1068</a>&nbsp;<a class="Constant" href="vim9.html#E1069" name="E1069">E1069</a>&nbsp;<a class="Constant" href="vim9.html#E1074" name="E1074">E1074</a>&nbsp;<a class="Constant" href="vim9.html#E1127" name="E1127">E1127</a>&nbsp;<a class="Constant" href="vim9.html#E1202" name="E1202">E1202</a><br>
Vim9 script では空白の適切な使用を強制する。これはもう許可されていない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name=234&nbsp;&nbsp;&nbsp;&nbsp;# エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name= 234&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name =234&nbsp;&nbsp; # エラー!</div>
&quot;=&quot; の前後には空白が必要である:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = 234&nbsp;&nbsp;# OK</div>
コマンドの後ろのコメントを開始する # の前にも空白を入れる必要がある:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = 234# エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = 234 # OK</div>
<br>
ほとんどの演算子の周囲には空白が必要である。<br>
<br>
サブリスト (リストスライス) では先頭と末尾を除き、&quot;:&quot; の前後に空白が必要である:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherlist = mylist[v : count]&nbsp;&nbsp; # v:count は異なる意味を持つ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherlist = mylist[:]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # リストのコピーを作る<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherlist = mylist[v :]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherlist = mylist[: v]</div>
<br>
空白は許可されない:<br>
- 関数名と &quot;(&quot; の間:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func (arg)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \ (arg)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(arg)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func(arg)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Func(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1205" name="E1205">E1205</a><br>
<a class="Comment" href="options.html#:set">:set</a>&nbsp;コマンドではオプション名とそれに続く &quot;&amp;&quot;、&quot;!&quot;、&quot;&lt;&quot;、&quot;=&quot;、&quot;+=&quot;、&quot;-=&quot; ま<br>
たは &quot;^=&quot; の間に空白は許可されていない。<br>
<br>
<br>
<span class="PreProc">波括弧の展開の禁止</span><br>
<br>
波括弧変数&nbsp;<a class="Identifier" href="eval.html#curly-braces-names">curly-braces-names</a>&nbsp;は使用できない。<br>
<br>
<br>
<span class="PreProc">コマンド修飾子は無視されない</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1176" name="E1176">E1176</a><br>
コマンド修飾子を使用しないコマンドにコマンド修飾子を使用するとエラーが発生す<br>
る。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1082" name="E1082">E1082</a><br>
また、後続のコマンドなしでコマンド修飾子を使用するとエラーになるようになった。<br>
<br>
<br>
<span class="PreProc">辞書リテラル</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-literal-dict" name="vim9-literal-dict">vim9-literal-dict</a>&nbsp;<a class="Constant" href="vim9.html#E1014" name="E1014">E1014</a><br>
従来、Vim は {} 構文を使用して辞書リテラルをサポートしてきた:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let dict = {'key': value}</div>
<br>
その後、単純なテキストのキーの使用が非常に一般的であることが明らかになったた<br>
め、後方互換性のある形でリテラル辞書が導入された:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let dict = #{key: value}</div>
<br>
しかし、この #{} 構文は既存の言語とは異なる。リテラルキーの使用は式の使用より<br>
もはるかに一般的であり、JavaScript でもこの構文が使用されていることを考慮する<br>
と、辞書リテラルに {} 形式を使用する方がはるかに便利な構文であると考えられる。<br>
Vim9 script では、{} 形式はリテラルキーを使用する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {key: value}</div>
<br>
これは英数字、アンダースコアおよびダッシュに有効である。他の文字を使用する場合<br>
は、シングルクォートまたはダブルクォートで囲んだ文字列を使用する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {'key with space': value}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {&quot;key\twith\ttabs&quot;: value}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {'': value}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 空のキー</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1139" name="E1139">E1139</a><br>
キーに式を使用する必要がある場合は、JavaScript と同様に角括弧を使用できる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {[&quot;key&quot; .. nr]: value}</div>
<br>
キーの型は文字列、数値、真偽値、または浮動小数点数である。その他の型はエラーに<br>
なる。[] を使用しない場合、値は先頭のゼロを保持した文字列として扱われる。[] で<br>
指定された式は評価され文字列に変換される。その際、先頭のゼロは削除される:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {000123: 'without', [000456]: 'with'}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo dict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{'456': 'with', '000123': 'without'}</div>
ドットは他の場所では受け入れられないため、浮動小数点数は [] 内でのみ動作する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var dict = {[00.013]: 'float'}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo dict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{'0.013': 'float'}</div>
<br>
<br>
<span class="PreProc">:xit、:t、:k、:append、:change、:insert の禁止</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1100" name="E1100">E1100</a><br>
これらのコマンドは、ローカル変数名と混同されやすい。<br>
<a class="Comment" href="editing.html#:x">:x</a>&nbsp;や&nbsp;<a class="Comment" href="editing.html#:xit">:xit</a>&nbsp;の代わりに&nbsp;<a class="Comment" href="editing.html#:exit">:exit</a>&nbsp;を使用できる。<br>
<a class="Comment" href="change.html#:t">:t</a>&nbsp;の代わりに&nbsp;<a class="Comment" href="change.html#:copy">:copy</a>&nbsp;を使用できる。<br>
<a class="Comment" href="motion.html#:k">:k</a>&nbsp;の代わりに&nbsp;<a class="Comment" href="motion.html#:mark">:mark</a>&nbsp;を使用できる。<br>
<br>
<br>
<span class="PreProc">比較演算子</span><br>
<br>
<a class="Type" href="options.html#'ignorecase'">'ignorecase'</a>&nbsp;オプションは、文字列を使用する比較演算子では使用されない。<br>
したがって、&quot;=~&quot; は &quot;=~#&quot; のように動作する。<br>
<br>
文字列に対して &quot;is&quot; と &quot;isnot&quot; (<a class="Identifier" href="eval.html#expr-is">expr-is</a>&nbsp;と&nbsp;<a class="Identifier" href="eval.html#expr-isnot">expr-isnot</a>) を使用すると、偽を<br>
返すようになった。旧来のスクリプトでは文字列の比較のみだったが、<a class="Identifier" href="vim9.html#Vim9">Vim9</a>&nbsp;script<br>
では文字列の同一性を確認し、使用時に文字列がコピーされるため、2 つの文字列が同<br>
一になることはない (文字列がコピーされず参照カウントされるようになれば、将来的<br>
には変更される可能性がある)。<br>
<br>
<br>
<span class="PreProc">エラー後の中断</span><br>
<br>
旧来のスクリプトではエラーが発生すると、Vim は次の行の実行を継続する。これによ<br>
り、長いエラーシーケンスが発生し停止するには Ctrl-C を入力する必要がある。Vim9<br>
script では、コマンドの実行は最初のエラーで停止する。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var x = does-not-exist<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'not executed'</div>
<br>
<br>
<span class="PreProc">For ループ</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1254" name="E1254">E1254</a><br>
ループ変数は宣言されていてはいけない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var i = 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for i in [1, 2, 3]&nbsp;&nbsp; # エラー!</div>
<br>
ただし、グローバル変数を使用することは可能である:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:i = 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for g:i in [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo g:i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor</div>
<br>
旧来の Vim script には、リストハンドルに対してforループを実行し、現在位置また<br>
は前の項目を削除するトリックがいくつかある。Vim9 script ではインデックスのみを<br>
使用し、項目が削除された場合はリスト内の項目をスキップする。旧来のスクリプトの<br>
例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let l = [1, 2, 3, 4]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for i in l<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; call remove(l, index(l, i))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor</div>
以下が出力される:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4<br>
コンパイルされた Vim9 script では以下のようになる:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3<br>
一般的に、反復処理するリストは変更してはならない。必要であれば事前にコピーを作<br>
成する。<br>
リストのリストをループ処理する場合、ネストされたリストは変更できる。ループ変数<br>
は &quot;final&quot; であり変更できないが、その値は変更できる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1306" name="E1306">E1306</a><br>
:for ループと :while ループを合わせたループの深さは、10 を超えることはできな<br>
い。<br>
<br>
<br>
<span class="PreProc">条件と式</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-boolean" name="vim9-boolean">vim9-boolean</a><br>
条件と式は他の言語とほぼ同じように動作する。ただし、一部の値は旧来の Vim scipt<br>
と異なる:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">値&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧来の Vim script&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vim9 script</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; falsy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; falsy<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; truthy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;truthy<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;99&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;truthy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;0&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; falsy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;99&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;truthy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;text&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;falsy&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; エラー!<br>
<br>
&quot;??&quot; 演算子や &quot;!&quot; 演算子を使用する場合エラーは発生せず、すべての値は偽値か真値<br>
のいずれかになる。これは JavaScript とほぼ同じだが、空のリストと辞書は偽値にな<br>
る:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">型&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;真値となるとき</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true, v:true または 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;非0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 非0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;空以外<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blob&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;空以外<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;空以外 (JavaScript とは異なる)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tuple&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 空以外 (JavaScript とは異なる)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dictionary&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;空以外 (JavaScript とは異なる)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;関数名があるとき<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;special&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; true または v:true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 非 NULL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 非 NULL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 非 NULL<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;非 NULL (TODO: isTrue() が true を返すとき)<br>
<br>
真偽値演算子 &quot;||&quot; と &quot;&amp;&amp;&quot; は、値が真偽値、0 または 1 であることを期待する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 || false&nbsp;&nbsp; == true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 || 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; == true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 || false&nbsp;&nbsp; == false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 &amp;&amp; true&nbsp;&nbsp;&nbsp;&nbsp;== true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 &amp;&amp; 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; == false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8 || 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'yes' &amp;&amp; 0&nbsp;&nbsp; エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[] || 99&nbsp;&nbsp;&nbsp;&nbsp; エラー!</div>
<br>
論理否定に &quot;!&quot; を使用する場合、どの型を使用してもエラーは発生せず、結果は真偽<br>
値になる。&quot;!!&quot; を使用すると、任意の値を真偽値に変換できる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!'yes'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;== false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!![]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;== false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!![1, 2, 3]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; == true</div>
<br>
文字列の連結に&nbsp;<span class="Comment">..</span>&nbsp;を使用する場合、単純型の引数は常に文字列に変換される:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'hello ' .. 123&nbsp;&nbsp;== 'hello 123'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'hello ' .. v:true&nbsp;&nbsp;== 'hello true'</div>
<br>
単純型は Number、Float、Special、Bool である。その他の型には&nbsp;<a class="Identifier" href="builtin.html#string()">string()</a>&nbsp;を使用<br>
すべきである。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#false" name="false">false</a>&nbsp;<a class="Constant" href="vim9.html#true" name="true">true</a>&nbsp;<a class="Constant" href="vim9.html#null" name="null">null</a>&nbsp;<a class="Constant" href="vim9.html#null_blob" name="null_blob">null_blob</a>&nbsp;<a class="Constant" href="vim9.html#null_channel" name="null_channel">null_channel</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#null_class" name="null_class">null_class</a>&nbsp;<a class="Constant" href="vim9.html#null_dict" name="null_dict">null_dict</a>&nbsp;<a class="Constant" href="vim9.html#null_function" name="null_function">null_function</a>&nbsp;<a class="Constant" href="vim9.html#null_job" name="null_job">null_job</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#null_list" name="null_list">null_list</a>&nbsp;<a class="Constant" href="vim9.html#null_object" name="null_object">null_object</a>&nbsp;<a class="Constant" href="vim9.html#null_partial" name="null_partial">null_partial</a>&nbsp;<a class="Constant" href="vim9.html#null_string" name="null_string">null_string</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1034" name="E1034">E1034</a><br>
Vim9 script では以下の定義済みの値が使用できる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_blob<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_channel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_class<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_dict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_function<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_job<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_list<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_tuple<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_object<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_partial<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;null_string</div>
<a class="Comment" href="vim9.html#true">true</a>&nbsp;は&nbsp;<a class="Comment" href="eval.html#v:true">v:true</a>&nbsp;と同じ、<a class="Comment" href="vim9.html#false">false</a>&nbsp;は&nbsp;<a class="Comment" href="eval.html#v:false">v:false</a>&nbsp;と同じ、<a class="Comment" href="vim9.html#null">null</a>&nbsp;は&nbsp;<a class="Comment" href="eval.html#v:null">v:null</a>&nbsp;と<br>
同じである。<br>
<br>
<a class="Comment" href="vim9.html#null">null</a>&nbsp;は &quot;special&quot; 型だが、その他の &quot;null_&quot; で始まる値は名前で示された型にな<br>
る。多くの場合、null 値は空の値と同じように扱われるが、必ずしもそうとは限らな<br>
い。これらの値はスクリプトローカル変数をクリアするのに便利である。なぜなら<br>
<a class="Comment" href="eval.html#:unlet">:unlet</a>&nbsp;では削除できないためである。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var theJob = job_start(...)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ジョブに仕事をさせる<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;theJob = null_job</div>
<br>
これらの値は引数のデフォルト値としても役立つ:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc(b: blob = null_blob)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Note: null_blob ではなく null と比較し、<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; デフォルト値と空 blob を区別する。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if b == null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 引数 b が与えられなかった</div>
null との比較テストに関する詳細は、<a class="Identifier" href="vim9.html#null-compare">null-compare</a>&nbsp;を参照。<br>
<br>
<a class="Comment" href="vim9.html#null">null</a>&nbsp;を任意の値と比較することは可能であり、型エラーは発生しない。ただし、<br>
<a class="Comment" href="vim9.html#null">null</a>&nbsp;を数値、浮動小数点数、または真偽値と比較すると、常に&nbsp;<a class="Comment" href="vim9.html#false">false</a>&nbsp;が返され<br>
る。これは、<a class="Comment" href="vim9.html#null">null</a>&nbsp;を 0 または&nbsp;<a class="Comment" href="vim9.html#false">false</a>&nbsp;と比較すると&nbsp;<a class="Comment" href="vim9.html#true">true</a>&nbsp;が返される旧来のス<br>
クリプトとは異なる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-false-true" name="vim9-false-true">vim9-false-true</a><br>
真偽値を文字列に変換する場合、旧来のスクリプトのように&nbsp;<a class="Comment" href="eval.html#v:false">v:false</a>&nbsp;と&nbsp;<a class="Comment" href="eval.html#v:true">v:true</a><br>
ではなく、&nbsp;<a class="Comment" href="vim9.html#false">false</a>&nbsp;と&nbsp;<a class="Comment" href="vim9.html#true">true</a>&nbsp;が使用される。<a class="Comment" href="eval.html#v:none">v:none</a>&nbsp;には&nbsp;<span class="Comment">none</span>&nbsp;の代替がなく、<br>
他の言語にも同等のものはない。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-string-index" name="vim9-string-index">vim9-string-index</a><br>
[idx] による文字列のインデックス指定、または [idx : idx] によるスライスの取得<br>
では、バイトインデックスではなく文字インデックスが使用される。合成文字も含まれ<br>
る。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 'bár'[1]</div>
旧来のスクリプトでは文字 0xc3 (不正なバイト) が返され、Vim9 script では文字列<br>
'á' が返される。<br>
負のインデックスは末尾からカウントし、&quot;[-1]&quot; は最後の文字である。<br>
最後の文字を除外するには&nbsp;<a class="Identifier" href="builtin.html#slice()">slice()</a>&nbsp;を使用する。<br>
合成文字を個別にカウントするには&nbsp;<a class="Identifier" href="builtin.html#strcharpart()">strcharpart()</a>&nbsp;を使用する。<br>
インデックスが範囲外の場合、結果は空文字列になる。<br>
<br>
旧来のスクリプトでは、&quot;++var&quot; と &quot;--var&quot; は何も表示されずにそのまま受け入れら<br>
れ効果がない。これは Vim9 script ではのエラーである。<br>
<br>
0 で始まる数値は 8 進数とはみなされず、&quot;0o&quot; で始まる数値のみが 8 進数として扱<br>
われる: &quot;0o744&quot;。<a class="Identifier" href="eval.html#scriptversion-4">scriptversion-4</a><br>
<br>
<br>
<span class="PreProc">気をつけるべきこと</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-gotchas" name="vim9-gotchas">vim9-gotchas</a><br>
Vim9 は、一般的なプログラミング言語に近づくように設計されていますが、同時に旧<br>
来の Vim コマンドをサポートしようとしています。そのため、いくつかの妥協をしな<br>
ければなりませんでした。ここでは、意外と知られていないことをまとめてみました。<br>
<br>
Exコマンドの範囲指定にはコロンを前置する必要があります。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧来の Vim&#0058; 前の行を右にシフト<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;func()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vim9: 継続行におけるメソッド呼び出し<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:-&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vim9&#0058; 前の行を右にシフト</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;%s/a/b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧来の Vim&#0058; すべての行を置換<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x = alongname<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; % another&nbsp;&nbsp;&nbsp;&nbsp;Vim9: 継続行の剰余演算<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:%s/a/b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vim9&#0058; すべての行を置換<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;旧来の Vim&#0058; マーク t へのジャンプ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'text'-&gt;func()&nbsp;&nbsp;&nbsp;&nbsp;Vim9: メソッド呼び出し<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:'t&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vim9&#0058; マーク t へのジャンプ</div>
<br>
いくつかのExコマンドは Vim9 script の代入式と紛らわしくなります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:name = value&nbsp;&nbsp;&nbsp;&nbsp;# 代入<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:g:pattern:cmd&nbsp;&nbsp;&nbsp;&nbsp;# :グローバルコマンド</div>
<br>
コマンド&nbsp;<a class="Comment" href="repeat.html#:global">:global</a>&nbsp;や&nbsp;<a class="Comment" href="change.html#:substitute">:substitute</a>&nbsp;と式や代入文が紛らわしくなるのを避けるた<br>
め、これらのコマンドが一文字に省略されているとき、一部のセパレータは使うことが<br>
できません: ':'、'-' と '.' が利用不可です。:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g:pattern:cmd&nbsp;&nbsp;&nbsp;&nbsp; # 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s:pattern:repl&nbsp;&nbsp;&nbsp;&nbsp;# 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g-pattern-cmd&nbsp;&nbsp;&nbsp;&nbsp; # 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s-pattern-repl&nbsp;&nbsp;&nbsp;&nbsp;# 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g.pattern.cmd&nbsp;&nbsp;&nbsp;&nbsp; # 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s.pattern.repl&nbsp;&nbsp;&nbsp;&nbsp;# 無効なコマンド - エラー</div>
<br>
同様に、コマンドとセパレータの間にスペースがあってはいけません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;g /pattern/cmd&nbsp;&nbsp;&nbsp;&nbsp;# 無効なコマンド - エラー<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s /pattern/repl&nbsp;&nbsp; # 無効なコマンド - エラー</div>
<br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義した関数はすべてコンパイルされます。旧来の関数は途中で脱出するこ<br>
とができ、それ以降の行はパースされません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func Maybe()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !has('feature')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use-feature<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfunc</div>
Vim9 関数はすべてコンパイルされます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Maybe()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !has('feature')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use-feature&nbsp;&nbsp;# コンパイルエラーが発生する可能性がある<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
応急的に、2つの関数に分けることができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func Maybe()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if has('feature')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call MaybeInner()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfunc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if has('feature')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MaybeInner()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use-feature<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif</div>
また、偽として評価される定数式の条件をもった&nbsp;<a class="Comment" href="eval.html#:if">if</a>&nbsp;の配下にサポート外のコードを<br>
置くことができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Maybe()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if has('feature')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;use-feature<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
これには&nbsp;<a class="Comment" href="builtin.html#exists_compiled()">exists_compiled()</a>&nbsp;関数も同様に使えます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-user-command" name="vim9-user-command">vim9-user-command</a><br>
関数のコンパイルによる他の副作用として、ユーザーコマンドの存在がコンパイルの時<br>
点でチェックされます。ユーザーコマンドが後で定義されている場合、エラーとなりま<br>
す。これはOKです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -nargs=1 MyCommand echom &lt;q-args&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Works()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyCommand 123<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
これは &quot;MyCommand&quot; が定義されていないというエラーが発生します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Works()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -nargs=1 MyCommand echom &lt;q-args&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyCommand 123<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
回避策は、<a class="Comment" href="eval.html#:execute">:execute</a>&nbsp;を使用して間接的にコマンドを呼び出すことです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Works()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -nargs=1 MyCommand echom &lt;q-args&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execute 'MyCommand 123'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<span class="Todo">Note</span>&nbsp;認識されていないコマンドを &quot;|&quot; でつなぐと、その後のコマンドは認識されませ<br>
ん。次のような記述は&nbsp;<a class="Comment" href="eval.html#:endif">endif</a>&nbsp;がないというエラーになります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Maybe()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if has('feature') | use-feature | endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<span class="PreProc">その他の変更点</span><br>
<br>
パターンは、明示的に上書きされない限り&nbsp;<a class="Type" href="options.html#'magic'">'magic'</a>&nbsp;が設定されている状態と同様に作<br>
用します。<br>
オプション&nbsp;<a class="Type" href="options.html#'edcompatible'">'edcompatible'</a>&nbsp;の値は使用されません。<br>
オプション&nbsp;<a class="Type" href="options.html#'gdefault'">'gdefault'</a>&nbsp;の値は使用されません。<br>
<br>
また、このwikiも参考になるでしょう。これは Vim9 script のアーリーアダプターに<br>
よって書かれました:&nbsp;<span class="Constant"><a href="https://github.com/lacygoill/wiki/blob/master/vim/vim9.md">https://github.com/lacygoill/wiki/blob/master/vim/vim9.md</a></span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:++" name=":++">:++</a>&nbsp;<a class="Constant" href="vim9.html#:--" name=":--">:--</a><br>
++ と -- コマンドが追加されました。1 を足し引きするのとそっくりです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++var<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var += 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--var<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var -= 1</div>
<br>
式中で ++var や --var を使うことはまだサポートされていません。<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
3. 新しいスタイルの関数&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#fast-functions" name="fast-functions">fast-functions</a><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:def" name=":def">:def</a>&nbsp;<a class="Constant" href="vim9.html#E1028" name="E1028">E1028</a><br>
:def[!]&nbsp;<span class="Special">{name}</span>(<span class="Special">[arguments]</span>)[:&nbsp;<span class="Special">{return-type}</span>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{name}</span>&nbsp;という名前の新しい関数を定義します。関数の本体<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;は次の行から&nbsp;<a class="Comment" href="vim9.html#:enddef">:enddef</a>&nbsp;と一致するまで続きます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1073" name="E1073">E1073</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1011" name="E1011">E1011</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{name}</span>&nbsp;は必ず 100 バイト未満でなければなりません。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1003" name="E1003">E1003</a>&nbsp;<a class="Constant" href="vim9.html#E1027" name="E1027">E1027</a>&nbsp;<a class="Constant" href="vim9.html#E1056" name="E1056">E1056</a>&nbsp;<a class="Constant" href="vim9.html#E1059" name="E1059">E1059</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="userfunc.html#:return">:return</a>&nbsp;で返される値の型は必ず&nbsp;<span class="Special">{return-type}</span>&nbsp;と一致<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;しなければなりません。<span class="Special">{return-type}</span>&nbsp;が省略された、ある<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;いは &quot;void&quot; である場合は、その関数は何も返さないと想定<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;されます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1077" name="E1077">E1077</a>&nbsp;<a class="Constant" href="vim9.html#E1123" name="E1123">E1123</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{arguments}</span>&nbsp;は 0 あるいはそれ以上の引数の宣言列です。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引数の宣言には 3 つの書式があります:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{name}</span>:&nbsp;<span class="Special">{type}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{name}</span>&nbsp;=&nbsp;<span class="Special">{value}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{name}</span>:&nbsp;<span class="Special">{type}</span>&nbsp;=&nbsp;<span class="Special">{value}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;最初の書式は必須の引数の書式で、呼び出す側は必ず実引数<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;を与える必要があります。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 つ目と 3 つ目の書式は任意の引数の書式です。呼び出す<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;側が実引数を省略した場合は、<span class="Special">{value}</span>&nbsp;が使われます。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;関数は呼び出された時、<a class="Comment" href="vim9.html#:disassemble">:disassemble</a>&nbsp;が使われたとき、<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;あるいは&nbsp;<a class="Comment" href="vim9.html#:defcompile">:defcompile</a>&nbsp;が使われたときに命令列にコンパ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;イルされます。文法および型のエラーはこの時に提示されま<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;す。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;を他の&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;や&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;の内側で大体 50 階<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;層の深さまでまでネストすることが可能です。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1117" name="E1117">E1117</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[!] は&nbsp;<a class="Comment" href="userfunc.html#:function">:function</a>&nbsp;と同様に使われます。<span class="Todo">Note</span>&nbsp;Vim9<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script において、スクリプトローカル関数は後で削除され<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;たり再定義されたりしてはいけません。スクリプトローカル<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;の削除は、同じスクリプトの再読み込みによってのみ行えま<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;す。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:enddef" name=":enddef">:enddef</a>&nbsp;<a class="Constant" href="vim9.html#E1057" name="E1057">E1057</a>&nbsp;<a class="Constant" href="vim9.html#E1152" name="E1152">E1152</a>&nbsp;<a class="Constant" href="vim9.html#E1173" name="E1173">E1173</a><br>
:enddef&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義された関数の終了。<a class="Comment" href="vim9.html#:enddef">:enddef</a>&nbsp;はそれだけで<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;行にあるべきです。<br>
<br>
また、このwikiも参考になるでしょう。これは Vim9 script のアーリーアダプターに<br>
よって書かれました:&nbsp;<span class="Constant"><a href="https://github.com/lacygoill/wiki/blob/master/vim/vim9.md">https://github.com/lacygoill/wiki/blob/master/vim/vim9.md</a></span><br>
<br>
もし関数が定義されたスクリプトが Vim9 script であるなら、スクリプトローカル変<br>
数はプリフィックス &quot;s:&quot; なしでアクセスすることができます。それらは関数がコンパ<br>
イルされる前に定義されている必要があります。もし関数が定義されたスクリプトが旧<br>
来の Vim script であるなら、スクリプトローカル変数は、コンパイル時に存在しない<br>
場合は、プリフィックス &quot;s:&quot; をつけてアクセスする必要があります。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1269" name="E1269">E1269</a><br>
<a class="Identifier" href="vim9.html#Vim9">Vim9</a>&nbsp;script では、スクリプトローカル変数はスクリプトレベルで宣言されなければ<br>
なりません。それらは関数内で、旧来の関数内でも作成することはできません。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:defc" name=":defc">:defc</a>&nbsp;<a class="Constant" href="vim9.html#:defcompile" name=":defcompile">:defcompile</a><br>
:defc[ompile]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 現在のスクリプトで定義されている関数とクラス<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="Identifier" href="vim9class.html#class-compile">class-compile</a>) のうち、まだコンパイルされていないも<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;のをコンパイルします。これはコンパイル時に見つかったい<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;かなるエラーも報告します。<br>
<br>
:defc[ompile] MyClass&nbsp;&nbsp; クラス内のすべてのメソッドをコンパイルします。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="vim9class.html#class-compile">class-compile</a><br>
<br>
:defc[ompile]&nbsp;<span class="Special">{func}</span><br>
:defc[ompile] debug&nbsp;<span class="Special">{func}</span><br>
:defc[ompile] profile&nbsp;<span class="Special">{func}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;必要であれば関数&nbsp;<span class="Special">{func}</span>&nbsp;をコンパイルします。&quot;debug&quot; と<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;profile&quot; はコンパイルモードを指定するのに使います。こ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;れはコンパイル時に見つかったいかなるエラーも報告しま<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;す。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{func}</span>&nbsp;コールは、&quot;ClassName.functionName&quot; とすること<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;で、クラス内の関数やメソッドもコンパイルできます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{func}</span>&nbsp;コールは、&quot;ClassName&quot; とすることで、クラス内の<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;すべての関数とメソッドをコンパイルすることもできます。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:disa" name=":disa">:disa</a>&nbsp;<a class="Constant" href="vim9.html#:disassemble" name=":disassemble">:disassemble</a><br>
:disa[ssemble]&nbsp;<span class="Special">{func}</span>&nbsp;&nbsp;&nbsp;<span class="Special">{func}</span>&nbsp;用に生成された命令列を表示します。これはデバ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ッグ及びテスト用です。&nbsp;<a class="Constant" href="vim9.html#E1061" name="E1061">E1061</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Todo">Note</span>&nbsp;<span class="Special">{func}</span>&nbsp;のコマンドライン補完において、スクリプト<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ローカル関数を見つけるのに &quot;s:&quot; を前置することができ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ます。<br>
<br>
:disa[ssemble] profile&nbsp;<span class="Special">{func}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vim9.html#:disassemble">:disassemble</a>&nbsp;と似ていますが、プロファイルをとるとき<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;に使われる命令列を表示します。<br>
<br>
:disa[ssemble] debug&nbsp;<span class="Special">{func}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vim9.html#:disassemble">:disassemble</a>&nbsp;と似ていますが、デバッグをするときに使<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;われる命令列を表示します。<br>
<br>
<span class="PreProc">制約</span><br>
<br>
ローカル変数は文字列式からは見えません。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MapList(): list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var list = ['aa', 'bb', 'cc', 'dd']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return range(1, 2)-&gt;map('list[v:val]')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
この map の引数は関数のスコープ抜きに評価される文字列式です。代わりにラムダ式<br>
を使ってください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MapList(): list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var list = ['aa', 'bb', 'cc', 'dd']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return range(1, 2)-&gt;map((_, v) =&gt; list[v])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<a class="Comment" href="editing.html#:edit">:edit</a>&nbsp;のような、コンパイルされないコマンドには、バッククォートによる展開が<br>
使え、またそれはローカルスコープを使うことができます。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Replace()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var fname = 'blah.txt'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edit `=fname`<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
ループ内で定義されたクロージャは同じコンテキストを共有します。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var flist: list&lt;func&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for i in range(5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var inloop = i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flist[i] = () =&gt; inloop<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo range(5)-&gt;map((i, _) =&gt; flist[i]())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 結果: [4, 4, 4, 4, 4]</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1271" name="E1271">E1271</a><br>
クロージャはそのコンテキスト内の変数を見つけられるように、必ずそれが定義された<br>
コンテキストでコンパイルされます。これは関数がコンパイルされた後に&nbsp;<a class="Comment" href="repeat.html#:breakadd">:breakadd</a><br>
で関数がデバッグ対象だとマークされたときを除いて、これは大体正しく行われます。<br>
必ず外側の関数がコンパイルされるより前にブレークポイントを定義するように気をつ<br>
けてください。<br>
<br>
「ループ中」の変数は一度しか存在しません。リストに入れた全てのクロージャは同じ<br>
インスタンス、すなわち最後に 4 の値をもつインスタンスを参照します。これは効率<br>
的で、何回もループする場合でも同様です。もしそれぞれのクロージャでコンテキスト<br>
を分けたいのであれば、コンテキストを定義するため関数を呼んでください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def GetClosure(i: number): func<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var infunc = i<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return () =&gt; infunc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var flist: list&lt;func&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for i in range(5)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flist[i] = GetClosure(i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo range(5)-&gt;map((i, _) =&gt; flist[i]())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 結果: [0, 1, 2, 3, 4]</div>
<br>
いくらかの場面で、特に旧来の Vim script のコンテキストから Vim9 のクロージャを<br>
呼ぶとき、その評価は失敗するでしょう。&nbsp;<a class="Constant" href="vim9.html#E1248" name="E1248">E1248</a><br>
<br>
<span class="Todo">Note</span>&nbsp;スクリプトレベルにおいて、ループ変数はループの後では無効になります。これ<br>
はループ変数が後で呼ばれるクロージャで使われている場合、例えばタイマーと組み合<br>
わせる場合でも同様です。これは&nbsp;<a class="Identifier" href="eval.html#E1302">E1302</a>&nbsp;エラーを発生させます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for n in range(4)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timer_start(500 * n, (_) =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echowin n<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor</div>
<br>
ブロックを使って変数を定義し、その変数をクロージャで使う必要があります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for n in range(4)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var nr = n<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; timer_start(500 * n, (_) =&gt; {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echowin nr<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor</div>
<br>
タイマーにおいて&nbsp;<a class="Comment" href="eval.html#:echowindow">:echowindow</a>&nbsp;を使うのは便利です。メッセージはポップアップに<br>
表示され、タイマーがトリガーされたときにユーザーが行っていることに干渉しませ<br>
ん。<br>
<br>
<br>
<span class="PreProc">旧来の関数から Vim9 の関数への変換</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#convert_legacy_function_to_vim9" name="convert_legacy_function_to_vim9">convert_legacy_function_to_vim9</a><br>
これらが旧来の関数から Vim9 の関数へ変換するために行われる必要のある変更の大部<br>
分です。<br>
<br>
-&nbsp;<span class="Comment">func</span>&nbsp;や&nbsp;<a class="Comment" href="userfunc.html#:function">function</a>&nbsp;を&nbsp;<a class="Comment" href="vim9.html#:def">def</a>&nbsp;に変更する。<br>
-&nbsp;<span class="Comment">endfunc</span>&nbsp;や&nbsp;<a class="Comment" href="userfunc.html#:endfunction">endfunction</a>&nbsp;を&nbsp;<a class="Comment" href="vim9.html#:enddef">enddef</a>&nbsp;に変更する。<br>
- 関数の引数に型をつける。<br>
- もし関数が何か返すのであれば、戻り値の型をつける。<br>
- コメントが &quot; に代わって # で始まるように変更する。<br>
<br>
&nbsp;&nbsp;例えば旧来の Vim script の関数:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func MyFunc(text)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot; 関数の本体<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfunc</div>
&nbsp;&nbsp;&nbsp;がこうなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFunc(text: string): number<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 関数の本体<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
<br>
- 引数に使われる &quot;a:&quot; を削除する。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return len(a:text)</div>
&nbsp;&nbsp;&nbsp;がこうなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return len(text)</div>
<br>
- 変数の宣言に使われる&nbsp;<a class="Comment" href="eval.html#:let">let</a>&nbsp;を&nbsp;<a class="Comment" href="vim9.html#:var">var</a>&nbsp;に変更する。<br>
- 変数への値の代入に使われる&nbsp;<a class="Comment" href="eval.html#:let">let</a>&nbsp;を削除する。これは既に宣言されているローカ<br>
&nbsp;&nbsp;ル変数と b: w: g: t: 変数が対象である。<br>
<br>
&nbsp;&nbsp;例えば旧来の Vim script の関数:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let lnum = 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let lnum += 3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let b:result = 42</div>
&nbsp;&nbsp;&nbsp;がこうなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var lnum = 1<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lnum += 3<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b:result = 42</div>
<br>
- 式中の必要なところへホワイトスペースを挿入する。<br>
- 結合に使われる &quot;.&quot; を &quot;..&quot; に変更する。<br>
<br>
&nbsp;&nbsp;例えば旧来の Vim script の関数:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo line(1).line(2)</div>
&nbsp;&nbsp;&nbsp;がこうなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo line(1) .. line(2)</div>
<br>
- 常に行継続にバックスラッシュが必要なわけではない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo ['one',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ 'two',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ 'three'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\ ]</div>
&nbsp;&nbsp;&nbsp;がこうなる:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo ['one',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'two',<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'three'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]</div>
<br>
<br>
<span class="PreProc">式のオプションで関数を呼び出す</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#expr-option-function" name="expr-option-function">expr-option-function</a><br>
<a class="Type" href="options.html#'foldexpr'">'foldexpr'</a>&nbsp;などのいくつかのオプションの値は、値を取得するために評価される式で<br>
す。評価には、かなりのオーバーヘッドが発生する可能性があります。オーバーヘッド<br>
を最小限に抑え、オプション値を非常に単純に保つ 1 つの方法は、コンパイル済み関<br>
数を定義し、引数なしで呼び出すようにオプションを設定することです。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFoldFunc(): any<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ... v:lnum の行の折り畳みレベルを計算する<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return level<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set foldexpr=s:MyFoldFunc()</div>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
4. 型&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-types" name="vim9-types">vim9-types</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1008" name="E1008">E1008</a>&nbsp;<a class="Constant" href="vim9.html#E1009" name="E1009">E1009</a>&nbsp;<a class="Constant" href="vim9.html#E1010" name="E1010">E1010</a>&nbsp;<a class="Constant" href="vim9.html#E1012" name="E1012">E1012</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1013" name="E1013">E1013</a>&nbsp;<a class="Constant" href="vim9.html#E1029" name="E1029">E1029</a>&nbsp;<a class="Constant" href="vim9.html#E1030" name="E1030">E1030</a><br>
以下の組み込み型がサポートされています:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;number<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;float<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;blob<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list&lt;<span class="Special">{type}</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dict&lt;<span class="Special">{type}</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;object&lt;<span class="Special">{type}</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;job<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;channel<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tuple&lt;<span class="Special">{type}</span>&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tuple&lt;<span class="Special">{type}</span>,&nbsp;<span class="Special">{type}</span>, ...&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tuple&lt;...list&lt;<span class="Special">{type}</span>&gt;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tuple&lt;<span class="Special">{type}</span>, ...list&lt;<span class="Special">{type}</span>&gt;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func:&nbsp;<span class="Special">{type}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func(<span class="Special">{type}</span>, ...)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;func(<span class="Special">{type}</span>, ...):&nbsp;<span class="Special">{type}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void<br>
<br>
これらの型は宣言において使えますが、いかなる単純値も実際に &quot;void&quot; 型を持つこと<br>
はありません。void (例えば、戻り値のない関数) を使おうとするとエラーがでます。<br>
<a class="Constant" href="vim9.html#E1031" name="E1031">E1031</a>&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1186" name="E1186">E1186</a><br>
<br>
配列型はありません。代わりに list&lt;<span class="Special">{type}</span>&gt; を使ってください。不変のリストに<br>
対しては大量の細かいメモリを割り当てするのを避ける効率的な実装が使われます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#tuple-type" name="tuple-type">tuple-type</a><br>
tuple 型は、多かれ少なかれ具体的な方法で宣言できる:<br>
tuple<span class="Special">&lt;number&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="eval.html#Number">Number</a>&nbsp;型の項目を 1 つ含む tuple<br>
tuple&lt;number, string&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="eval.html#Number">Number</a>&nbsp;と&nbsp;<a class="Identifier" href="eval.html#String">String</a>&nbsp;の 2 つの項目を含む tuple<br>
tuple&lt;number, float, bool&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="eval.html#Number">Number</a>、<a class="Identifier" href="eval.html#Float">Float</a>&nbsp;および&nbsp;<a class="Identifier" href="eval.html#Boolean">Boolean</a>&nbsp;型の 3 つの<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;項目を含む tuple<br>
tuple&lt;...list<span class="Special">&lt;number&gt;</span>&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="eval.html#Number">Number</a>&nbsp;型の 0 個以上の項目を持つ可変長 tuple<br>
tuple&lt;number, ...list<span class="Special">&lt;string&gt;</span>&gt;&nbsp;&nbsp;<a class="Identifier" href="eval.html#Number">Number</a>&nbsp;型の項目とそれに続く 0 個以上の<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Identifier" href="eval.html#String">String</a>&nbsp;型の項目を含む tuple<br>
<br>
例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;var myTuple: tuple&lt;number&gt; = (20,)<br>
&nbsp;&nbsp;&nbsp;&nbsp;var myTuple: tuple&lt;number, string&gt; = (30, 'vim')<br>
&nbsp;&nbsp;&nbsp;&nbsp;var myTuple: tuple&lt;number, float, bool&gt; = (40, 1.1, true)<br>
&nbsp;&nbsp;&nbsp;&nbsp;var myTuple: tuple&lt;...list&lt;string&gt;&gt; = ('a', 'b', 'c')<br>
&nbsp;&nbsp;&nbsp;&nbsp;var myTuple: tuple&lt;number, ...list&lt;string&gt;&gt; = (3, 'a', 'b', 'c')</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#variadic-tuple" name="variadic-tuple">variadic-tuple</a>&nbsp;<a class="Constant" href="vim9.html#E1539" name="E1539">E1539</a><br>
可変長 tuple には、同じ型の 0 個以上の項目が含まれる。可変長 tuple の型はリス<br>
ト型で終わる必要がある。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;var myTuple: tuple&lt;...list&lt;number&gt;&gt; = (1, 2, 3)<br>
&nbsp;&nbsp;&nbsp;&nbsp;var myTuple: tuple&lt;...list&lt;string&gt;&gt; = ('a', 'b', 'c')<br>
&nbsp;&nbsp;&nbsp;&nbsp;var myTuple: tuple&lt;...list&lt;bool&gt;&gt; = ()</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-func-declaration" name="vim9-func-declaration">vim9-func-declaration</a>&nbsp;<a class="Constant" href="vim9.html#E1005" name="E1005">E1005</a>&nbsp;<a class="Constant" href="vim9.html#E1007" name="E1007">E1007</a><br>
部分適用と関数は幾らかの方法で宣言することができます:<br>
func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;任意の種類の関数参照。引数や戻り値への型チェッ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;クはない。<br>
func: void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;任意の数および型の引数で、戻り値はない。<br>
func:&nbsp;<span class="Special">{type}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;任意の数および型の引数で、特定の型の戻り値があ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;る。<br>
<br>
func()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引数がなく、値を返さない関数。<br>
func(): void&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;同上<br>
func():&nbsp;<span class="Special">{type}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引数がなく、戻り値の型がある関数。<br>
<br>
func(<span class="Special">{type}</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引数の型があり、値を返さない関数。<br>
func(<span class="Special">{type}</span>):&nbsp;<span class="Special">{type}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;引数の型と戻り値の型がある関数。<br>
func(?<span class="Special">{type}</span>)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 任意の引数の型があり、値を返さない関数。<br>
func(...list&lt;<span class="Special">{type}</span>&gt;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 可変長引数のリストの型で、値を返さない関数。<br>
func(<span class="Special">{type}</span>, ?<span class="Special">{type}</span>, ...list&lt;<span class="Special">{type}</span>&gt;):&nbsp;<span class="Special">{type}</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;以下をもつ関数:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 必須の引数の型<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 任意の引数の型<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 可変長引数のリストの型<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- 戻り値の型<br>
<br>
もし戻り値の型が &quot;void&quot; なら、関数は値を返しません。<br>
<br>
関数参照はそれが呼び出し側から見えない追加の引数および・あるいは辞書を保存して<br>
いる場合、<a class="Identifier" href="eval.html#Partial">Partial</a>&nbsp;にすることもできます。それらは同じように呼び出されるた<br>
め、宣言も同じです。<br>
<br>
<a class="Comment" href="vim9class.html#:type">:type</a>&nbsp;を使ってカスタム型を定義できます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:type MyList list&lt;string&gt;</div>
ユーザー関数と似たように、後から追加される組み込み型との名前の衝突を避けるた<br>
め、カスタム型は大文字から始まらなければなりません。<br>
<br>
そしてクラスとインターフェイスも型として使えます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:class MyClass<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyClass</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:interface MyInterface<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyInterface</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:class MyTemplate&lt;Targ&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyTemplate&lt;number&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyTemplate&lt;string&gt;</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:class MyInterface&lt;Targ&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyInterface&lt;number&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var mine: MyInterface&lt;string&gt;</div>
<span class="Special">{not implemented yet}</span><br>
<br>
<br>
<span class="PreProc">変数の型と型キャスト</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#variable-types" name="variable-types">variable-types</a><br>
Vim9 script か&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;で定義される関数内で宣言された変数は明示的に示された型<br>
か、初期値から推測された型のどちらかの型を持っています。<br>
<br>
グローバル、バッファ、ウィンドウ、タブページ変数は特定の型を持たず、値はいつで<br>
も書き換えられ、そしてそれは型の変更も含み得ます。なので、コンパイルされたコー<br>
ドでは &quot;any&quot; 型が仮定されます。<br>
<br>
これは &quot;any&quot; 型が望ましくなく、実際の型が常に同じであると想定されるときに問題<br>
になり得ます。例えば、リストを宣言したとき:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var l: list&lt;number&gt; = [1, g:two]</div>
コンパイル時には Vim は &quot;g:two&quot; の型を知らず、式の型は list<span class="Special">&lt;any&gt;</span>&nbsp;になります。<br>
左辺への代入の前にリストの型をチェックするための命令が生成され、少々非効率で<br>
す。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#type-casting" name="type-casting">type-casting</a>&nbsp;<a class="Constant" href="vim9.html#E1104" name="E1104">E1104</a><br>
これを避けるには、型キャストを使ってください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var l: list&lt;number&gt; = [1, &lt;number&gt;g:two]</div>
コンパイルされたコードは今度は &quot;g:two&quot; が数値かどうかをチェックするだけで、も<br>
しそうでないならエラーを与えます。これは型キャストと呼ばれます。<br>
<br>
型キャストの文法は: &quot;&lt;&quot;&nbsp;<span class="Special">{type}</span>&nbsp;&quot;&gt;&quot; です。&quot;&lt;&quot; の後ろ、あるいは &quot;&gt;&quot; の前にホワイ<br>
トスペースがあってはいけません (小なりと大なりの演算子との混乱を避けるためで<br>
す)。<br>
<br>
意味としては、必要であれば実行時の型チェックが行われます。実際に値が変更される<br>
ことはありません。もし型を変える必要があるのであれば、例えば文字列に変換するの<br>
であれば&nbsp;<a class="Identifier" href="builtin.html#string()">string()</a>&nbsp;関数を使ってください。あるいは文字列を数値に変換するのであ<br>
れば&nbsp;<a class="Identifier" href="builtin.html#str2nr()">str2nr()</a>&nbsp;関数を使ってください。<br>
<br>
もし想定されない場所で型が与えられた場合、&nbsp;<a class="Constant" href="vim9.html#E1272" name="E1272">E1272</a>&nbsp;を得るかもしれません。<br>
<br>
型が不完全な場合、例えば、クラスが不明なオブジェクト (通常は NULL オブジェクト)<br>
がある場合などは&nbsp;<a class="Constant" href="vim9.html#E1363" name="E1363">E1363</a>&nbsp;になります。<br>
<br>
<span class="PreProc">型インターフェイス</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#type-inference" name="type-inference">type-inference</a><br>
一般的に: 型が明確な時はいつも型を省略することができます。例えば、変数を宣言<br>
し、値を与えた時:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 数値型と推測する<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name = 'hello'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 文字列型と推測する</div>
<br>
リストと辞書の型は、要素の値の型の共通のものからきます。もしその値が全て同じ型<br>
をもつなら、その型がリストか辞書に使われます。もし型が混在しているなら、&quot;any&quot;<br>
型が使われます。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1, 2, 3]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; list&lt;number&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;['a', 'b', 'c'] list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1, 'x', 3]&nbsp;&nbsp;&nbsp;&nbsp; list&lt;any&gt;</div>
<br>
関数参照の共通の型は、もしそれらが全て同じ数の引数をもつのでなければ、引数の<br>
数が指定されていないことを示すため &quot;(...)&quot; を使います。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Foo(x: bool)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Bar(x: bool, y: bool)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var funclist = [Foo, Bar]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo funclist-&gt;typename()</div>
結果はこうなります:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list&lt;func(...)&gt;<br>
<br>
Vim9 script のスクリプトローカル変数は型がチェックされ、それは変数が旧来の Vim<br>
script の関数内で宣言されたときでも同様です。<br>
<br>
型が宣言されたとき、これはリストや辞書に付け加えられます。後のある式がその型を<br>
変えようとすると、エラーが与えられます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ll: list&lt;number&gt; = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ll-&gt;extend(['x'])&nbsp;&nbsp;# エラー、'x' は数値ではない</div>
<br>
もし型が宣言されていないのであれば、そのときは変えることは許可されます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[1, 2, 3]-&gt;extend(['x'])&nbsp;&nbsp;# 結果: [1, 2, 3, 'x']</div>
<br>
変数の宣言においては、推測された型は重要です:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ll = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ll-&gt;extend(['x'])&nbsp;&nbsp;# エラー、'x' は数値ではない</div>
これは宣言が数値のリストのように見えるためで、それゆえ以下と等しいからです:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ll: list&lt;number&gt; = [1, 2, 3]</div>
もし、もっと寛容なリストが欲しいのであれば、型を宣言する必要があります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ll: list&lt;any&gt; = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ll-&gt;extend(['x'])&nbsp;&nbsp;# OK</div>
<br>
<br>
<span class="PreProc">より厳格な型チェック</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#type-checking" name="type-checking">type-checking</a><br>
旧来の Vim script では、数値が予期されるところでは、文字列は自動的に数値に変換<br>
されます。これは &quot;123&quot; のような実際の数値に対しては便利でしたが、もし文字列が<br>
数字で始まらないときは予期しない問題 (加えてエラーメッセージなしで) を引き起こ<br>
します。これは頻繁に見つけにくいバグを引き起こします。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 123 == '123'</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">1</span><br>
思いがけないスペースがあるとき:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 123 == ' 123'</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">0</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1206" name="E1206">E1206</a>&nbsp;<a class="Constant" href="vim9.html#E1210" name="E1210">E1210</a>&nbsp;<a class="Constant" href="vim9.html#E1212" name="E1212">E1212</a><br>
Vim9 script ではこれは厳格にされています。使われている値が予期される型と一致す<br>
る場合は、ほとんどの場所で前と同じように動作します。時々エラーになり、それゆえ<br>
後方互換性が壊れています。例:<br>
- 真偽値が期待されるところで、値が 0 か 1 でない数値を使う。&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1023" name="E1023">E1023</a><br>
- 数値のオプションを設定するときに文字列を使う。&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1024" name="E1024">E1024</a>&nbsp;<a class="Constant" href="vim9.html#E1105" name="E1105">E1105</a><br>
- 文字列が期待されるところで数値を用いる。<br>
<br>
一つの影響として、型が宣言された場合は&nbsp;<a class="Identifier" href="builtin.html#map()">map()</a>&nbsp;に渡されたリストか辞書の要素の<br>
型は変更されてはいけません。これは Vim9 script ではエラーになります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist: list&lt;number&gt; = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo map(mylist, (i, v) =&gt; 'item ' .. i)</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">E1012: Type mismatch; expected number but got string in map()</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">{訳注: 日本語メッセージの場合: &quot;E1012: 型が不一致です。number が必要で</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Special">すが string でした (map() 内)&quot;}</span><br>
<br>
代わりに、新しくリストを作成する&nbsp;<a class="Identifier" href="builtin.html#mapnew()">mapnew()</a>&nbsp;を使ってください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist: list&lt;number&gt; = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo mapnew(mylist, (i, v) =&gt; 'item ' .. i)</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="PreProc">['item 0', 'item 1', 'item 2']</span><br>
<br>
もし要素の型が宣言されていない、あるいは &quot;any&quot; と決定されているなら、型はより<br>
具体的なものに変更することができます。例えば、型の混ざったリストが文字列のリス<br>
トに変更される場合:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist = [1, 2.0, '3']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# typename(mylist) == &quot;list&lt;any&gt;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map(mylist, (i, v) =&gt; 'item ' .. i)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# typename(mylist) == &quot;list&lt;string&gt;&quot;、エラーなし</div>
<br>
リスト定数を直接使うのと、変数宣言を通して使うのには少しの差異があります。<br>
理由は型推論で、リスト定数を変数を初期化するのに使うとき、それは同時に宣言した<br>
型をつけます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist = [1, 2, 3]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# typename(mylist) == &quot;list&lt;number&gt;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo map(mylist, (i, v) =&gt; 'item ' .. i)&nbsp;&nbsp;# エラー!</div>
<br>
リスト定数を直接使うときは、型は宣言されず、変更することが許可されます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo map([1, 2, 3], (i, v) =&gt; 'item ' .. i)&nbsp;&nbsp;# OK</div>
<br>
この背景となる理由は、型が宣言され、リストが渡されて変更された場合、宣言は常に<br>
保持されている必要があるためです。そのため、宣言された型と一致する型に依存して<br>
います。定数の場合、これは必要ありません。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1158" name="E1158">E1158</a><br>
<a class="Identifier" href="builtin.html#extend()">extend()</a>&nbsp;も同様で、代わりに&nbsp;<a class="Identifier" href="builtin.html#extendnew()">extendnew()</a>&nbsp;を、<a class="Identifier" href="builtin.html#flatten()">flatten()</a>&nbsp;は、代わりに<br>
<a class="Identifier" href="builtin.html#flattennew()">flattennew()</a>&nbsp;を使用します。<a class="Identifier" href="builtin.html#flatten()">flatten()</a>&nbsp;は常に型を変更することを目的としてい<br>
るため、Vim9 script では使用できません。<br>
<br>
引数を指定して funcref に代入すると (<a class="Identifier" href="vim9.html#vim9-func-declaration">vim9-func-declaration</a>&nbsp;を参照)、引数の厳<br>
密な型チェックが行われます。可変数の引数の場合も、型と一致する必要があります:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var FuncRef: func(string, number, bool): number<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FuncRef = (v1: string, v2: number, v3: bool) =&gt; 777&nbsp;&nbsp;&nbsp;&nbsp; # OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FuncRef = (v1: string, v2: number, v3: number) =&gt; 777&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 可変数の引数は同じ型でなければならない<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var FuncVA: func(...list&lt;string&gt;): number<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FuncVA = (...v: list&lt;number&gt;): number =&gt; v&nbsp;&nbsp;# エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FuncVA = (...v: list&lt;any&gt;): number =&gt; v&nbsp;&nbsp;&nbsp;&nbsp; # OK, `any` ランタイム確認<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FuncVA = (v1: string, v: string2): number =&gt; 333&nbsp;&nbsp;&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FuncVA = (v: list&lt;string&gt;): number =&gt; 3&nbsp;&nbsp;&nbsp;&nbsp; # エラー!</div>
<br>
宛先関数参照に引数が指定されていない場合、引数の型のチェックは行われません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var FuncUnknownArgs: func: number<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FuncUnknownArgs = (v): number =&gt; v&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FuncUnknownArgs = (v1: string, v2: string): number =&gt; 3 # OK<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FuncUnknownArgs = (...v1: list&lt;string&gt;): number =&gt; 333&nbsp;&nbsp;# OK</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1211" name="E1211">E1211</a>&nbsp;<a class="Constant" href="vim9.html#E1217" name="E1217">E1217</a>&nbsp;<a class="Constant" href="vim9.html#E1218" name="E1218">E1218</a>&nbsp;<a class="Constant" href="vim9.html#E1219" name="E1219">E1219</a>&nbsp;<a class="Constant" href="vim9.html#E1220" name="E1220">E1220</a>&nbsp;<a class="Constant" href="vim9.html#E1221" name="E1221">E1221</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1222" name="E1222">E1222</a>&nbsp;<a class="Constant" href="vim9.html#E1223" name="E1223">E1223</a>&nbsp;<a class="Constant" href="vim9.html#E1224" name="E1224">E1224</a>&nbsp;<a class="Constant" href="vim9.html#E1225" name="E1225">E1225</a>&nbsp;<a class="Constant" href="vim9.html#E1226" name="E1226">E1226</a>&nbsp;<a class="Constant" href="vim9.html#E1227" name="E1227">E1227</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1228" name="E1228">E1228</a>&nbsp;<a class="Constant" href="vim9.html#E1235" name="E1235">E1235</a>&nbsp;<a class="Constant" href="vim9.html#E1238" name="E1238">E1238</a>&nbsp;<a class="Constant" href="vim9.html#E1250" name="E1250">E1250</a>&nbsp;<a class="Constant" href="vim9.html#E1251" name="E1251">E1251</a>&nbsp;<a class="Constant" href="vim9.html#E1252" name="E1252">E1252</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1253" name="E1253">E1253</a>&nbsp;<a class="Constant" href="vim9.html#E1256" name="E1256">E1256</a>&nbsp;<a class="Constant" href="vim9.html#E1297" name="E1297">E1297</a>&nbsp;<a class="Constant" href="vim9.html#E1298" name="E1298">E1298</a>&nbsp;<a class="Constant" href="vim9.html#E1301" name="E1301">E1301</a>&nbsp;<a class="Constant" href="vim9.html#E1528" name="E1528">E1528</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1529" name="E1529">E1529</a>&nbsp;<a class="Constant" href="vim9.html#E1530" name="E1530">E1530</a>&nbsp;<a class="Constant" href="vim9.html#E1531" name="E1531">E1531</a>&nbsp;<a class="Constant" href="vim9.html#E1534" name="E1534">E1534</a><br>
間違いを発見しやすくするために、ほとんどの組み込み関数で型がチェックされます。<br>
<br>
<span class="PreProc">変数のカテゴリー、デフォルトおよび null の扱い</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#variable-categories" name="variable-categories">variable-categories</a>&nbsp;<a class="Constant" href="vim9.html#null-variables" name="null-variables">null-variables</a><br>
変数には次のカテゴリがあります:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;プリミティブ&nbsp;&nbsp;&nbsp;&nbsp;number, float, boolean<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;コンテナ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string, blob, list, tuple, dict<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;特殊&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function, job, channel, user-defined-object<br>
<br>
初期化子を使用せずに変数を宣言する場合は、明示的に型を指定する必要があります。<br>
各カテゴリには、異なるデフォルトの初期化セマンティクスがあります。カテゴリごと<br>
の例を次に示します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var num: number&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # プリミティブのデフォルトは 0 相当<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var cont: list&lt;string&gt;&nbsp;&nbsp;# コンテナのデフォルトは空コンテナ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var spec: job&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 特殊変数のデフォルトは null</div>
<br>
Vim にはおなじみの null 値はありません。<a class="Identifier" href="vim9.html#null_string">null_string</a>、<a class="Identifier" href="vim9.html#null_list">null_list</a>、<a class="Identifier" href="vim9.html#null_job">null_job</a><br>
など、さまざまな null_<span class="Special">&lt;type&gt;</span>&nbsp;があらかじめ定義されています。プリミティブは<br>
null_<span class="Special">&lt;type&gt;</span>&nbsp;を持ちません。null_<span class="Special">&lt;type&gt;</span>&nbsp;の典型的な使用例は以下の通りです:<br>
- 変数をクリアし、そのリソースを解放。<br>
- 関数定義内のパラメータのデフォルトとしては、<a class="Identifier" href="vim9.html#null-compare">null-compare</a>&nbsp;を参照。<br>
<br>
<a class="Comment" href="channel.html#job">job</a>&nbsp;などの特殊な変数の場合、リソースをクリアするために null_<span class="Special">&lt;type&gt;</span>&nbsp;が使用さ<br>
れます。コンテナ変数の場合、空コンテナを変数に割り当てることによってリソースを<br>
クリアすることもできます。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var j: job = job_start(...)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ... ジョブはその仕事を行う<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j = null_job&nbsp;&nbsp;&nbsp;&nbsp;# 変数をクリアしてジョブのリソースを解放する</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var l: list&lt;any&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# ... リストにたくさんのものを追加<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l = []&nbsp;&nbsp;# 変数をクリアしてコンテナリソースを解放する</div>
null_<span class="Special">&lt;type&gt;</span>&nbsp;ではなく空コンテナを使用してコンテナ変数をクリアすると、<br>
<a class="Identifier" href="vim9.html#null-anomalies">null-anomalies</a>&nbsp;で説明されているように null の複雑な問題を回避できる可能性が<br>
あります。<br>
<br>
コンテナ変数と特殊な変数の初期化セマンティクスは異なります。初期化されていない<br>
コンテナはデフォルトで空コンテナになります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var l1: list&lt;string&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 空コンテナ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var l2: list&lt;string&gt; = []&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 空コンテナ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var l3: list&lt;string&gt; = null_list&nbsp;&nbsp;&nbsp;&nbsp;# null コンテナ</div>
&quot;l1&quot; と &quot;l2&quot; は同等で区別できない初期化です。ただし、&quot;l3&quot; は null コンテナで<br>
す。null コンテナは空コンテナに似ていますが、異なります。<a class="Identifier" href="vim9.html#null-anomalies">null-anomalies</a>&nbsp;を参<br>
照してください。<br>
<br>
特殊変数のデフォルトは null です。これらのジョブの初期化は同等であり、区別でき<br>
ません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var j1: job<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var j2: job = null_job<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var j3 = null_job</div>
<br>
リストまたは辞書が宣言されている時に、項目の型が指定されておらず推論できない場<br>
合、型は &quot;any&quot; になります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var d1 = {}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 型は &quot;dict&lt;any&gt;&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var d2 = null_dict&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 型は &quot;dict&lt;any&gt;&quot;</div>
<br>
関数の宣言は特に独特です。<a class="Identifier" href="vim9.html#vim9-func-declaration">vim9-func-declaration</a>&nbsp;を参照。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#null-compare" name="null-compare">null-compare</a><br>
一般的な null 比較セマンティクスでは、null コンテナが空コンテナと等しくない場<br>
合、比較で null_<span class="Special">&lt;type&gt;</span>&nbsp;を使用しないでください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def F(arg: list&lt;string&gt; = null_list)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if arg == null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo &quot;null&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo printf(&quot;not null, %sempty&quot;, empty(arg) ? '' : 'not ')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 出力: &quot;null&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F(null_list)&nbsp;&nbsp;&nbsp;&nbsp;# 出力: &quot;null&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F([])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 出力: &quot;not null, empty&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;F([''])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 出力: &quot;not null, not empty&quot;</div>
上記の関数は文字列のリストを取得し、それについてレポートします。<br>
さまざまな種類の引数を受け入れるように、上記の関数シグネチャを変更します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def F(arg: list&lt;any&gt; = null_list)&nbsp;&nbsp; # あらゆるタイプのリスト<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def F(arg: any = null)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# あらゆるタイプ</div>
<br>
上記の例では、null リストと空リストを区別することが目的であり、<a class="Comment" href="vim9.html#null_list">null_list</a>&nbsp;で<br>
はなく&nbsp;<a class="Comment" href="vim9.html#null">null</a>&nbsp;と比較することが正しい選択です。基本的な理由は、<br>
&quot;null_list == null&quot; および &quot;[] != null&quot; であるためです。<br>
&quot;[] == null_list&quot; であるため、<a class="Comment" href="vim9.html#null_list">null_list</a>&nbsp;との比較は失敗します。次のセクション<br>
で比較結果の詳細が記載されています。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#null-details" name="null-details">null-details</a>&nbsp;<a class="Constant" href="vim9.html#null-anomalies" name="null-anomalies">null-anomalies</a><br>
このセクションでは、null および null_<span class="Special">&lt;type&gt;</span>&nbsp;の使用に関する問題について説明しま<br>
す。以下に、null 比較の列挙結果を示します。場合によっては、vim9 の null セマン<br>
ティクスに精通している場合、プログラマは比較やその他の状況で null_<span class="Special">&lt;type&gt;</span>&nbsp;を使<br>
用することを選択することがあります。<br>
<br>
ドキュメントの他の場所には次のように書かれています:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 多くの場合、null 値は空の値と同じように処理されますが、常にそうとは限<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; りません<br>
以下に例を示します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var s1: list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var s2: list&lt;string&gt; = null_list<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 出力: &quot;[]&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 出力: &quot;[]&quot;</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s1 + ['a']&nbsp;&nbsp;&nbsp;&nbsp; # 出力: &quot;['a']&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s2 + ['a']&nbsp;&nbsp;&nbsp;&nbsp; # 出力: &quot;['a']&quot;</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s1-&gt;add('a')&nbsp;&nbsp; # 出力: &quot;['a']&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s2-&gt;add('a')&nbsp;&nbsp; # E1130: Can not add to null list</div>
<br>
null_<span class="Special">&lt;type&gt;</span>&nbsp;に等しい 2 つの値は、必ずしも互いに等しいとは限りません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo {} == null_dict&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo null_dict == null&nbsp;&nbsp;&nbsp;&nbsp;# true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo {} == null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # false</div>
<br>
他のコンテナとは異なり、初期化されていない文字列は null と等しくなります。<a class="Comment" href="motion.html#is">is</a><br>
演算子を使用して、null_string かどうかを判断できます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var s1: string<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var s2 = null_string<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s1 == null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # true - これは想定外<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s2 == null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s2 is null_string&nbsp;&nbsp;# true</div>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var b1: blob<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var b2 = null_blob<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo b1 == null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo b2 == null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # true</div>
<br>
null_<span class="Special">&lt;type&gt;</span>&nbsp;に初期化された変数はすべて、null_<span class="Special">&lt;type&gt;</span>&nbsp;と等しく、また null と等し<br>
くなります。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var x = null_blob<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo x == null_blob&nbsp;&nbsp;&nbsp;&nbsp; # true<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo x == null&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# true</div>
<br>
初期化されていない変数は通常、null と等しくなります。それはそのタイプによって<br>
異なります:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var s: string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; s == null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var b: blob&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b != null&nbsp;&nbsp; ***<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var l: list<span class="Special">&lt;any&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;l != null&nbsp;&nbsp; ***<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var t: tuple<span class="Special">&lt;any&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; t != null&nbsp;&nbsp; ***<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var d: dict<span class="Special">&lt;any&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;d != null&nbsp;&nbsp; ***<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var f: func&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f == null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var j: job&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j == null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var c: channel&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c == null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var o: Class&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;o == null<br>
<br>
空に初期化された変数は null_<span class="Special">&lt;type&gt;</span>&nbsp;と同等です。null ではありません:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var s2: string = &quot;&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; == null_string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!= null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var b2: blob = 0z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; == null_blob&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!= null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var l2: list<span class="Special">&lt;any&gt;</span>&nbsp;= []&nbsp;&nbsp;&nbsp;&nbsp;== null_list&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!= null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var t2: tuple<span class="Special">&lt;any&gt;</span>&nbsp;= ()&nbsp;&nbsp; == null_tuple&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; != null<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var d2: dict<span class="Special">&lt;any&gt;</span>&nbsp;= {}&nbsp;&nbsp;&nbsp;&nbsp;== null_dict&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;!= null<br>
<br>
<span class="Todo">NOTE</span>: ジョブなどの特殊な変数はデフォルトで null 値になり、対応する空の値はあり<br>
ません。<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#generic-functions" name="generic-functions">generic-functions</a><br>
5. ジェネリック関数<br>
<br>
ジェネリック関数は、引数と戻り値の型チェックを維持しながら、同じ関数を異なる型<br>
の引数で使用できる。これにより、型安全性とコードの再利用性が確保される。<br>
<br>
<br>
<span class="PreProc">宣言</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#generic-function-declaration" name="generic-function-declaration">generic-function-declaration</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1553" name="E1553">E1553</a>&nbsp;<a class="Constant" href="vim9.html#E1554" name="E1554">E1554</a><br>
ジェネリック関数の型変数は、関数名の直後に山括弧 (&quot;&lt;&quot;i と &quot;&gt;&quot;) で囲まれた型パ<br>
ラメータとして宣言される。複数の型パラメータはコンマで区切られる:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def[!] {funcname}&lt;{type} [, {types}]&gt;([arguments])[: {return-type}]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{function body}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#generic-function-example" name="generic-function-example">generic-function-example</a><br>
これらの型パラメータは、他の型と同様に、関数シグネチャとその本体内で使用でき<br>
る。以下の例では、2 つのリストを tuple のリストに結合している: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Zip&lt;T, U&gt;(first: list<span class="Special">&lt;T&gt;</span>, second: list<span class="Special">&lt;U&gt;</span>): list&lt;tuple&lt;T, U&gt;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const LEN: number = ([first-&gt;len(), second-&gt;len()])-&gt;min()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final result: list&lt;tuple&lt;T, U&gt;&gt; = []<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for i in range(LEN)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result-&gt;add((first[i], second[i]))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var n: list<span class="Special">&lt;number&gt;</span>&nbsp;= [61, 62, 63]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var s: list<span class="Special">&lt;string&gt;</span>&nbsp;= ['a', 'b', 'c']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo $&quot;Zip example #1: {Zip&lt;number, string&gt;(n, s)}&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo $&quot;Zip example #2: {Zip&lt;string, number&gt;(s, n)}&quot;<br>
&lt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#type-variable-naming" name="type-variable-naming">type-variable-naming</a>&nbsp;<a class="Constant" href="vim9.html#E1552" name="E1552">E1552</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#type-parameter-naming" name="type-parameter-naming">type-parameter-naming</a><br>
前の例と同様に、名前には大文字を 1 文字だけ使用するのが慣例である (例えば、T、<br>
U、Aなど)。複数の文字で構成されている場合もあるが、名前は必ず大文字で始まる必<br>
要がある。この例では、&quot;Ok&quot; は有効だが、&quot;n&quot; は無効である: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def MyFail&lt;Ok, n&gt;(): void<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# E1552: Type variable name must start with an uppercase letter: n...<br>
&lt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1558" name="E1558">E1558</a>&nbsp;<a class="Constant" href="vim9.html#E1560" name="E1560">E1560</a><br>
関数は、ジェネリック関数または通常の関数のいずれかとして宣言および使用する必要<br>
がある。両方を同時に使用することはできない。以下の Vim9 script は、これらのエ<br>
ラーを示している: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;My1558<span class="Special">&lt;number&gt;</span>()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Vim(eval):E1558: Unknown generic function: My1558<br>
&lt; &gt;vim9<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def My1560(): void<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;My1560<span class="Special">&lt;string&gt;</span>()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Vim(echo):E1560: Not a generic function: My1560<br>
&lt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1561" name="E1561">E1561</a><br>
型パラメータ名は他の識別子と競合してはならない: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def My1561&lt;D, E, D&gt;(): D<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# E1561: Duplicate type variable name: D<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enum E<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Yes, No<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endenum<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def My1041<span class="Special">&lt;E&gt;</span>(): E<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# E0141: Redefining script item &quot;E&quot;<br>
&lt;<br>
<br>
<span class="PreProc">ジェネリック関数の呼び出し</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#generic-function-call" name="generic-function-call">generic-function-call</a><br>
ジェネリック関数を呼び出すには、関数名と引数リストの間に &quot;&lt;&quot; と &quot;&gt;&quot; で具体的な<br>
型を指定する:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyFunc&lt;number, string, list&lt;number&gt;&gt;()</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Todo">NOTE</span>: このセクションには、<a class="Identifier" href="vim9.html#generic-function-example">generic-function-example</a>&nbsp;など、ソースとし<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;て参照できる実用的な例がいくつかある。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1555" name="E1555">E1555</a>&nbsp;<a class="Constant" href="vim9.html#E1556" name="E1556">E1556</a>&nbsp;<a class="Constant" href="vim9.html#E1557" name="E1557">E1557</a>&nbsp;<a class="Constant" href="vim9.html#E1559" name="E1559">E1559</a><br>
関数に渡される型引数の数は、宣言された型パラメータの数と一致している必要があ<br>
る。空の型リストは許可されない。例: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def My1555&lt;&gt;(): void<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# E1555: Empty type list specified for generic function ...<br>
&lt; &gt;vim9<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def My1556<span class="Special">&lt;T&gt;</span>(): void<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;My1556&lt;bool, bool&gt;()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# E1556: Too many types specified for generic function ...<br>
&lt; &gt;vim9<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def My1557&lt;T, U&gt;(): void<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;My1557<span class="Special">&lt;bool&gt;</span>()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# E1557: Not enough types specified for generic function ...<br>
&lt; &gt;vim9<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def My1559<span class="Special">&lt;T&gt;</span>(): T<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;My1559()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Vim(eval):E1559: Type arguments missing for generic function ...<br>
&lt;<br>
任意の Vim9 型 (<a class="Identifier" href="vim9.html#vim9-types">vim9-types</a>) は、ジェネリック関数内の具体的な型として使用でき<br>
る。<br>
<br>
スペースは使用できない:<br>
- 関数名と &quot;&lt;&quot; の間 (<a class="Identifier" href="vim9.html#E1068">E1068</a>)<br>
- &quot;&gt;&quot; と &quot;(&quot; の間 (<a class="Identifier" href="vim9.html#E1068">E1068</a>)、または<br>
- &quot;&lt;&quot; と &quot;&gt;&quot; 内。ただし、型を区切るコンマの後に必須の箇所を除く (<a class="Identifier" href="vim9.html#E1202">E1202</a>)。<br>
<br>
ジェネリック関数は通常の関数と同様に export および import できる。<a class="Identifier" href="vim9.html#:export">:export</a>&nbsp;お<br>
よび&nbsp;<a class="Identifier" href="vim9.html#:import">:import</a>&nbsp;を参照。<br>
<br>
ジェネリック関数は、別の通常関数またはジェネリック関数内で定義できる。<br>
例: &gt;vim9<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Outer(): void<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# Returns either the first item of a list or a default value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def FirstOrDefault&lt;T, U&gt;(lst: list<span class="Special">&lt;T&gt;</span>, default: U): any<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return lst-&gt;len() &gt; 0 ? lst[0] : default<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo FirstOrDefault&lt;string, bool&gt;(['B', 'C'], false)&nbsp;&nbsp;# echos B<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo FirstOrDefault&lt;number, number&gt;([], 42)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # echos 42<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Outer()<br>
&lt;<br>
<br>
<span class="PreProc">型変数を型引数として使用する</span><br>
<br>
型変数は型引数として渡すこともできる。例: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# T は型パラメータとして宣言されている<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# これは&nbsp;<span class="MissingTag">'value'</span>&nbsp;パラメータと戻り値の型に使用される<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Id<span class="Special">&lt;T&gt;</span>(value: T): T<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return value<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# U は型パラメータとして宣言されている<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# これは&nbsp;<span class="MissingTag">'value'</span>&nbsp;パラメータと戻り値の型に使用される<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def CallId<span class="Special">&lt;U&gt;</span>(value: U): U<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# U は型引数として渡される/使用される型変数である<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return Id<span class="Special">&lt;U&gt;</span>(value)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo CallId<span class="Special">&lt;string&gt;</span>('I am') .. ' ' .. CallId<span class="Special">&lt;number&gt;</span>(42)<br>
<br>
これは、リストの辞書や、以下の例のように辞書のリストのような複雑なデータ構造に<br>
役立つ: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Flatten<span class="Special">&lt;T&gt;</span>(x: list&lt;list<span class="Special">&lt;T&gt;</span>&gt;): list<span class="Special">&lt;T&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final result: list<span class="Special">&lt;T&gt;</span>&nbsp;= []<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for inner in x<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result-&gt;extend(inner)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endfor<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return result<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const ENGLISH: list&lt;dict<span class="Special">&lt;string&gt;</span>&gt; = [{1:&nbsp;<span class="MissingTag">'one'</span>}, {2:&nbsp;<span class="MissingTag">'two'</span>}]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const MANDARIN: list&lt;dict<span class="Special">&lt;string&gt;</span>&gt; = [{1: '壹'}, {2: '贰'}]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const ARABIC_N: list&lt;dict<span class="Special">&lt;number&gt;</span>&gt; = [{1: 1}, {2: 2}]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo Flatten&lt;dict<span class="Special">&lt;string&gt;</span>&gt;([ENGLISH, MANDARIN])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo Flatten&lt;dict<span class="Special">&lt;any&gt;</span>&gt;([ENGLISH, ARABIC_N])<br>
&lt;<br>
&quot;Flatten<span class="Special">&lt;T&gt;</span>&quot; では、&quot;T&quot; は宣言された型パラメータである。関数内の他の場所では、<br>
&quot;T&quot; はその型パラメータを参照する型変数である。<br>
<br>
<br>
<span class="PreProc">ジェネリッククラスメソッド</span><br>
<br>
Vim9 クラスのメソッドはジェネリック関数になることができる: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class Config<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var settings: dict<span class="Special">&lt;any&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Get<span class="Special">&lt;T&gt;</span>(key: string): T<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return this.settings[key]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endclass<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var c: Config = Config.new({timeout: 30, debug: true})<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo c.Get<span class="Special">&lt;number&gt;</span>(<a class="Type" href="options.html#'timeout'">'timeout'</a>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo c.Get<span class="Special">&lt;bool&gt;</span>(<a class="Type" href="options.html#'debug'">'debug'</a>)<br>
&lt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1432" name="E1432">E1432</a>&nbsp;<a class="Constant" href="vim9.html#E1433" name="E1433">E1433</a>&nbsp;<a class="Constant" href="vim9.html#E1434" name="E1434">E1434</a><br>
基底クラスのジェネリッククラスメソッドは、子クラスのジェネリックメソッドでオー<br>
バーライドできる。型変数の数は両方のメソッド間で一致している必要がある。具象ク<br>
ラスメソッドをジェネリックメソッドでオーバーライドすることはできない。逆もまた<br>
同様である。<br>
<br>
<span class="PreProc">ジェネリック関数参照</span><br>
<br>
関数参照 (<a class="Identifier" href="eval.html#Funcref">Funcref</a>) はジェネリック関数として使用できる。これにより、特定の型<br>
を操作する関数のファクトリーを作成できる: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 文字列内の指定された文字、またはリスト内の文字の 10 進数値と一致す<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# る。<span class="Todo">Note</span>: '*' は 10 進数の 42 (U+002A)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var c: string = &quot;*&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var char_dec: tuple&lt;string, string&gt; = (c, c-&gt;char2nr()-&gt;string())<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Matcher<span class="Special">&lt;T&gt;</span>(pattern: string): func(T): bool<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return (value: T): bool =&gt; match(value, pattern) &gt;= 0<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enddef<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var StringMatch = Matcher<span class="Special">&lt;string&gt;</span>(char_dec[0])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo &quot;*+&quot;-&gt;StringMatch()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# true (has *)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo &quot;,-&quot;-&gt;StringMatch()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# false<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var ListMatch = Matcher&lt;list<span class="Special">&lt;number&gt;</span>&gt;(char_dec[1])<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo [42, 43]-&gt;ListMatch()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# true (has 42)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo [44, 45]-&gt;ListMatch()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# false<br>
&lt;<br>
<br>
<span class="PreProc">ジェネリック関数のコンパイルと逆アセンブル</span><br>
<br>
<a class="Identifier" href="vim9.html#:defcompile">:defcompile</a>&nbsp;コマンドは、具体的な型の特定のリストを持つジェネリック関数をコン<br>
パイルするために使用できる:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defcompile MyFunc&lt;number, list&lt;number&gt;, dict&lt;string&gt;&gt;</div>
<br>
<a class="Identifier" href="vim9.html#:disassemble">:disassemble</a>&nbsp;コマンドを使用すると、ジェネリック関数に対して生成された命令を<br>
一覧表示できる:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disassemble MyFunc&lt;string, dict&lt;string&gt;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;disassemble MyFunc&lt;number, list&lt;blob&gt;&gt;</div>
<br>
<br>
<span class="PreProc">制限事項と今後の課題</span><br>
<br>
現在、Vim は以下をサポートしていない:<br>
&nbsp;&nbsp; - 型変数の型推論: ジェネリック関数を呼び出す際は、すべての型を明示的に指定<br>
&nbsp;&nbsp;&nbsp;&nbsp; する必要がある。<br>
&nbsp;&nbsp; - 型制約: 型変数を特定のクラスまたはインターフェイスに制限することはできな<br>
&nbsp;&nbsp;&nbsp;&nbsp; い (例:&nbsp;<span class="Comment">T extends SomeInterface</span>)。<br>
&nbsp;&nbsp; - デフォルト型引数: 型パラメータが明示的に指定されていない場合に、デフォル<br>
&nbsp;&nbsp;&nbsp;&nbsp; トの型を提供する。<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
6. 名前空間、Import と Export<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9script" name="vim9script">vim9script</a>&nbsp;<a class="Constant" href="vim9.html#vim9-export" name="vim9-export">vim9-export</a>&nbsp;<a class="Constant" href="vim9.html#vim9-import" name="vim9-import">vim9-import</a><br>
<br>
Vim9 script は、import されるように書くことができます。これは、いくつかの項目<br>
が意図的に export され、他のスクリプトで利用できるようになることを意味します。<br>
export したスクリプトが他のスクリプトで import されると、これらの export され<br>
た項目はそのスクリプトで使用することができます。その他の項目は、export したス<br>
クリプトのスクリプトローカルのままであり、import スクリプトからアクセスするこ<br>
とはできません。<br>
<br>
この機構は、他のスクリプトがソース (import される) されうるスクリプトを書くた<br>
めに存在し、他のスクリプトがあなたが望むものだけにアクセスできるようにします。<br>
また、名前衝突の危険性があるグローバル名前空間を使用することも避けられます。例<br>
えば、似たような機能を持つ2つのプラグインがある場合です。<br>
<br>
グローバル名前空間を明示的に使用することで、ごまかすことができます。これは、本<br>
当にグローバルなものだけに行うべきことです。<br>
<br>
<br>
<span class="PreProc">名前空間</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-namespace" name="vim9-namespace">vim9-namespace</a><br>
import 可能なファイルを認識するためには、<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;ステートメントがファイル<br>
の最初のステートメントとして現れる必要があります (例外については&nbsp;<a class="Identifier" href="vim9.html#vim9-mix">vim9-mix</a>&nbsp;を<br>
参照)。これは Vim に、グローバルな名前空間ではなく、独自の名前空間でスクリプト<br>
を解釈するように指示します。ファイルが次で始まる場合:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var myvar = 'yes'</div>
&quot;myvar&quot; はこのファイルの中にしか存在しないことになります。一方、<a class="Comment" href="vim9.html#vim9script">vim9script</a><br>
がなければ、他のスクリプトや関数から&nbsp;<span class="Comment">g:myvar</span>&nbsp;として利用できます。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1101" name="E1101">E1101</a><br>
ファイルレベルの変数は、旧来のVim script のスクリプトローカル変数 &quot;s:&quot; と非常<br>
によく似ていますが、&quot;s:&quot; は省略されています。そして、それらは削除することがで<br>
きません。<br>
<br>
Vim9 script では、グローバルな &quot;g:&quot; 名前空間は従来通り使用可能です。また、<br>
&quot;w:&quot;、&quot;b:&quot;、&quot;t: &quot; 名前空間も使用できます。これらの共通点は、変数が宣言されてい<br>
ないこと、特定の型を持っていないこと、削除できることです。&nbsp;<a class="Constant" href="vim9.html#E1304" name="E1304">E1304</a><br>
<br>
<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;の副作用として、<a class="Type" href="options.html#'cpoptions'">'cpoptions'</a>&nbsp;オプションが Vim のデフォルト値に設定<br>
されることが挙げられます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:set cpo&amp;vim</div>
効果の1つは、<a class="Identifier" href="repeat.html#line-continuation">line-continuation</a>&nbsp;が常に有効であることです。<a class="Type" href="options.html#'cpoptions'">'cpoptions'</a>&nbsp;の元の<br>
値はスクリプトの最後に復元され、スクリプトで追加または削除されたフラグも元の値<br>
に追加または削除されて同じ効果を得ることができます。フラグの順序は変更されるこ<br>
とがあります。起動時に読み込まれる&nbsp;<a class="Identifier" href="starting.html#vimrc">vimrc</a>&nbsp;ファイルでは、このようなことは起こ<br>
りません。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-mix" name="vim9-mix">vim9-mix</a><br>
1 つのスクリプトファイルで、旧来と Vim9 の両方の構文を使用する方法がある: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot; _legacy Vim script_ comments here<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !has('vim9script')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot; _legacy Vim script_ comments/commands here<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; finish<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# _Vim9 script_ commands/commands from here onwards<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echowindow $&quot;has('vim9script') == {has('vim9script')}&quot;<br>
&lt;<br>
これにより、可能であれば Vim9 script 構文を活用するスクリプトを作成できるよう<br>
になり、'vim9script' のないバージョンの Vim で vim9script コマンドを使用した場<br>
合にエラーが発生するのを防ぐことができる。<br>
<br>
<span class="Todo">Note</span>&nbsp;Vim9 の構文は Vim 9 より前に変更されたため、現在の構文 (&quot;import&quot; ではなく<br>
&quot;import from&quot; など) を使用するスクリプトはエラーをスローする可能性がある。<br>
これを防ぐには、代わりに&nbsp;<a class="Identifier" href="eval.html#v:version">v:version</a>&nbsp;&gt;= 900 というチェックを行う方が安全である<br>
(&quot;has('vim9script')&quot; はパッチ 3965 を適用した Vim 8.2 では&nbsp;<a class="Comment" href="eval.html#v:true">v:true</a>&nbsp;を返すた<br>
め)。<br>
場合によっては、さらに後で切り捨てるのが賢明なこともある。Vim9 script の機能<br>
セットは増え続けているため、例えば tuple が使用される場合 (Vim 9.1 パッチ 1232<br>
で導入)、より適切な条件は以下のとおりである: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if !has('patch-9.1.1232')<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echowindow $&quot;Fail: Vim does not have patch 9.1.1232&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;finish<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endif<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echowindow $&quot;Pass: version&nbsp;<span class="Special">{v:versionlong}</span>.&nbsp;&nbsp;Continuing ...&quot;<br>
&lt;<br>
どちらの vim-mix 条件が使用されても、以下の 2 つの方法のいずれかでのみ機能す<br>
る:<br>
&nbsp;&nbsp;&nbsp;&nbsp;1. &quot;if&quot; ステートメントが false と評価されると、<a class="Comment" href="eval.html#:endif">endif</a>&nbsp;までのコマンドはス<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; キップされ、<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;が実際に実行される最初のコマンドになる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;2. &quot;if&quot; ステートメントは true と評価され、<a class="Comment" href="eval.html#:endif">endif</a>&nbsp;までのコマンドが実行され、<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="repeat.html#:finish">finish</a>&nbsp;は&nbsp;<a class="Comment" href="vim9.html#vim9script">vim9script</a>&nbsp;に到達する前に終了する。<br>
<br>
<span class="PreProc">Export</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:export" name=":export">:export</a>&nbsp;<a class="Constant" href="vim9.html#:exp" name=":exp">:exp</a><br>
項目の export は次のように記述できます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export const EXPORTED_CONST = 1234<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export var someValue = ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export final someValue = ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export const someValue = ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export def MyFunc() ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export class MyClass ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export interface MyClass ...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export enum MyEnum ...</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1043" name="E1043">E1043</a>&nbsp;<a class="Constant" href="vim9.html#E1044" name="E1044">E1044</a><br>
このことからわかるように、定数、変数、<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;関数、クラス、インターフェイス、<br>
列挙型のみが export 可能です。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1042" name="E1042">E1042</a><br>
<a class="Comment" href="vim9.html#:export">:export</a>&nbsp;はスクリプトレベルで、Vim9 script でのみ使用できます。<br>
<br>
<br>
<span class="PreProc">Import</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:import" name=":import">:import</a>&nbsp;<a class="Constant" href="vim9.html#:imp" name=":imp">:imp</a>&nbsp;<a class="Constant" href="vim9.html#E1094" name="E1094">E1094</a>&nbsp;<a class="Constant" href="vim9.html#E1047" name="E1047">E1047</a>&nbsp;<a class="Constant" href="vim9.html#E1262" name="E1262">E1262</a><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1048" name="E1048">E1048</a>&nbsp;<a class="Constant" href="vim9.html#E1049" name="E1049">E1049</a>&nbsp;<a class="Constant" href="vim9.html#E1053" name="E1053">E1053</a>&nbsp;<a class="Constant" href="vim9.html#E1071" name="E1071">E1071</a>&nbsp;<a class="Constant" href="vim9.html#E1088" name="E1088">E1088</a>&nbsp;<a class="Constant" href="vim9.html#E1236" name="E1236">E1236</a><br>
export された項目は、別のスクリプトで import することができます。import 構文に<br>
は、2つの形式があります。単純な形式は:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import {filename}</div>
<br>
ここで&nbsp;<span class="Special">{filename}</span>&nbsp;は文字列として評価される式でなければなりません。この形式では、<br>
ファイル名は &quot;.vim&quot; で終わる必要があり、&quot;.vim&quot; より前の部分が名前空間のスクリ<br>
プトローカル名となります。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import &quot;myscript.vim&quot;</div>
<br>
これにより、&quot;myscript.vim&quot; に export された各項目は、&quot;myscript.item&quot; 等として<br>
利用可能になります。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:import-as" name=":import-as">:import-as</a>&nbsp;<a class="Constant" href="vim9.html#E1257" name="E1257">E1257</a>&nbsp;<a class="Constant" href="vim9.html#E1261" name="E1261">E1261</a><br>
名前が長い場合や曖昧な場合は、この形式を使用して別の名前を指定することができま<br>
す:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import {longfilename} as {name}</div>
<br>
この形式では、<span class="Special">{name}</span>&nbsp;が import された名前空間の特定のスクリプトローカル名とな<br>
ります。したがって、<span class="Special">{name}</span>&nbsp;は&nbsp;<a class="Identifier" href="eval.html#internal-variables">internal-variables</a>&nbsp;のように、文字、数字、'_'<br>
で構成されなければなりません。<span class="Special">{longfilename}</span>&nbsp;式は、任意のファイル名で評価する<br>
必要があります。例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import &quot;thatscript.vim.v2&quot; as that</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1060" name="E1060">E1060</a>&nbsp;<a class="Constant" href="vim9.html#E1258" name="E1258">E1258</a>&nbsp;<a class="Constant" href="vim9.html#E1259" name="E1259">E1259</a>&nbsp;<a class="Constant" href="vim9.html#E1260" name="E1260">E1260</a><br>
&quot;that.item&quot; 等として使えます。&quot;that&quot; という名称は自由です。import したスクリプ<br>
トを指していると認識されるようなものを使ってください。コマンド名、コマンド修飾<br>
語、組み込み関数名などは避けてください。名前がそれらと被るからです。名前を大文<br>
字で始めないほうがいいです。大文字で始めると、グローバルなユーザーコマンドや関<br>
数と被る可能性があります。また、その名前を関数や変数名など、スクリプト内の他の<br>
何かに使用することはできません。<br>
<br>
名前のドットが望ましくない場合は、関数のローカル参照を作成できます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var LongFunc = that.LongFuncName</div>
<br>
これは定数に対しても機能します:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const MAXLEN = that.MAX_LEN_OF_NAME</div>
<br>
これは変数には使えません。なぜなら、値は一度コピーされ、変数を変更するときは元<br>
の変数ではなく、コピーが変更されるからです。ドットを含む完全な名前を使用する必<br>
要があります。<br>
<br>
関数内で&nbsp;<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;を使用することはできません。import された項目はスクリプトレ<br>
ベルに存在し、一度だけ import されることを意図しています。<br>
<br>
<a class="Comment" href="vim9.html#:import">import</a>&nbsp;の後のスクリプト名は次のようになります:<br>
- &quot;.&quot; または &quot;..&quot; で始まる相対パス。スクリプトファイル自体の位置から相対的に<br>
&nbsp;&nbsp;ファイルを検索する。大きなプラグインを複数のファイルに分割して使用する場合に<br>
&nbsp;&nbsp;便利である。<br>
- 絶対パス。Unixでは &quot;/&quot;、MS-Windowsでは &quot;D:/&quot; で始まる。これはほとんど使用さ<br>
&nbsp;&nbsp;れない。<br>
- 相対パスでも絶対パスでもないパス。これは、<a class="Type" href="options.html#'runtimepath'">'runtimepath'</a>&nbsp;エントリの &quot;import&quot;<br>
&nbsp;&nbsp;サブディレクトリで見つかる。間違ったファイルを読み込まないようにするため、通<br>
&nbsp;&nbsp;常、名前は長く、一意であるべきである。<br>
&nbsp;&nbsp;<span class="Todo">Note</span>&nbsp;&quot;after/import&quot; は使われない。<br>
<br>
名前が &quot;.vim&quot; で終わらない場合は、&quot;as name&quot; を使用する必要があります。<br>
<br>
Vim9 script ファイルを一度 import すると、その結果はキャッシュされ、次に同じス<br>
クリプトを import するときに使用されます。再度読み込まれることはありません。<br>
<br>
2 つの異なる &quot;as&quot; 名を使用する場合も同様に、同じスクリプトを 2 回 import する<br>
ことはできません。<br>
<br>
import 名を使用する場合、ドットと項目名は同じ行になければならず、改行すること<br>
はできません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo that.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name&nbsp;&nbsp; # エラー!<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo that<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.name&nbsp;&nbsp;# エラー!</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#import-map" name="import-map">import-map</a><br>
あるスクリプトから Vim9 script に関数を import した場合、import した関数の前に<br>
<a class="Identifier" href="map.html#<SID>">&lt;SID&gt;</a>&nbsp;を付けることで、マッピングで参照することができます:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noremap &lt;silent&gt; ,a :call &lt;SID&gt;name.Function()&lt;CR&gt;</div>
<br>
マッピングが定義されると、&quot;<span class="Special">&lt;SID&gt;</span>name.&quot; は&nbsp;<span class="Special">&lt;SNR&gt;</span>&nbsp;とimport されたスクリプトのス<br>
クリプトIDに置き換えられます。<br>
さらに簡単な方法として、<a class="Identifier" href="map.html#<ScriptCmd>">&lt;ScriptCmd&gt;</a>&nbsp;を使用することができます:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noremap ,a &lt;ScriptCmd&gt;name.Function()&lt;CR&gt;</div>
<br>
<span class="Todo">Note</span>&nbsp;これは変数には効かず、関数にしか効かないということです。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#import-legacy" name="import-legacy">import-legacy</a>&nbsp;<a class="Constant" href="vim9.html#legacy-import" name="legacy-import">legacy-import</a><br>
<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;は旧来の Vim script でも使用することができます。&quot;s:&quot; というプリフィ<br>
ックスがない場合でも、import された名前空間はスクリプトローカルとなります。<br>
例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import &quot;myfile.vim&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call s:myfile.MyFunc()</div>
<br>
そして &quot;as name&quot; 形式を使用する:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import &quot;otherfile.vim9script&quot; as that<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call s:that.OtherFunc()</div>
<br>
ただし、名前空間を単独で解決することはできません:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import &quot;that.vim&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo s:that<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot; ERROR: E1060: Expected dot after name: s:that</div>
<br>
これは、旧来のマッピングコンテキストにおける&nbsp;<a class="Identifier" href="map.html#<SID>">&lt;SID&gt;</a>&nbsp;の使用にも影響します。<br>
<a class="Identifier" href="map.html#<SID>">&lt;SID&gt;</a>&nbsp;は関数に対してのみ有効なプリフィックスであり、名前空間に対しては有効で<br>
はありません、スクリプトローカルな名前空間内の関数をスコープするために使用する<br>
ことはできません。関数の前に&nbsp;<a class="Identifier" href="map.html#<SID>">&lt;SID&gt;</a>&nbsp;を付ける代わりに、<a class="Identifier" href="map.html#<ScriptCmd>">&lt;ScriptCmd&gt;</a>&nbsp;を使用す<br>
る必要があります。例:<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;noremap ,a &lt;ScriptCmd&gt;:call s:that.OtherFunc()&lt;CR&gt;</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#:import-cycle" name=":import-cycle">:import-cycle</a><br>
<a class="Comment" href="vim9.html#:import">import</a>&nbsp;コマンドは、遭遇したときに実行されます。スクリプト A がスクリプト B<br>
を import し、B が (直接または間接的に) A を import した場合、これはスキップさ<br>
れます。この時点では、&quot;import B&quot; 以降の A 内の項目はまだ処理されておらず、定義<br>
されていません。したがって、循環的な import が存在しても、直接的にはエラーにな<br>
りませんが、&quot;import B&quot; 以降の A 内の項目が定義されていないためにエラーになる可<br>
能性があります。これはオートロード import には適用されません。次項参照。<br>
<br>
<br>
<span class="PreProc">オートロードスクリプトを import する</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-autoload" name="vim9-autoload">vim9-autoload</a>&nbsp;<a class="Constant" href="vim9.html#import-autoload" name="import-autoload">import-autoload</a><br>
起動速度を最適化するために、スクリプトの読み込みは実際に必要になるまで延期する<br>
必要があります。オートロード機構を使用することをお勧めします:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#E1264" name="E1264">E1264</a><br>
&nbsp;&nbsp;&nbsp;&nbsp; 1. プラグインでは、オートロードスクリプトから import された項目を参照する<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ユーザーコマンド、関数、マッピングを定義する。<br>
<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import autoload 'for/search.vim'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;command -nargs=1 SearchForStuff search.Stuff(&lt;f-args&gt;)</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;これは、.../plugin/anyname.vim に入る。&quot;anyname.vim&quot; は自由に選ぶこと<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ができる。&quot;SearchForStuff&quot; コマンドが利用できるようになった。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Comment" href="vim9.html#:import">import</a>&nbsp;の引数 &quot;autoload&quot; は、項目の1つが実際に使用されるまでスクリプ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;トがロードされないことを意味する。スクリプトは &quot;import&quot; ディレクトリ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ではなく、<a class="Type" href="options.html#'runtimepath'">'runtimepath'</a>&nbsp;の &quot;autoload&quot; ディレクトリの下に見つかる。<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;あるいは、相対名または絶対名のいずれかを使用することもできる。以下を参<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;照。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp; 2. オートロードスクリプトに、コードの大部分を置きます。<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export def Stuff(arg: string): void<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</div>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; これは、.../autoload/for/search.vim に入ります。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;search.vim&quot; スクリプトを &quot;/autoload/for/&quot; ディレクトリに置くと、<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;export された項目に &quot;for#search#&quot; というプリフィックスが付くようになり<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ます。プリフィックスは、旧来のオートロードスクリプトで手動で追加するの<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;と同じように、ファイル名から取得される。したがって、export された関数<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;は&quot;for#search#Stuff&quot; で見つけることができますが、通常は<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="Comment">import autoload</span>&nbsp;を使用し、プリフィックスを使用しません (この名前に遭<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;遇した関数をコンパイルするときにオートロードスクリプトをロードするとい<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;う副作用が発生します)。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;機能を分割して、オートロードスクリプトから他のスクリプトを好きなように<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import することができます。こうすることで、プラグイン間でコードを共有<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;することができます。<br>
<br>
<a class="Type" href="options.html#'runtimepath'">'runtimepath'</a>&nbsp;のすべてのエントリからオートロードスクリプトを検索するのは、少し時<br>
間がかかることがあります。プラグインがスクリプトの場所を知っている場合、多くの<br>
場合、相対パスが使用されます。これにより、検索が回避され、かなり速くなるはずで<br>
す。また、スクリプト名が一意である必要がないことも利点です。絶対パスも可能です。<br>
例:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import autoload '../lib/implement.vim'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import autoload MyScriptsDir .. '/lib/implement.vim'</div>
<br>
import したオートロードスクリプトを使用するマッピングを定義するには、特殊キー<br>
<a class="Identifier" href="map.html#<ScriptCmd>">&lt;ScriptCmd&gt;</a>&nbsp;が便利です。これは、マッピングのコマンドで、マッピングが定義され<br>
た場所のスクリプトコンテキストを使用することを可能にします。<br>
<br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;関数をコンパイルしているときに、オートロードスクリプトの関数に遭遇する<br>
と、<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;関数が呼び出されるまでスクリプトはロードされません。これは、引数や<br>
戻り値の型がまだ分かっていないため、実行時にのみエラーが発生することも意味しま<br>
す。もし、'#' 文字を含む名前を使用するのであれば、そのオートロードスクリプトは<br>
ロードされます。<br>
<br>
オートロードスクリプトの中で、意図せずロードのきっかけとなる項目を参照しないよ<br>
うに注意してください。例えば、関数名を取るオプションを設定する場合、関数参照で<br>
はなく、必ず文字列を使用してください:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;import autoload 'qftf.vim'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quickfixtextfunc = 'qftf.Func'&nbsp;&nbsp;# オートロードスクリプトはロードされ<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # ない<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;quickfixtextfunc = qftf.Func&nbsp;&nbsp;&nbsp;&nbsp;# オートロードスクリプトはロードされる</div>
一方で、スクリプトを早めに読み込むことで、エラーが発生した場合に、その旨を伝え<br>
ることができるようになり便利です。<br>
<br>
<a class="Identifier" href="testing.html#test_override()">test_override()</a>&nbsp;のテスト用関数を使用して、<span class="Comment">import autoload</span>&nbsp;にスクリプトをす<br>
ぐにロードさせることができます。これにより、項目と型が実際に使用されるのを待た<br>
ずにチェックできるようになります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_override('autoload', 1)</div>
後でリセットします:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_override('autoload', 0)</div>
または:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test_override('ALL', 0)</div>
<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
7. クラスとインターフェイス&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-classes" name="vim9-classes">vim9-classes</a><br>
<br>
旧来の Vim script では、関数であるメンバーを追加することで、辞書を一種のオブ<br>
ジェクトとして使用することができます。しかし、これは非常に非効率的で、すべての<br>
オブジェクトが正しいメンバーを持っていることを確認する作業を作成者が行う必要が<br>
あります。<a class="Identifier" href="eval.html#Dictionary-function">Dictionary-function</a>&nbsp;を参照。<br>
<br>
<a class="Identifier" href="vim9.html#Vim9">Vim9</a>&nbsp;script では、一般的なオブジェクト指向プログラミング言語のように、クラス、<br>
オブジェクト、インターフェイス、および列挙型を持つことができます。これは多くの<br>
機能を含んでいるため、別のヘルプファイルに記載されています:&nbsp;<a class="Identifier" href="vim9class.html">vim9class.txt</a><br>
<br>
<br>
<span class="PreProc">==============================================================================</span><br>
<br>
8. 理論的根拠&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="Constant" href="vim9.html#vim9-rationale" name="vim9-rationale">vim9-rationale</a><br>
<br>
<span class="PreProc">:def コマンド</span><br>
<br>
プラグインの作者から、Vim script をもっと速くしたいとの要望がありました。関数<br>
呼び出しの既存のセマンティクスを維持することは、関数の呼び出し、ローカル関数ス<br>
コープの設定、行の実行に伴うオーバーヘッドのため、不可能に近いことが調査により<br>
判明しました。エラーメッセージや例外など、処理しなければならない細部はたくさん<br>
あります。a: および l: スコープ用の辞書を作成する必要性、a:000 のリスト、その<br>
他いくつかの回避できないオーバーヘッドを追加しすぎています。<br>
<br>
したがって、新しいスタイルの関数を定義するための&nbsp;<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;メソッドを追加する必要<br>
があり、これにより異なるセマンティクスを持つ関数を定義することができるようにな<br>
りました。ほとんどのことは以前と同じように動作しますが、そうでない部分もありま<br>
す。関数を定義する新しい方法は、旧来のスタイルのコードとVim9スタイルのコードを<br>
分離するための最良の方法であると考えられていました。<br>
<br>
&quot;def&quot; を使用して関数を定義するのは、Python に由来します。他の言語は、従来の<br>
Vim script と競合する &quot;function&quot; を使用します。<br>
<br>
<br>
<span class="PreProc">型チェック</span><br>
<br>
Vim コマンドの行を命令にコンパイルする場合、可能な限りコンパイル時に行うべきで<br>
す。これを実行時に先送りすると、実行速度が遅くなり間違いに気づくのが遅くなりま<br>
す。例えば、&quot;+&quot; 文字に遭遇し、これを一般的な加算命令にコンパイルする場合、実行<br>
時に引数の型を検査し、どのような加算を行うかを決定する必要があります。そして、<br>
その型が辞書であった場合には、エラーを投げます。もし、型が数値であることが分か<br>
っていれば、「数値の加算」命令を使うことができ、その方が高速です。エラーはコン<br>
パイル時に発生し、2 つの数値の加算が失敗することはほとんどないため、実行時にエ<br>
ラー処理は必要ない。<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="Todo">NOTE</span>: 余談だが、例外として整数オーバーフローがある。これは、結果が整数の最<br>
&nbsp;&nbsp;&nbsp;&nbsp;大値を超える場合である。例えば、64 ビット符号付き整数に加算した結果が 2^63<br>
&nbsp;&nbsp;&nbsp;&nbsp;を超える場合を考える: &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 9223372036854775807 + 1&nbsp;&nbsp;&nbsp;&nbsp; # -9223372036854775808<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo 2-&gt;pow(63)-&gt;float2nr() + 1&nbsp;&nbsp;# -9223372036854775808<br>
&lt;<br>
複合型に&nbsp;<span class="Special">&lt;type&gt;</span>&nbsp;を使った型の構文は、Javaと似ています。理解しやすく、広く使われ<br>
ています。型名は、以前 Vim で使われていたものに、&quot;void&quot; や &quot;bool&quot; などが追加さ<br>
れています。<br>
<br>
<br>
<span class="PreProc">乱雑と奇妙さを取り除く</span><br>
<br>
<a class="Comment" href="vim9.html#:def">:def</a>&nbsp;関数が旧来の関数と異なる構文であることが決まれば、一般的なプログラミン<br>
グ言語を知っているユーザーにとってより馴染みやすいコードにするための改良を加え<br>
ることは自由です。言い換えれば、Vim でしかしないような奇妙なことは削除します。<br>
<br>
また、Vim script に古き良きViコマンドと後方互換性を持たせるために行われたもの<br>
を中心に、雑多なものを取り除くことができます。<br>
<br>
<br>
例:<br>
- 関数を呼び出すための&nbsp;<a class="Comment" href="userfunc.html#:call">:call</a>&nbsp;と式を評価するための&nbsp;<a class="Comment" href="eval.html#:eval">:eval</a>&nbsp;を削除します。<br>
- 行の継続のための先頭のバックスラッシュを使用しない。式がどこで終わるかを自動<br>
&nbsp;&nbsp;的に把握します。<br>
<br>
しかし、そのためには、いくつかのことを変える必要があります:<br>
- コメントは、文字列と混同しないように、&quot; の代わりに # で始まるようにしました。<br>
&nbsp;&nbsp;これはとにかく良いことで、いくつかの人気のある言語でも使用されています。<br>
- Ex コマンドの範囲は、式との混同を避けるため、先頭にコロンを付ける必要があり<br>
&nbsp;&nbsp;ます (シングルクォートは文字列またはマーク、&quot;/&quot; は割り算または検索コマンド、<br>
&nbsp;&nbsp;等)。<br>
<br>
<br>
目標は、違いを制限することです。良い基準は、古い構文を誤って使用した場合に、<br>
エラーメッセージが表示される可能性が非常に高いことです。<br>
<br>
<br>
<span class="PreProc">人気のある言語から構文とセマンティクスを学ぶ</span><br>
<br>
スクリプトの作成者は、Vim script の構文が慣れ親しんでいるものとは予想外に異な<br>
ると不満を漏らしています。この不満を軽減するために、人気のある言語を例として使<br>
用します。同時に、旧来の Vim script のよく知られた部分を放棄することは避けたい<br>
です。<br>
<br>
いろいろなことで TypeScript が踏襲されています。これは最近人気が出てきた言語で、<br>
Vim script に似ています。また、静的型付け (変数は常に既知の値型を持つ) と動的<br>
型付け (変数は異なる型を持つことができ、これは実行時に変更される) が混在してい<br>
ます。旧来の Vim script は動的型付けされており、既存の多くの機能 (特に組み込み<br>
関数) は動的型付けに依存していますが、静的型付けはより高速に実行できるため、<br>
Vim9 script でもこの混ぜ合わせが必要です。<br>
<br>
TypeScript の構文やセマンティクスに完全に合わせるつもりはありません。私たちは<br>
ただ、Vim に使える部分、Vim ユーザーが喜ぶと予想される部分を取り出したいだけで<br>
す。TypeScript は、独自の歴史、利点と欠点を持つ複雑な言語です。デメリットを知<br>
るには、この本を読んでください: &quot;JavaScript: The Good Parts&quot;。または、<br>
&quot;TypeScript: the good parts&quot; という記事を見つけて、&quot;Things to avoid&quot; セクショ<br>
ンを読んでください。<br>
<br>
他の言語 (Java、Pythonなど) に慣れている人も、TypeScript の中で気に入らないこ<br>
とや理解できないことを見つけるでしょう。そういったものを避けるようにします。<br>
<br>
TypeScript から避ける特定の項目:<br>
- &quot;+&quot; をオーバーロードして、加算と文字列連結の両方に使用します。これは旧来の<br>
&nbsp;&nbsp;Vim script に反しており、しばしば間違いにつながります。そのため、文字列の連<br>
&nbsp;&nbsp;結には &quot;..&quot; を使い続けることにします。Lua もこの方法で &quot;..&quot; を使っています。<br>
&nbsp;&nbsp;そして、より多くの値のために文字列に変換することができます。<br>
- TypeScript では、&quot;99 ||&nbsp;<span class="MissingTag">'yes'</span>&quot; のような式を条件として使うことができますが、<br>
&nbsp;&nbsp;その値を真偽値に代入することができません。これは一貫性がなく、迷惑なことで<br>
&nbsp;&nbsp;す。Vim は &amp;&amp; や || を使った式を認識し、その結果を bool として使うことができ<br>
&nbsp;&nbsp;ます。デフォルト値を使う仕組みとして、<a class="Identifier" href="eval.html#falsy-operator">falsy-operator</a>&nbsp;が追加されました。<br>
- TypeScript では、空の文字列を Falsy と見なしますが、空のリストや辞書を<br>
&nbsp;&nbsp;Truthy と見なしています。これは矛盾しています。Vimでは、空のリストや辞書も<br>
&nbsp;&nbsp;Falsy となります。<br>
- TypeScript にはさまざまな &quot;読み出し専用&quot; 型がありますが、型キャストによって<br>
&nbsp;&nbsp;不変な性質を取り除くことができるため、有用性は限定的です。Vim は値をロックす<br>
&nbsp;&nbsp;るので、より柔軟性がありますが、実行時にしかチェックされません。<br>
- TypeScript には複雑な &quot;import&quot; 文があり、Vim の import の仕組みとマッチしま<br>
&nbsp;&nbsp;せん。代わりに、import されたスクリプトが一度だけ読み込まれることにマッチす<br>
&nbsp;&nbsp;る、よりシンプルなメカニズムが使用されています。<br>
<br>
<br>
<span class="PreProc">宣言</span><br>
<br>
旧来の Vim script では、すべての代入に&nbsp;<a class="Comment" href="eval.html#:let">:let</a>&nbsp;を使用しますが、Vim9 では宣言が<br>
使用されます。これは異なるので、別のコマンドを使うのがよいでしょう。<a class="Comment" href="vim9.html#:var">var</a>&nbsp;で<br>
す。これは多くの言語で使用されています。セマンティクスは若干異なるかもしれませ<br>
んが、宣言として簡単に認識することができます。<br>
<br>
定数に&nbsp;<a class="Comment" href="eval.html#:const">:const</a>&nbsp;を使うのは一般的ですが、そのセマンティクスは様々です。変数だけ<br>
を不変にする言語もあれば、値も不変にする言語もあります。Java では &quot;final&quot; が変<br>
数だけを不変にするためによく知られているので、これを使うことにしました。そし<br>
て、<a class="Comment" href="eval.html#:const">:const</a>&nbsp;を使うことで、両方を不変にすることができます。これは旧来の Vim<br>
script でも使われていたもので、意味はほぼ同じです。<br>
<br>
最終的に得られるものは、Dart と非常によく似ています:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:var name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; # 可変な変数と値<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:final name&nbsp;&nbsp;&nbsp;&nbsp; # 不変な変数、可変な値<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:const name&nbsp;&nbsp;&nbsp;&nbsp; # 不変な変数と値</div>
<br>
旧来と Vim9 script が混在し、グローバル変数が共有されるため、オプションで型<br>
チェックを行うことが望ましいです。また、型推論により、多くの場合、型を指定する<br>
必要がなくなります。宣言に型を追加するには、TypeScript の構文が最も適していま<br>
す:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var name: string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 文字列型が指定される<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name = 'John'<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const greeting = 'hello'&nbsp;&nbsp;# 文字列型が推測される</div>
<br>
これは、型を宣言に入れる方法です:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist: list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final mylist: list&lt;string&gt; = ['foo']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Func(arg1: number, arg2: string): bool</div>
<br>
2つの選択肢を検討しました:<br>
&nbsp;&nbsp;&nbsp;&nbsp;1. Dart のように名前の前に型を置く:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var list&lt;string&gt; mylist<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final list&lt;string&gt; mylist = ['foo']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Func(number arg1, string arg2) bool</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. 変数名の後に型を入れるが、Go のようにコロンを使わない:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var mylist list&lt;string&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final mylist list&lt;string&gt; = ['foo']<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def Func(arg1 number, arg2 string) bool</div>
<br>
C や Java に慣れている人には1つ目の方が馴染みやすいと思います。2つ目は1つ目に<br>
対しての優位性があまりないので、2つ目は捨ててしまいましょう。<br>
<br>
型推論を使うので、値から推論できる場合は型は省くことができます。つまり、<a class="Comment" href="vim9.html#:var">var</a><br>
の後に型が続くのか名前が続くのかが分からないのです。そのため、Vim だけでなく人<br>
間にとっても構文解析が難しくなります。また、型名になりうる変数名を使うことは許<br>
されないでしょう。<span class="Comment">var string string</span>&nbsp;を使うのはあまりにも紛らわしいです。<br>
<br>
コロンを使用して名前と型を区切る選ばれた構文は、句読点を追加しますが、実際に<br>
は、宣言の部分を認識しやすくします。<br>
<br>
<br>
<span class="PreProc">式</span><br>
<br>
式の評価は、すでに他の言語が行っているものに近いものでした。いくつかの細部は予<br>
期せぬものであり、改善することができます。例えば、真偽値条件では、文字列を受け<br>
取り、それを数値に変換して、その数値が0でないかどうかをチェックします。これは<br>
予想外のことで、しばしば間違いにつながります。なぜなら、数字で始まらないテキス<br>
トはゼロに変換され、これは偽とみなされるからです。このように、条件に文字列を使<br>
うと、エラーが出ず、偽とみなされることが多いのです。これは紛らわしいです。<br>
<br>
Vim9 では、間違いを避けるために型チェックがより厳しくなっています。例えば<br>
<a class="Comment" href="eval.html#:if">:if</a>&nbsp;コマンドや&nbsp;<span class="Comment">||</span>&nbsp;演算子など、条件が使われる場所では、真偽値のような値しか<br>
受け付けません:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true:&nbsp;&nbsp;<a class="Comment" href="vim9.html#true">true</a>,&nbsp;<a class="Comment" href="eval.html#v:true">v:true</a>,&nbsp;<span class="Comment">1</span>,&nbsp;<span class="Comment">0 &lt; 9</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false:&nbsp;<a class="Comment" href="vim9.html#false">false</a>,&nbsp;<a class="Comment" href="eval.html#v:false">v:false</a>,&nbsp;<a class="Comment" href="motion.html#0">0</a>,&nbsp;<span class="Comment">0 &gt; 9</span><br>
<span class="Todo">Note</span>&nbsp;数字の 0 は偽で、数字の 1 は真です。これは、他の多くの言語よりも寛容です。<br>
これは、多くの組み込み関数がこれらの値を返すため、それを変更すると、解決するよ<br>
りも多くの問題を引き起こすからです。これをしばらく使ってみると、うまくいくこと<br>
が分かりました。<br>
<br>
任意の型を持つ値について、それを真偽値として使いたい場合は、<a class="Comment" href="change.html#!!">!!</a>&nbsp;演算子を使い<br>
ます (<a class="Identifier" href="eval.html#expr-!">expr-!</a>&nbsp;を参照): &gt;vim9<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vim9script<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# 以下はすべて true:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo [!!<span class="MissingTag">'text'</span>, !![1], !!{'x': 1}, !!1, !!1.1]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# そしてこれらはすべて false:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo [!!'', !![], !!{}, !!0, !!0.0]<br>
&lt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true:&nbsp;<span class="Comment">!!'text'</span>&nbsp;&nbsp;&nbsp;<span class="Comment">!![99]</span>&nbsp;&nbsp;&nbsp;<span class="Comment">!!{'x': 1}</span>&nbsp;&nbsp;&nbsp;<span class="Comment">!!99</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;false:&nbsp;<span class="Comment">!!''</span>&nbsp;&nbsp;&nbsp;<span class="Comment">!![]</span>&nbsp;&nbsp;&nbsp;<span class="Comment">!!{}</span><br>
<br>
JavaScript のような言語には、このような便利な構文があります:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetName() || 'unknown'</div>
ただし、これは、条件に真偽値のみを許可することと競合します。したがって、&quot;??&quot;<br>
演算子が追加されました:<br>
<div class="helpExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GetName() ?? 'unknown'</div>
ここでは、値をそのまま使用し、真偽値にしないという意図を明示的に表すことがで<br>
きます。これは&nbsp;<a class="Identifier" href="eval.html#falsy-operator">falsy-operator</a>&nbsp;と呼ばれます。<br>
<br>
<br>
<span class="PreProc">Import と Export</span><br>
<br>
旧来の Vim script の問題点は、デフォルトですべての関数と変数がグローバルである<br>
ことです。スクリプトローカルにすることは可能ですが、そうすると他のスクリプトで<br>
利用できなくなります。これは、選択された項目のみをエクスポートし、残りをローカ<br>
ルに保つパッケージの概念に反しています。<br>
<br>
Vim9 script では、JavaScript の import および export 機構に非常によく似た機構<br>
がサポートされています。これは既存の&nbsp;<a class="Comment" href="repeat.html#:source">:source</a>&nbsp;コマンドの亜種で、期待通りに動<br>
作します:<br>
- デフォルトですべてをグローバルにするのではなく、すべてをスクリプトローカルに<br>
&nbsp;&nbsp;することで、その一部をエクスポートすることができる。<br>
- スクリプトの import 時には、import されるシンボルが明示的にリストされるため、<br>
&nbsp;&nbsp;名前の衝突や、後から機能を追加した場合の失敗を回避することができる。<br>
- この機構により、export された関数、変数、クラスという非常に明確なAPIを持つ巨<br>
&nbsp;&nbsp;大で長いスクリプトを書くことができる。<br>
- 相対パスを使用することで、パッケージ内のインポートのロードが非常に速くなり、<br>
&nbsp;&nbsp;多くのディレクトリを検索する必要がない。<br>
- 一度インポートを使用すると、その項目はキャッシュされ、再ロードする必要はな<br>
&nbsp;&nbsp;い。<br>
- スクリプトローカルにするための Vim 特有の &quot;s:&quot; の使用をやめることができる。<br>
<br>
(Vim9 script または旧来の Vim script から) Vim9 script を読み込む場合、グロー<br>
バルに定義された項目のみが使用可能で、export された項目は使用できません。代替<br>
案を検討しました:<br>
- export された項目は、すべてスクリプトローカル項目として利用できるようにする。<br>
&nbsp;&nbsp;これにより、どの項目が定義されるかは制御できず、すぐにトラブルに発展する可能<br>
&nbsp;&nbsp;性がある。<br>
- export された項目を使用し、それらをグローバルにする。デメリットは、グローバ<br>
&nbsp;&nbsp;ルな名前空間での名前の衝突を避けることができなくなることである。<br>
- Vim9 script を読み込むことを完全に禁止し、<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;を使うことを要求する。こ<br>
&nbsp;&nbsp;れにより、スクリプトをテストに使用したり、コマンドラインからスクリプトを取得<br>
&nbsp;&nbsp;して試したりすることが難しくなる。<br>
<span class="Todo">Note</span>&nbsp;上記の通り、旧来の Vim script でも&nbsp;<a class="Comment" href="vim9.html#:import">:import</a>&nbsp;を使用することができます。<br>
<br>
<br>
<span class="PreProc">関数を早期にコンパイルする</span><br>
<br>
関数は、呼び出されたとき、または&nbsp;<a class="Comment" href="vim9.html#:defcompile">:defcompile</a>&nbsp;が使用されたときにコンパイルさ<br>
れます。なぜ、早期にコンパイルして、構文エラーや型エラーが早期に報告されるよう<br>
にしないのでしょうか？<br>
<br>
なぜなら、後に定義される関数への前方参照が存在する可能性があるからです。例え<br>
ば、A、B、C という関数を定義し、A が B を呼び出し、B が C を呼び出し、C がまた<br>
A を呼び出すとします。前方参照を避けるために関数を並べ替えることは不可能です。<br>
<br>
別の方法としては、まずファイルをスキャンして項目を見つけ、そのタイプを把握し、<br>
前方参照が見つかるようにしてから、スクリプトを実行し、関数をコンパイルする方法<br>
があります。この場合、スクリプトを2回解析する必要があり、遅いです。また、機能<br>
がサポートされているかどうかのチェックなど、スクリプトレベルでの条件もあるた<br>
め、使いにくいです。うまくいくかどうか試行錯誤しましたが、うまく動作させること<br>
は不可能であることが判明しました。<br>
<br>
スクリプトの最後にすべての関数をコンパイルすることは可能でしょう。しかし、ある<br>
関数が一度も呼び出されない場合、その関数をコンパイルするためのオーバーヘッド<br>
が、いずれにせよカウントされてしまうという欠点があります。起動速度は非常に重要<br>
なので、ほとんどの場合、コンパイルは後回しにした方がよく、構文や型のエラーはそ<br>
の時にしか報告されないことを受け入れることができます。例えばテスト時など、これ<br>
らのエラーを早期に発見する必要がある場合は、スクリプトの最後の&nbsp;<a class="Comment" href="vim9.html#:defcompile">:defcompile</a><br>
コマンドが効果的です。<br>
<br>
<br>
<span class="PreProc">なぜ既存の組み込み言語を使わないのか?</span><br>
<br>
Vim は Perl、Python、Lua、Tcl、その他いくつかへのインターフェイスをサポートし<br>
ています。しかし、これらのインターフェイスは様々な理由で広く使われるようになる<br>
ことはありませんでした。Vim9 が設計されたとき、これらのインターフェイスの優先<br>
順位を下げ、Vim script に集中させることが決定されました。<br>
<br>
それでも、プラグイン作成者は他の馴染みのある言語を探したり、既存のライブラリを<br>
使用したり、性能の恩恵を確認したりするかもしれません。我々は、プラグインの作者<br>
が任意の言語でコードを書き、ジョブやチャネルを使って外部プロセスとして実行する<br>
ことを推奨します。我々は、これをどうにかして簡単にできるように努力することがで<br>
きます。<br>
<br>
外部ツールの使用にもデメリットがある。代替案として、ツールを Vim Script に変換<br>
する方法がある。これを実現するには、余分な翻訳作業を避けつつコードの高速性を維<br>
持する必要があり、ツールの構造をサポートする必要がある。Vim9 Script ではクラ<br>
ス、オブジェクト、インターフェイス、列挙型がサポートされているため、これはます<br>
ます実現可能になっている。<br>
<br>
<br>
&nbsp;vim:tw=78:ts=8:noet:ft=help:norl:<br>
</div>
